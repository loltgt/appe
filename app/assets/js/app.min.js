/*!
 * {appe}
 *
 * @version 1.0.0~beta
 * @copyright Copyright (C) 2018-2019 Leonardo Laureti
 * @license MIT License
 *
 * contains:
 * - (jQuery.fn.isPlainObject) from jQuery JavaScript Library <https://jquery.com/>, Copyright JS Foundation and other contributors, MIT license <https://jquery.org/license>
 * - (jQuery.fn.extend) from jQuery JavaScript Library <https://jquery.com/>, Copyright JS Foundation and other contributors, MIT license <https://jquery.org/license>
 */
var app=app={_root:{},_runtime:{}};app._root.server=this,app._root.document=!!this.Document&&document||{native:!1,documentElement:null},app._root.window=!!this.Window&&window||{native:!1,document:app._root.document,navigator:null},app._root.process=!!this.Window&&!this.Process&&{native:!1}||process,app._runtime={version:"1.0",release:"1.0 beta",system:null,exec:!0,session:!1,title:"",name:"",locale:"en",locale_dir:"ltr",storage:!1,binary:!1,compression:!1,encryption:!1,debug:!1,hangs:0},app.load=function(e){if("function"!=typeof e)return app.stop("app.load","func");var t=!1,o=function(){t||(e(),t=!0)};null==app._root.window.native?("complete"==document.readyState?o():document.addEventListener("DOMContentLoaded",o),app.utils.addEvent("load",app._root.window,o)):app._root.server.load=e},app.unload=function(e){if("function"!=typeof e)return app.stop("app.unload","func");null==app._root.window.native?app.utils.addEvent("beforeunload",app._root.window,e):app._root.server.onunload=e},app.redirect=function(){var e=app._root.window.appe__config||app._root.process.env.appe__config;if(!e)return app.stop("app.redirect");var t=e.base_path.toString(),o="index";-1!=app._root.window.location.href.indexOf(t+"/")&&(t="..",o=e.launcher_name.toString()),app._root.window.location.href=t+"/"+o+".html"},app.position=function(){var e=app.controller.cursor();return e&&"object"!=typeof e?app.error("app.position","loc"):null},app.session=function(e,a,t){if("function"!=typeof e||!a)return app.stop("app.session",[e,"config",t]);var o=null;if("secret_passphrase"in a&&(o=a.secret_passphrase.toString(),delete a.secret_passphrase),app._root.server.appe__store={},app._runtime.name=a.app_ns.toString(),app._runtime.debug=!!a.debug,app._runtime.encryption=!!(a.encryption||a.file&&a.file.crypt),app._runtime.compression=!!(a.compression||a.file&&a.file.compress),app._runtime.binary=!!(a.binary||a.file&&a.file.binary),!app._runtime.binary||app._runtime.compression&&app._runtime.encryption||app.error("app.session","binary"),app._runtime.system=app.utils.system(),"localStorage"in app._root.window==!1?app._runtime.storage="sessionStorage":"sessionStorage"in app._root.window==!1?app._runtime.storage="localStorage":"safari"==app._runtime.system.name?app._runtime.storage="sessionStorage":null==app._root.process?app._runtime.storage="storage":app._runtime.storage="localStorage",app._runtime.session=!0,!(void 0===app._root.server.appe__locale)&&null===a.language){var p=app._root.window.appe__locale;if("object"!=typeof p)return app.error("app.session","locale");if(app._root.window.navigator&&navigator.languages&&"object"==typeof navigator.languages){var r=!1;for(lang in navigator.languages)!r&&navigator.languages[lang]in p&&(app._runtime.locale=navigator.languages[lang].toString(),r=!0);!r&&navigator.languages.length&&(app._runtime.locale=navigator.languages[lang].split("-")[0]||app._runtime.locale)}}app._runtime.locale=a.language?a.language.toString():app._runtime.locale,app._runtime.locale_dir=a.language_direction?a.language_direction.toString():app._runtime.locale_dir,null==app._root.document.native&&(document.documentElement.setAttribute("lang",app._runtime.locale),document.documentElement.setAttribute("class",app.utils.classify(app._runtime.system,"system--")));var n,i,s=0,l=function(e,t){var o=parseInt(a.open_attempts)||50,p=0,r=setInterval(function(){p++,e in app._root.window!=!0&&o!==p||(clearInterval(r),t(!0))},10)},c=function(t){if(!(CryptoJS&&CryptoJS.MD5&&CryptoJS.SHA512&&CryptoJS.AES))return t("CryptoJS");try{var e=CryptoJS.SHA512(Math.random().toString(),{outputLength:384});app._runtime.secret=e.toString(CryptoJS.enc.Hex),app._root.document[app._runtime.secret]=o,t(!1,!0)}catch(e){t(e)}},u=function(e){--s||f()},f=function(){void 0===t&&start&&"session"in start&&"function"==typeof start.session?start.session(e):!0===t&&main&&"session"in main&&"function"==typeof main.session?main.session(e):!1===t&&control&&"session"in control&&"function"==typeof control.session?control.session(e):e()};!1!==t?(app._runtime.encryption&&(s++,function(e){if(!a.secret_passphrase||"string"!=typeof a.secret_passphrase)return e("config");"CryptoJS"in app._root.window==0?l("CryptoJS",c.bind(null,e)):c(e)}(u)),app._runtime.compression&&(s++,i=u,"pako"in app._root.window==0?l("pako",c.bind(null,i)):function(e){if(!(pako&&pako.inflate&&pako.deflate))return e("pako");e(!1,!0)}(i)),s||(s=1,n=u,"CryptoJS"in app._root.window==0?l("CryptoJS",c.bind(null,n)):c(n))):f()},app.resume=function(e,t){if(!e)return app.stop("app.resume",["config",t]);var o="",p="";if(app._runtime.binary||(app.utils.cookie("has","last_opened_file")&&(o=app.utils.cookie("get","last_opened_file")),o||(o=app.memory.get("last_opened_file"))),app.utils.cookie("has","last_session")&&(p=app.utils.cookie("get","last_session")),p||(p=app.memory.get("last_session")),void 0!==t||o&&!p){if(app._runtime.debug&&void 0!==t)return!p&&app.newSession();if(!p)return app.redirect()}else;return o&&(o=app.utils.base64("decode",o)),o},app.data=function(e){var t=app._root.server.appe__store;if(!t)return app.stop("app.data","store");var o=app._runtime.name.toString();return t[o]?e&&"string"==typeof e?e in t[o]?t[o][e]:app.error("app.data","key"):t[o]:app.stop("app.data","store")},app.checkConfig=function(e){if(!e||"object"!=typeof e)return app.stop("app.checkConfig");for(var t=!1,o=["app_ns","launcher_name","app_name","schema","events","routes","default_route","default_event","base_path","save_path"],p=null,r=0;p=o[r++];)p in e==!1?t=!0:"schema"!=p&&"events"!=p&&"routes"!=p||"object"==typeof e[p]?"object"!=typeof e[p]&&"string"!=typeof e[p]&&"number"!=typeof e[p]&&"boolean"!=typeof e[p]&&(t=!0):t=!0;return(e.encryption&&(!e.secret_passphrase||"string"!=typeof e.secret_passphrase)||e.alt&&"object"!=typeof e.alt||e.file&&"object"!=typeof e.file||e.csv&&"object"!=typeof e.csv)&&(t=!0),!!t&&app.stop("app.checkConfig","config")},app.checkFile=function(e,t){var o=app._root.window.appe__config||app._root.process.env.appe__config;if(!o)return app.stop("app.checkFile");if(!e||"object"!=typeof e)return app.error("app.checkFile",["source","checksum"]);var p=app._runtime.version.toString();if(p!==e.file.version)return app.error("app.checkFile",app.i18n("This file is incompatible with running version: {{_app_version}}.",null,p),e.file);if(o.verify_checksum&&t)try{if(e.file.checksum!==t)throw"checksum"}catch(e){return app.error("app.checkFile",e)}return!0},app.openSessionFile=function(){var e=app._root.window.appe__config||app._root.process.env.appe__config;if(!e)return app.stop("app.openSessionFile");var o=!(void 0===app._root.server.appe__start);if(app._runtime.encryption&&!(CryptoJS&&CryptoJS.SHA512&&CryptoJS.AES))return app.error("app.openSessionFile","CryptoJS");if(app._runtime.compression&&!(pako&&pako.inflate&&pako.deflate))return app.error("app.openSessionFile","pako");if("object"!=typeof e.schema)return app.error("app.openSessionFile","schema");var p=new Date;p=app.utils.dateFormat(p,"Q");var r=app.utils.base64("encode",p),t=(app._runtime.name.toString(),e.file&&e.file.binary?!!e.file.binary:!!app._runtime.binary),a=e.file&&e.file.compress?!!e.file.compress:!!app._runtime.compression,n=e.file&&e.file.crypt?!!e.file.crypt:!!app._runtime.encryption;if(t&&(!a||!n))return app.error("app.openSessionFile","binary"),callback(!1);var i="js";t&&(i="appe"),i=e.file&&e.file.extension?"."+e.file.extension.toString():i;var s=function(e){if(o&&app.start.progress(0),e){app.utils.cookie("del","last_opened_file"),app.utils.cookie("del","last_session");var t=app.utils.base64("encode",e);app.utils.cookie("set","last_opened_file",t),app.utils.cookie("set","last_session",r),app.memory.set("last_opened_file",t),app.memory.set("last_stored",p),app.memory.set("last_time",p),app.memory.set("last_session",r),o?app.start.redirect(!0):app._root.window.location.reload()}},l=null;if(!this.getAttribute("data-open")){this.setAttribute("data-open","");var c=this.getAttribute("data-open-input");l=this.parentNode.querySelector(c);"ios"!=app._runtime.system.platform&&l.setAttribute("accept","."+i),app.utils.addEvent("change",l,function(){app.os.fileSessionOpen.call(this,s)})}l&&(o&&app.start.progress(2),l.click())},app.saveSessionFile=function(){var e=app._root.window.appe__config||app._root.process.env.appe__config;if(!e)return app.stop("app.saveSessionFile");var t=app._root.server.appe__store;if(!t)return app.stop("app.saveSessionFile","store");app._root.server.appe__start;if(app._runtime.encryption&&!(CryptoJS&&CryptoJS.SHA512&&CryptoJS.AES))return app.error("app.saveSessionFile","CryptoJS");if(app._runtime.compression&&!(pako&&pako.inflate&&pako.deflate))return app.error("app.saveSessionFile","pako");var o=app._runtime.name.toString(),p=e.schema;if("object"!=typeof p)return app.error("app.saveSessionFile","schema");var r={},a=new Date;Array.prototype.forEach.call(p,function(e){r[e]=t[o][e]}),r.file=app.os.generateJsonHead(r,a),app.os.fileSessionSave(function(e){app._runtime.debug&&console.info("save",e)},r,a)},app.newSession=function(){var e=app._root.window.appe__config||app._root.process.env.appe__config;if(!e)return app.stop("app.newSession");var t=!(void 0===app._root.server.appe__start),o=app._runtime.name.toString(),p=new Date;p=app.utils.dateFormat(p,"Q");var r=app.utils.base64("encode",p),a=e.schema;if("object"!=typeof a)return app.error("app.newSession","schema");var n=function(){t?app.start.redirect(!1):app._root.window.location.reload()};!function(){for(var e in app.controller.clear(),app.utils.cookie("del","last_opened_file"),app.utils.cookie("del","last_session"),app.utils.cookie("set","last_session",r),app.memory.del("last_opened_file"),app.memory.del("file_saves"),app.memory.set("last_stored",p),app.memory.set("last_time",p),app.memory.set("last_session",r),a)app.store.set(o+"_"+a[e],{});n()}()},app.openSession=app.openSessionFile,app.saveSession=app.saveSessionFile,app.i18n=function(e,t,o){var p=app._root.window.appe__locale;if(!p)return e;if("object"!=typeof p)return app.stop("app.i18n","locale");var r=app._runtime.locale.toString(),a=app._runtime.locale_dir.toString();if("string"!=typeof e||o&&"string"!=typeof o&&"object"!=typeof o||t&&"string"!=typeof t)return app.error("app.i18n",[e,t,o]);t=t?t.toString():"0";var n=null;if(p[r]&&p[r][t]&&e in p[r][t]&&p[r][t][e])n=p[r][t][e].toString();else{if(!/\{\{|\|\|/.test(e))return e;n=e}if(!o)return n;if("string"==typeof o){if(-1!=o.indexOf("{{")){var i=-1!=o.indexOf("[[")?o.match(/\{\{(.+)(?:\[\[([\w]+)\]\])\}\}/):o.match(/\{\{(.+)\}\}/),s=null;-1!=i[1].indexOf("%%")&&(i=(s=i[1].split("%%"))[0]?[null,s[0],i[2]]:(n="{{placeholder}}",[null,e.toString(),t]),(s=s[1]).length&&(s=/\D/.test(s[0])?s.split(","):[[s[0]]])),o=app.i18n(i[1],i[2],s)}n=n.replace(/\{\{[\w]+\}\}/,o)}else if("object"==typeof o)if(o[0]instanceof Array){var l=["$1","$2"];"rtl"==a&&l.reverse(),n=n.replace(/(.+)\|\|(.+)/,1<parseInt(o[0][0])?l[1]:l[0])}else if(o instanceof Array)for(var c in"rtl"==a&&o.reverse(),o)n=n.replace(/\{\{[\w]+\}\}/,o[c].toString());else for(var u in o)n=n.replace(new RegExp("{{"+u.toString()+"}}"),o[u]);return n},app.debug=function(){return app.getInfo("config","debug")},app.stop=function(e,t,o,p){if(!app._runtime.exec)return!1;var r=!(void 0===app._root.server.appe__main);return app._runtime.exec=!1,t=t||null,r&&app.blind(),app.error.apply(this,[e,t,o,p]),!1},app.error=function(e,t,o,p){var r=!(void 0===app._root.server.appe__control),a=null,n=null,i=null;o?(a=e,n=t,i=o):t?(a=e,i=t):e&&(n=e),3<app._runtime.hangs||(app._root.document.documentElement.lang||(document.documentElement.lang=app._runtime.locale.toString()),app._runtime.debug&&(app._runtime.exec?console.error("ERR",a,n,app.position()||""):console.warn("WARN",a,n,app.position()||""),i&&console.log(i)),n||(n=app.i18n("There was an error while executing."),app._runtime.exec||(n+="\n\n"+app.i18n("Please reload the application."))),r||p||app._runtime.hangs++||app._root.window.alert&&app._root.window.alert(n))},app.blind=function(){if(!(void 0===app._root.window.appe__main)){var e=app._root.document.createElement("div");e.setAttribute("style","position: absolute; top: 0; right: 0; bottom: 0; left: 0; z-index: 9999; background: rgba(0,0,0,0.3);"),null==app._root.document&&app._root.document.body.appendChild(e)}},app.getInfo=function(e,t){var o=app._root.window.appe__config||app._root.process.env.appe__config;if(!o)return app.stop("app.getConfig");if("string"!=typeof e&&t&&"string"!=typeof t)return app.error("app.getInfo",[e,t]);var p=null;switch(e){case"config":p={app_name:o.app_name.toString(),schema:"object"==typeof o.schema?o.schema:[],license:o.license&&("object"==typeof o.license?{text:o.license.text.toString(),file:o.license.file.toString()}:o.license.toString())||!1};break;case"runtime":p={debug:!!app._runtime.debug,locale:app._runtime.locale.toString(),version:app._runtime.version.toString(),release:app._runtime.release.toString()};break;default:return app.error("app.getInfo","info")}return t&&t in p?p[t]:p},app.getName=function(){return app.getInfo("config","app_name")},app.getVersion=function(e){return e&&"string"!=typeof e?app.error("app.getVersion",[e]):"version"==e||"release"==e?app.getInfo("runtime",e):{version:app.getInfo("runtime","version"),release:app.getInfo("runtime","release")}},app.getLicense=function(){return app.getInfo("config","license")},app.getLocale=function(){return app.getInfo("config","locale")},app.os={},app.os.fileSessionOpen=function(o){var e=app._root.window.appe__config||app._root.process.env.appe__config;if(!e)return app.stop("app.os.fileSessionOpen");var t=!0;if(e.file&&"object"!=typeof e.file&&(t=app.error("app.os.fileSessionOpen","config")),FileReader||(t=app.error("app.os.fileSessionOpen","FileReader")),CryptoJS&&CryptoJS.MD5||(t=app.error("app.os.fileSessionOpen","CryptoJS")),!app._runtime.encryption||CryptoJS&&CryptoJS.SHA512&&CryptoJS.AES||(t=app.error("app.os.fileSessionOpen","CryptoJS")),!app._runtime.compression||pako&&pako.inflate&&pako.deflate||(t=app.error("app.os.fileSessionOpen","pako")),o&&"function"==typeof o||(t=app.error("app.os.fileSessionOpen",[o])),!t||!this.files.length)return o(!1);var p=app._runtime.name.toString(),r=e.schema;if("object"!=typeof r)return app.error("app.os.fileSessionOpen","schema"),o(!1);var a=e.file&&e.file.binary?!!e.file.binary:!!app._runtime.binary,n=e.file&&e.file.compress?!!e.file.compress:!!app._runtime.compression,i=e.file&&e.file.crypt?!!e.file.crypt:!!app._runtime.encryption;if(a&&(!n||!i))return app.error("app.os.fileSessionOpen","binary"),o(!1);var s=this.files[0],l=e.file&&e.file.heads?e.file.heads.toString():p,c="js",u="application/x-javascript",f=null;if(a?(c="appe",u="application/octet-stream"):u+";charset=utf-8",c=e.file&&e.file.extension?e.file.extension.toString():c,app._runtime.debug&&console.info("app.os.fileSessionOpen","file",s,e.file),"ios"!=app._runtime.system.platform&&-1===s.name.indexOf(c))return app.error("app.os.fileSessionOpen",app.i18n("This file format cannot be open."),"file"),o(!1);var d=function(e,t){if(!e)return t(!1);if(a)return t(!1,e);-1!=e.indexOf("\r\n")&&(e=e.replace(/[\r\n]([\s]+){2}/g,""));var o=new RegExp(l+'=(?![^"{}]+)');e=e.replace(o,"").replace(/(^"|"$)/g,"")},m=function(e,t){var o=null;if(!(app._runtime.secret&&"string"==typeof app._runtime.secret&&app._runtime.secret in app._root.document))return t("runtime");o=app._root.document[app._runtime.secret];try{if(!(e=(e=CryptoJS.AES.decrypt(e,o,{mode:CryptoJS.mode.CTR,padding:CryptoJS.pad.NoPadding})).toString(CryptoJS.enc.Utf8)))throw"decryption";t(!1,e)}catch(e){t(e)}},v=function(e,t){try{e=JSON.parse(e)}catch(e){return t(e)}if(!app.checkFile(e,f))return t("check");for(var o in r){if(r[o]in e==!1)return t("schema");app.store.set(p+"_"+r[o],e[r[o]])}t(!1,s.name)},g=function(e){try{d(e,n&&i?function(e,t){if(e)throw e;!function(e,t){try{if(!(e=pako.inflate(e,{raw:!0,to:"string"})))throw"decompression";t(!1,e)}catch(e){t(e)}}(t,function(e,t){if(e)throw e;m(t,function(e,t){if(e)throw e;app.os.generateJsonChecksum(function(e){if(!e)throw null;f=e,v(t,function(e,t){if(e)throw e;o(t)})},t)})})}:i?function(e,t){if(e)throw e;m(t,function(e,t){if(e)throw e;app.os.generateJsonChecksum(function(e){if(!e)throw null;f=e,v(t,function(e,t){if(e)throw e;o(t)})},t)})}:function(e,t){if(e)throw e;app.os.generateJsonChecksum(function(e){if(!e)throw null;f=e,v(t,function(e,t){if(e)throw e;o(t)})},t)})}catch(e){return app.error("app.os.fileSessionOpen",e),o(!1)}},y=new FileReader;y.onloadend=function(){g(this.result)},y.onerror=function(e){app.error("app.os.fileSessionOpen",e),o(!1)},a?y.readAsArrayBuffer(s):y.readAsText(s)},app.os.fileSessionSave=function(o,e,s){var l=app._root.window.appe__config||app._root.process.env.appe__config;if(!l)return app.stop("app.os.fileSessionSave");var t=!0;if(l.file&&"object"!=typeof l.file&&(t=app.error("app.os.fileSessionSave","config")),Blob||(t=app.error("app.os.fileSessionSave","Blob")),FileReader||(t=app.error("app.os.fileSessionSave","FileReader")),CryptoJS&&CryptoJS.MD5||(t=app.error("app.os.fileSessionOpen","CryptoJS")),!app._runtime.encryption||CryptoJS&&CryptoJS.SHA512&&CryptoJS.AES||(t=app.error("app.os.fileSessionSave","CryptoJS")),!app._runtime.compression||pako&&pako.inflate&&pako.deflate||(t=app.error("app.os.fileSessionSave","pako")),o&&"function"==typeof o&&s&&s instanceof Date||(t=app.error("app.os.fileSessionSave",[o,e,s])),!t||!e||"object"!=typeof e)return o(!1);var c=app._runtime.name.toString(),p=l.file&&l.file.binary?!!l.file.binary:!!app._runtime.binary,r=l.file&&l.file.compress?!!l.file.compress:!!app._runtime.compression,a=l.file&&l.file.crypt?!!l.file.crypt:!!app._runtime.encryption;if(p&&(!r||!a))return app.error("app.os.fileSessionSave","binary"),o(!1);var n=l.file&&l.file.heads?l.file.heads.toString():c,u="js",i="application/x-javascript",f=null;f=p?(u="appe",i="application/octet-stream"):i+";charset=utf-8",u=l.file&&l.file.extension?l.file.extension.toString():u;var d=function(t,o){t.file.checksum="";for(var e=32;e--;)t.file.checksum+=" ";try{t=JSON.stringify(t);app.os.generateJsonChecksum(function(e){if(!e)throw null;e,t=t.replace(/"file":{"checksum":"[\s]{32}"/,'"file":{"checksum":"'+e+'"'),o(!1,t)},t)}catch(e){o(e)}},m=function(e,t){var o=null;if(!(app._runtime.secret&&"string"==typeof app._runtime.secret&&app._runtime.secret in app._root.document))return t("runtime");o=app._root.document[app._runtime.secret];try{if(!(e=(e=CryptoJS.AES.encrypt(e,o,{mode:CryptoJS.mode.CTR,padding:CryptoJS.pad.NoPadding})).toString()))throw"encryption";t(!1,e)}catch(e){t(e)}},v=function(e,t){if(!e)return t("source");p||(a&&(e='"'+e+'"'),e=n+"="+e),t(!1,e)},g=function(e,t){var o=app.memory.has("file_saves")?parseInt(app.memory.get("file_saves")):0;o++;var p=l.file&&l.file.filename_prefix?l.file.filename_prefix.toString():c+"_save",r=l.file&&l.file.filename_separator?l.file.filename_separator.toString():"_",a=l.file&&l.file.filename_date_format?l.file.filename_date_format.toString():"Y-m-d_H-M-S",n=p;n+=r+app.utils.dateFormat(s,a);var i=(n+=r+o)+"."+u;app._runtime.debug&&console.info("app.os.fileSessionSave","file",i,f,l.file);try{app.memory.set("file_saves",o),app.os.fileDownload(e,i,f),t(!1,i)}catch(e){t(e)}};!function(e){try{d(e,r&&a?function(e,t){if(e)throw e;m(t,function(e,t){if(e)throw e;!function(e,t){try{if(!(e=pako.deflate(e,{raw:!0,level:9})))throw"compression";t(!1,e)}catch(e){t(e)}}(t,function(e,t){if(e)throw e;v(t,function(e,t){if(e)throw e;g(t,function(e,t){if(e)throw e;o(t)})})})})}:a?function(e,t){if(e)throw e;m(t,function(e,t){if(e)throw e;v(t,function(e,t){if(e)throw e;g(t,function(e,t){if(e)throw e;o(t)})})})}:function(e,t){if(e)throw e;v(t,function(e,t){if(e)throw e;g(t,function(e,t){if(e)throw e;o(t)})})})}catch(e){app.error("app.os.fileSessionSave",e),o(!1)}}(e)},app.os.fileDownload=function(e,i,t){if(!FileReader)return app.error("app.os.fileDownload","FileReader");if(!Blob)return app.error("app.os.fileDownload","Blob");if("object"!=typeof e&&"string"!=typeof e||"string"!=typeof i||"string"!=typeof t)return app.error("app.os.fileDownload",[e,i,t]);var s=app._root.window.URL||app._root.window.webkitURL,n=function(e,t,o,p){if(o)!function(e,t,o){var p,r,a=!1,n=app._root.document.createElement("A");n.href=e.toString(),n.download=i,n.rel="noopener",n.target=o?"_blank":"_self",n.onclick=function(){a=!0,n.remove(),t&&s.revokeObjectURL(e),p&&clearTimeout(p),r&&clearTimeout(r)},p=setTimeout(function(){var t;try{t=new MouseEvent("click"),n.dispatchEvent(t)}catch(e){(t=document.createEvent("MouseEvents")).initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),n.dispatchEvent(t)}clearTimeout(p)},0),r=setTimeout(function(){a||(n.target="_blank",n.click()),clearTimeout(r)},10)}(e,t,p);else{var r=app._root.window.open("",p?"_blank":"_self");r&&r.location?(r.location.href=e,r=null):app._root.window.open(e,p?"_blank":"_self")}},o=function(e,t,o,p){var r,a=o?"attachment/file":"application/octet-stream";try{r=new File([l],i,{type:a})}catch(e){app.error("app.os.fileDownload() > _downloadAttachment","File",null,!0),r=new Blob([l],{type:a})}t?function(e,t,o){try{data=s.createObjectURL(e),n(data,!0,t,o)}catch(e){return app.error("app.os.fileDownload() > _objectURL",e)}}(r,e,p):function(e,t,o){var p=new FileReader;p.onloadend=function(){if(!p.result)throw"data";var e=p.result;n(e,!1,t,o)},p.onerror=function(e){return app.error("app.os.fileDownload() > _blob",e)},p.readAsDataURL(e)}(r,e,p)};try{var l=new Blob([e],{type:t});if(!l)throw"blob"}catch(e){return app.error("app.os.fileDownload",e)}var p="file:"!=app._root.window.location.protocol;if("download"in app._root.window.HTMLAnchorElement.prototype)o(!0),app._runtime.debug&&console.info("app.os.fileDownload",[1,0,0,0],t,i);else if("msSaveOrOpenBlob"in app._root.window.navigator)navigator.msSaveOrOpenBlob(file,i)||o(!0,p,!1,!1),app._runtime.debug&&console.info("app.os.fileDownload",[1,p,0,1],t,i);else if("open"in app._root.window){var r="chrome"==app._runtime.system.name;p="chrome"!=app._runtime.system.name&&p;var a="safari"==app._runtime.system.name,c="safari"==app._runtime.system.name;o(r,p,a,c),app._runtime.debug&&console.info("app.os.fileDownload",[r,p,a,c],t,i)}else o(!0,p,!0,!0),app._runtime.debug&&console.info("app.os.fileDownload",[1,p,1,1],t,i)},app.os.scriptOpen=function(e,t,o,p){if("function"!=typeof e||"string"!=typeof t||o&&"string"!=typeof o)return app.error("app.os.scriptOpen",[e,t,o,p]),e(!1);o=o.toString();var r,a,n,i,s,l,c;if(app._root.window.native)return e(!0);r=t,(a=app._root.document.createElement("script")).src=r,a.async=!0,a.defer=!0,app._root.document.head.appendChild(a),o in app._root.window==!1?(n=o,i=e,s=parseInt(p)||50,l=0,c=setInterval(function(){l++,n in app._root.window!=1&&s!==l||(clearInterval(c),i(!0))},10)):e(!0)},app.os.generateJsonHead=function(e,t){if(!(app._root.window.appe__config||app._root.process.env.appe__config))return app.stop("app.os.generateJsonHead");if(!(e&&"object"==typeof e||t&&t instanceof Date))return app.error("app.os.generateJsonHead",[e,t]);return{checksum:"",date:t=app.utils.dateFormat(t,"Q"),version:app._runtime.version.toString(),release:app._runtime.release.toString()}},app.os.generateJsonChecksum=function(t,e){if("function"!=typeof t&&"string"!=typeof e)return app.error("app.os.generateJsonChecksum",[t,e]),t(!1);CryptoJS&&CryptoJS.MD5||(step=app.error("app.os.generateJsonChecksum","CryptoJS"));try{var o=CryptoJS.MD5(e.length.toString());t(o=o.toString())}catch(e){app.error("app.os.generateJsonChecksum",e),t(!1)}},app.os.getLastFileName=function(){if(!(app._root.window.appe__config||app._root.process.env.appe__config))return app.stop("app.os.getLastFileName");var e="";return app.utils.cookie("has","last_opened_file")&&(e=app.utils.cookie("get","last_opened_file")),e||(e=app.memory.get("last_opened_file")),!!e&&(e=e?app.utils.base64("decode",e):null)},app.os.getLastFileVersion=function(){var e=app._root.server.appe__store;if(!e)return app.stop("app.os.getLastFileVersion","store");var t=e[app._runtime.name.toString()].file;if(!t)return app.error("app.os.getLastFileVersion","data");var o=null;return t.version&&(o=t.version),o},app.os.getLastFileChecksum=function(){var e=app._root.server.appe__store;if(!e)return app.stop("app.os.getLastFileChecksum","store");var t=e[app._runtime.name.toString()].file;if(!t)return app.error("app.os.getLastFileChecksum","data");var o=null;return t.checksum&&(o=t.checksum),o},app.os.getLastFileHead=function(){return{name:app.os.getLastFileName(),version:app.os.getLastFileVersion(),checksum:app.os.getLastFileChecksum()}},app.controller={},app.controller.spoof=function(){var e={view:null,action:null,index:null};if(-1==app._root.window.location.href.indexOf("?"))return e;var t=app._root.window.location.href.split("?")[1];if(-1!=t.indexOf("&"))if(-1!=(t=t.split("&"))[1].indexOf("=")){var o=t[1].split("=");e={view:t[0],action:o[0],index:parseInt(o[1])}}else e={view:t[0],action:t[1]};else e.view=t;return e},app.controller.history=function(e,t){var o=app._runtime.title.toString();e?e+=" â€“ "+o:e=o,"safari"==app._runtime.system.name?app._root.window.location.href=t:history.replaceState(null,e,t),app.controller.setTitle(e)},app.controller.cursor=function(e){return e&&"object"!=typeof e?app.error("app.controller.cursor",[e]):e?(app.memory.set("cursor",e),e):e=app.memory.get("cursor",e)},app.controller.setTitle=function(e){return app._runtime.title=e.toString(),app._root.document.title=app._runtime.title,app._runtime.title},app.controller.getTitle=function(){return app._runtime.title.toString()},app.controller.store=function(e,p,t,o){var r=app._root.server.appe__store;if(!r)return app.stop("app.controller.store","store");if("function"!=typeof e||"string"!=typeof p||"object"!=typeof t||"object"!=typeof o)return app.stop("app.controller.store",[e,p,t,o]);var a=r[p];if(!a)return app.stop("app.controller.store","source");var n=function(e,t){if("string"!=typeof e||"object"!=typeof t)return app.stop("app.controller.store() > _store",[e,t]);if(!a[e])return app.stop("app.controller.store() > _store","source");var o=t;return app.store.set(p+"_"+e,o),o},i=new Date;i=app.utils.dateFormat(i,"Q");var s=Object.keys(o);for(var l in s){var c=s[l],u=o[c];if(-1===t.indexOf(c)||!Object.keys(u).length)return app.stop("app.controller.store","data");r[p][c]=n(c,u)}app.memory.del("save_reminded"),app.memory.set("last_stored",i),e()},app.controller.retrieve=function(e,t){var o=app._root.window.appe__config||app._root.process.env.appe__config;if(!o)return app.stop("app.controller.retrieve");var a=app._root.server.appe__store;if(!a)return app.stop("app.controller.retrieve","store");if("function"!=typeof e||"object"!=typeof t)return app.stop("app.controller.retrieve",[e,t]);if("object"!=typeof o.schema)return app.error("app.controller.retrieve","schema");for(var p=function(e,t){if("string"!=typeof e||"object"!=typeof t)return app.stop("app.controller.retrieve() > _retrieve",[e,t]);if(a[e]&&"object"==typeof a[e])return a[e];for(var o in a={},t){var p=t[o].toString(),r=app.store.get(e+"_"+p);if(!r)return app.stop("app.controller.retrieve() > _retrieve","schema");a[p]=r}return a},r=t.length;r--;){var n=t[r].fn.toString();t[r].file&&(t[r].file="../"+t[r].file.toString()),a[n]=p(n,t[r].schema)}e()},app.controller.clear=function(){var e=app._root.window.appe__config||app._root.process.env.appe__config;if(!e)return app.stop("app.controller.clear");var t=app._root.server.appe__store;if(!t)return app.stop("app.controller.clear","store");var o=app._runtime.name.toString(),p=e.schema;if("object"!=typeof p)return app.error("app.controller.clear","schema");for(var r in p){var a=p[r].toString();app.store.del(o+"_"+a),t[o]&&a in t[o]&&delete t[o][a]}return app.memory.del("last_stored"),!0},app.memory={},app.memory.set=function(e,t){return app.utils.storage(!0,"set",e,t)},app.memory.get=function(e){return app.utils.storage(!0,"get",e)},app.memory.has=function(e,t){return app.utils.storage(!0,"has",e,t)},app.memory.del=function(e){return app.utils.storage(!0,"del",e)},app.memory.reset=function(){return app.utils.storage(!0,"reset")},app.store={},app.store.set=function(e,t){return app.utils.storage(!1,"set",e,t)},app.store.get=function(e){return app.utils.storage(!1,"get",e)},app.store.has=function(e,t){return app.utils.storage(!1,"has",e,t)},app.store.del=function(e){return app.utils.storage(!1,"del",e)},app.store.reset=function(){return app.utils.storage(!1,"reset")},app.start={},app.start.progress=function(e){var t=document.getElementById("start-progress-wait"),o=document.getElementById("start-progress-open");switch(e){case 2:o.setAttribute("style","visibility: visible;"),t.setAttribute("style","visibility: visible;");break;case 1:o.setAttribute("style","visibility: visible;"),t.setAttribute("style","visibility: hidden;");break;default:t.setAttribute("style","visibility: visible;"),o.setAttribute("style","visibility: hidden;")}},app.start.loadComplete=function(e){var t=app._root.window.appe__config||app._root.process.env.appe__config;if(!t)return app.stop("app.start.loadComplete");if(t.file&&"object"!=typeof t.file)return app.error("app.start.loadComplete","config");var o=app._runtime.name.toString(),p=t.schema;if("object"!=typeof p)return app.error("app.start.loadComplete","schema");if(app.start.progress(1),e){e=t.save_path.toString()+"/"+e;var r=t.file&&t.file.heads?t.file.heads.toString():o;app.start.attemptLoad(function(e){e?app.start.redirect(!0):app.start.progress(1)},r,e,p,!0)}},app.start.attemptLoad=function(p,r,e,a,n){var t=app._root.window.appe__config||app._root.process.env.appe__config;if(!t)return app.stop("app.start.attemptLoad");var o=!0;if(t.file&&"object"!=typeof t.file&&(o=app.error("app.start.attemptLoad","config")),CryptoJS&&CryptoJS.MD5||(o=app.error("app.start.attemptLoad","CryptoJS")),!app._runtime.encryption||CryptoJS&&CryptoJS.SHA512&&CryptoJS.AES||(o=app.error("app.start.attemptLoad","CryptoJS")),"function"==typeof p&&r&&"string"==typeof r&&e&&"string"==typeof e&&"object"==typeof a||(o=app.stop("app.start.attemptLoad",[p,r,e,a,n])),!o)return p(!1);app._runtime.name.toString();r=r.toString();t.file&&t.file.binary?t.file.binary:app._runtime.binary;var i=t.file&&t.file.compress?!!t.file.compress:!!app._runtime.compression,s=t.file&&t.file.crypt?!!t.file.crypt:!!app._runtime.encryption;if(i)return app.error("app.start.attemptLoad","Misleading settings.","compression",!0),p(!1);var l=null,c=function(e,t){if(!app.checkFile(e,l))return t("check");for(var o in a){var p=a[o].toString();if(p in e==!1)return t("schema");app.store.set(r+"_"+p,e[p])}t(!1,!0)},u=!1,f=parseInt(t.open_attempts);app.os.scriptOpen(function(t,e){if(r in app._root.window==0)return app.error("app.start.attemptLoad() > _attempt","source"),p(!1);try{if(t=app._root.window[r],s)!function(e,t){var o=null;if(!(app._runtime.secret&&"string"==typeof app._runtime.secret&&app._runtime.secret in app._root.document))return t("runtime");o=app._root.document[app._runtime.secret];try{if(!(e=(e=CryptoJS.AES.decrypt(e,o,{mode:CryptoJS.mode.CTR,padding:CryptoJS.pad.NoPadding})).toString(CryptoJS.enc.Utf8)))throw"decryption";t(!1,e)}catch(e){t(e)}}(t,function(e,t){if(e)throw e;if(!n)return p(!1);app.os.generateJsonChecksum(function(e){if(!e)throw null;l=e,t=JSON.parse(t),c(t,function(e,t){if(e)throw e;p(t)})},t)});else if(n){var o=JSON.stringify(t);app.os.generateJsonChecksum(function(e){if(!e)throw null;l=e,c(t,function(e,t){if(e)throw e;p(t)})},o)}else p(!1)}catch(e){app.error("app.start.attemptLoad() > _attempt",e),p(u)}},e,r,f)},app.start.redirect=function(e){setTimeout(function(){app.start.progress(0),app.redirect(),this.clearTimeout()},1e3)},app.start.alternative=function(){var e=app._root.window.appe__config||app._root.process.env.appe__config;if(!e)return app.stop("app.start.alternative");if("object"!=typeof e.alt||!e.alt.exec_folder||!e.alt.exec_platform)return app.error("app.start.alternative","config");var t=app.utils.system(),o={chrome:"Chrome",safari:"Safari",firefox:"Firefox",edge:"Edge",ie:"Explorer",iemobile:"Explorer"}[t.name],p=t.platform in e.alt.exec_platform?t.platform:null,r="";if(r=app.i18n("This application cannot be run due to restrictions into the software {{browser}}.",null,o),p&&e.alt.exec_folder&&e.alt.exec_folder){var a=e.alt.exec_folder.toString(),n=p in e.alt.exec_platform?e.alt.exec_platform[p].toString():"";r+=app.i18n('GO TO FOLDER "{{alt_exec_folder}}" AND OPEN "{{alt_exec_platform}}."',null,{alt_exec_folder:a,alt_exec_platform:n})}r=r.replace("{browser}",o),app.start.progress(1),app.error(r),app.blind()},app.start.load=function(){var e=app._root.window.appe__config||app._root.process.env.appe__config;if("object"!=typeof e)return app.stop("app.start.load");var p=Object.assign?Object.assign({},e):app.utils.extendObject({},e);"secret_passphrase"in e&&delete e.secret_passphrase,app.checkConfig(p);var t=!0;null==app._root.window.native&&("sessionStorage"in window==0&&"localStorage"in window==0||"FileReader"in window==0||"Blob"in window==0||"history"in window==0||"atob"in window==0||"btoa"in window==0?t=!1:void 0!==sessionStorage&&"replaceState"in history!=!1&&"checkValidity"in document.createElement("form")!=!1||(t=!1));var r=function(){var e=!(void 0===app._root.server.appe__locale),t=document.getElementById("start-action-open"),o=document.getElementById("start-action-new");app.utils.addEvent("click",t,app.openSession),app.utils.addEvent("click",o,app.newSession),e&&function(){var e=app._root.document.querySelectorAll("[data-localize]");e.length&&Array.prototype.forEach.call(e,function(e){app.layout.localize(e)})}()};app.session(function(){if("secret_passphrase"in p&&delete p.secret_passphrase,t){app.controller.setTitle(p.app_name),null==app._root.document.native&&r();var o=app.resume(p);!function(t){var e=p.aux&&"object"==typeof p.aux?p.aux:[];if(e.length)for(var o=e.length;o--;)app.start.attemptLoad(function(e){return e?o?void 0:t(!1,!0):t("aux")},e[o].fn,e[o].file,e[o].schema,e[o].memoize);else t(!1,!0)}(function(e,t){if(e)return app.stop("app.start.load","aux");app.start.loadComplete(o)})}else p.alt&&start&&"alternative"in start&&"function"==typeof start.alternative?start.alternative():p.alt?app.start.alternative():app.blind()},p)},app.main={},app.main.control=function(e){var t=app._root.window.appe__config||app._root.process.env.appe__config;if(!t)return app.stop("app.main.control");if(!t.routes||"object"!=typeof t.routes||!t.events||"object"!=typeof t.events)return app.error("app.main.control","config");for(var o=t.routes,p=t.events,r=Object.keys(p),a=null,n=0,i={};a=r[n++];)i[p[a]]=a;e||(e=app.controller.spoof());var s=t.default_route.toString(),l=s+".html",c=!0;if(e&&"object"==typeof e?e.view?(o[e.view]?l=encodeURIComponent(e.view)+".html":c=!1,e.action&&(o[e.view][e.action]?(l=o[e.view][e.action].toString()+".html",l+="?"+encodeURIComponent(e.action)):c=!1,e.index&&(l+="&id="+encodeURIComponent(e.index)))):e={view:s}:c=!1,!c||"string"!=typeof l)return app.stop("app.main.control",[e]);if(app.controller.cursor(e),!app._root.document.native){var u="views/"+l,f=app._root.document.getElementById("view");f.removeAttribute("height"),f.setAttribute("src",u),"list"==i[e.action]?app._root.document.body.classList.add("full-width"):app._root.document.body.classList.remove("full-width");var d=app._root.document.getElementById("master-navigation"),m=d.querySelector("li.active"),v=d.querySelector('a[data-view="'+e.view+'"]');m&&m.classList.remove("active"),v&&v.parentNode.classList.add("active")}},app.main.handle=function(e){var t=app._root.window.appe__config||app._root.process.env.appe__config;if(!t)return app.stop("app.main.handle");if(!t.events||"object"!=typeof t.events)return app.error("app.main.handle","config");var o=app._root.server.appe__main,p=app.main.handle.prototype;if(!e.data)return app.error("app.main.handle",[e]);try{p.ctl=JSON.parse(e.data)}catch(e){return app.error("app.main.handle",e)}var r=t.events;return p.events=app.utils.extendObject(r,{resize:"resize",refresh:"refresh",export:"export"}),p.event=null,p.ctl.action&&p.ctl.action in p.events?(p.event=p.ctl.action,p._initialized=!0,p.loc=Object.assign?Object.assign({},p.ctl):app.utils.extendObject({},p.ctl),p._href="",p._title="",p._msg="",o&&"handle"in o&&"function"==typeof o.handle?o.handle(p,p.event,p.ctl):p[p.event].apply(p)):app.error("app.main.handle",p.ctl)},app.main.handle.prototype.getID=function(){return parseInt(this.ctl.index)},app.main.handle.prototype.setAction=function(){return this.ctl.action in this.events==!1?app.error("app.main.prototype.setAction","ctl"):(this.loc.action=this.events[this.loc.action].toString(),this.loc.action)},app.main.handle.prototype.getAction=function(){return this.loc.action?this.loc.action:app.error("app.main.prototype.setAction","loc")},app.main.handle.prototype.setTitle=function(e){return e&&"string"==typeof e?(this._title=e,this._title):app.error("app.main.handle.prototype.setTitle","title")},app.main.handle.prototype.getTitle=function(){return this._title?this._title:this.ctl.title&&"string"==typeof this.ctl.title&&this.ctl.title},app.main.handle.prototype.setMsg=function(e){return e&&"string"==typeof e?(this._msg=e,this._msg):app.error("app.main.handle.prototype.setMsg","msg")},app.main.handle.prototype.getMsg=function(){return this._msg?this._msg:this.ctl.msg&&"string"==typeof this.ctl.msg&&this.ctl.msg},app.main.handle.prototype.setURL=function(e,t){var o="index.html";return o+=(e||this.ctl.view)&&"?"+(e&&"string"==typeof e?e:this.ctl.view),o+=t&&"&"+(t&&"string"==typeof t&&t),this._href=o,this._href},app.main.handle.prototype.getURL=function(){return this._href},app.main.handle.prototype.redirect=function(){var e=this.getURL();app._root.window.location.href=e},app.main.handle.prototype.refresh=function(){app._root.window.location.reload()},app.main.handle.prototype.resize=function(){if(this.ctl.height){var e=parseInt(this.ctl.height),t=app._root.document.getElementById("view");t.height=e,t.scrolling="no"}},app.main.handle.prototype.selection=function(){this.refresh()},app.main.handle.prototype.export=function(){if(!Blob)return app.error("app.main.handle.prototype.export","Blob");if(!FileReader)return app.error("app.main.handle.prototype.export","FileReader");if(!this.ctl.data||!this.ctl.file||"object"!=typeof this.ctl.file)return app.error("app.main.handle.prototype.export","ctl");if(!this.ctl.file.name||"string"!=typeof this.ctl.file.name||!this.ctl.file.type||"string"!=typeof this.ctl.file.type)return app.error("app.main.handle.prototype.export","file");try{app.os.fileDownload(this.ctl.data,this.ctl.file.name,this.ctl.file.type)}catch(e){return app.error("app.main.handle.prototype.export",e)}},app.main.handle.prototype.prepare=function(){var e=this.setAction(),t=this.getID();this.setURL(null,e+(t&&"="+t)),this.ctl.history&&this.history(),this.receiver()},app.main.handle.prototype.prevent=function(){var e=this.setAction(),t=this.getMsg();if(!t)return app.error("app.main.handle.prototype."+this.event,"msg");this.setURL(null,e),confirm(t)&&this.receiver()},app.main.handle.prototype.open=app.main.handle.prototype.prepare,app.main.handle.prototype.add=app.main.handle.prototype.prepare,app.main.handle.prototype.edit=app.main.handle.prototype.prepare,app.main.handle.prototype.update=app.main.handle.prototype.prepare,app.main.handle.prototype.delete=app.main.handle.prototype.prevent,app.main.handle.prototype.close=app.main.handle.prototype.prevent,app.main.handle.prototype.history=function(){var e=this.getTitle(),t=this.getURL();app.controller.history(e,t)},app.main.handle.prototype.receiver=function(){var e=app._root.window.appe__config||app._root.process.env.appe__config;if(!e)return app.stop("app.main.handle.prototype.receiver");var t=e.schema;if("object"!=typeof t)return app.error("app.main.handle.prototype.receiver","schema");var o=app._runtime.name.toString();if(this.ctl.submit&&this.ctl.data){var p=this.getAction();try{var r=this,a=JSON.parse(this.ctl.data);app.controller.store(function(){var e=app.controller.spoof();e.action=null,e.index=null,"update"===p?r.refresh():app.main.control(e)},o,t,a)}catch(e){return app.error("app.main.handle.prototype.receiver",e)}}else app.main.control(this.loc)},app.main.action=function(e,t,o){if(!(app._root.window.appe__config||app._root.process.env.appe__config))return app.stop("app.main.action");app._root.server.appe__main;var p=app.main.action.prototype;return e&&e instanceof Array==!1||!t||!o?app.error("app.main.action",[e,t,o]):(this._initialized=!1,p)},app.main.action.prototype.isInitialized=function(e){if(!this._initialized)return app.error("app.main.action.prototype.isInitialized",e)},app.main.action.prototype.begin=function(){this._initialized=!0},app.main.action.prototype.end=function(){this.isInitialized("end"),this._initialized=!1},app.main.action.prototype.menu=function(e,t,o,p){if(this.isInitialized("menu"),!("jQuery"in app._root.window&&"collapse"in jQuery.fn)){if(void 0===e)return app.error("app.main.action.prototype.menu",[e,t,o,p]);if(o=o||app._root.document.querySelector(e.getAttribute("data-target")),p=p||e,!o.getAttribute("data-is-visible")){o.setAttribute("data-is-visible","true"),o.setAttribute("aria-expanded","false"),p.setAttribute("aria-expanded","false");var r="ontouchstart"in document.documentElement?"touchstart":"click";o.collapse=new app.layout.collapse(null,p,o),app.utils.addEvent(r,app._root.document.documentElement,function(e){e.target.parentNode.parentNode.parentNode&&e.target.parentNode.parentNode.parentNode==o||o.collapse.close(e)})}app._root.window.scrollTo(0,0),o.collapse.toggle(null)}},app.main.setup=function(){var e=app._root.server.appe__main;e&&"setup"in e&&"function"==typeof e.setup&&e.setup(app.data()),app.main.control()},app.main.load=function(){var e=app._root.window.appe__config||app._root.process.env.appe__config;if("object"!=typeof e)return app.stop("app.main.load");var t=Object.assign?Object.assign({},e):app.utils.extendObject({},e);"secret_passphrase"in e&&delete e.secret_passphrase,app.checkConfig(t);var o=function(){var e=!(void 0===app._root.server.appe__locale);app._root.document.getElementById("brand");brand.innerHTML=app.controller.getTitle();var t=app._root.document.querySelectorAll(".main-action-open"),o=app._root.document.querySelectorAll(".main-action-new"),p=app._root.document.querySelectorAll(".main-action-save");app._root.document.querySelectorAll("[data-localize]");t.length&&Array.prototype.forEach.call(t,function(e){app.utils.addEvent("click",e,app.openSession)}),o.length&&Array.prototype.forEach.call(o,function(e){app.utils.addEvent("click",e,app.newSession)}),p.length&&Array.prototype.forEach.call(p,function(e){app.utils.addEvent("click",e,app.saveSession)}),e&&function(){var e=app._root.document.querySelectorAll("[data-localize]");e.length&&Array.prototype.forEach.call(e,function(e){app.layout.localize(e)})}()};app.session(function(){"secret_passphrase"in t&&delete t.secret_passphrase,app.resume(t,!0);var e=t.aux&&"object"==typeof t.aux?t.aux:[];e.push({file:"",fn:app._runtime.name,schema:t.schema}),app.controller.retrieve(app.main.setup,e),app.controller.setTitle(t.app_name),app.utils.addEvent("message",app._root.window,app.main.handle),null==app._root.document.native&&o()},t,!0)},app.main.unload=function(){if(!app.memory.has("save_reminded")&&app.memory.get("last_time")!==app.memory.get("last_stored"))return app.memory.set("save_reminded",!0),!0},app.view={},app.view.spoof=function(){var e={action:null,index:null};if(-1==app._root.window.location.href.indexOf("?"))return e;var t=app._root.window.location.href.split("?")[1];if(-1!=t.indexOf("&"))if(-1!=(t=t.split("&"))[1].indexOf("=")){var o=t[1].split("=");e={action:t[0],index:parseInt(o[1])}}else e={action:t[1]};return e},app.view.control=function(e,t,o){if(!(app._root.window.appe__config||app._root.process.env.appe__config))return app.stop("app.view.control");if(!app._root.server.appe__control)return app.error("app.view.control","control");var p=!(void 0===app._root.server.appe__locale),r=app.view.control.prototype;return e&&e instanceof Array==!1||t&&"object"!=typeof t?app.error("app.view.control",[e,t,o]):(r._initialized=!1,r._is_localized=p,r.events=e||null,r.data=t||{},r.form=o||null,r.ctl={},r)},app.view.control.prototype.isInitialized=function(e){if(!this._initialized)return app.error("app.view.control.prototype.isInitialized",e)},app.view.control.prototype.begin=function(){var e=app._root.window.appe__config||app._root.process.env.appe__config;if(!e)return app.stop("app.view.control.prototype.begin");if(!e.routes||"object"!=typeof e.routes||!e.events||"object"!=typeof e.events)return app.error("app.view.control.prototype.begin","config");var t=app.controller.cursor(),o=null,p=null,r=0;t&&"view"in t&&(o=t.view);var a=e.routes,n=e.events,i={};Array.prototype.forEach.call(Object.keys(n),function(e){i[n[e]]=e});var s=app.view.spoof(),l=e.default_event.toString(),c=!0;return s&&"object"==typeof s?s.action?(a[o][s.action]?p=i[s.action]:c=!1,s.index&&(r=s.index)):p=l:c=!1,this.events&&-1===this.events.indexOf(p)||!c?app.error("app.view.control.prototype.begin","event"):(control.temp={},this._initialized=!0,p&&"add"===(p=this.setEvent(p))&&(r=this.getLastID()),r=this.setID(r))},app.view.control.prototype.end=function(){if(this.isInitialized("end"),app.view.resize(!0),this.form){control.temp.form=!0,control.temp.form_submit=!1,control.temp.form_elements=this.form.elements,control.temp.form_changes=null;try{var e=app.view.getFormData(this.form.elements);control.temp.form_changes=e&&JSON.stringify(e)}catch(e){return app.error("app.view.control.prototype.end",e)}}_initialized=!1},app.view.control.prototype.setID=function(e){return this.isInitialized("setID"),control.temp.id=parseInt(e),control.temp.id},app.view.control.prototype.getID=function(){return this.isInitialized("getID"),control.temp.id?parseInt(control.temp.id):(app.error("app.view.control.prototype.getID","id"),0)},app.view.control.prototype.getLastID=function(){this.isInitialized("getLastID");var e=Object.keys(this.data).pop();return e?parseInt(e)+1:1},app.view.control.prototype.setEvent=function(e){return this.isInitialized("setEvent"),this.events&&-1===this.events.indexOf(e)?app.error("app.view.control.prototype.setEvent","event"):(control.temp.event=e.toString(),control.temp.event)},app.view.control.prototype.getEvent=function(){return this.isInitialized("getEvent"),control.temp.event.toString()},app.view.control.prototype.setTitle=function(e,t,o){this.isInitialized("setTitle");var p=this.getEvent();o=0!=o?parseInt(o):app.view.control.prototype.getID(),"edit"===p&&o&&("rtl"==app._runtime.locale_dir?e="# "+o+" "+e:e+=" # "+o);var r=app._root.document.getElementById("view-title"),a=app._root.document.getElementById("section-title");null!=t&&(r.innerHTML=t),null!=e&&(a.innerHTML=e)},app.view.control.prototype.setActionHandler=function(e,t){this.isInitialized("setActionHandler");var o=this.getEvent();t=parseInt(t)||this.getID();var p=app._root.document.getElementById("submit"),r=app._root.document.getElementById("index");if(!r)return app.error("app.view.control.prototype.setActionHandler","action_index");if(r.setAttribute("value",t),p){var a=p.getAttribute("onclick");a=a.replace("{action_event}",o),p.setAttribute("onclick",a)}e&&"string"==typeof e&&(p.innerHTML=e)},app.view.control.prototype.denySubmit=function(){this.isInitialized("denySubmit");var e=app._root.document.getElementById("submit");e&&(e.removeAttribute("onclick"),e.setAttribute("disabled","")),this.form&&this.form.setAttribute("action","")},app.view.control.prototype.fillTable=function(e,t,o){if(this.isInitialized("fillTable"),!e)return app.error("app.view.control.prototype.fillTable",[e,t,o]);var p=t;t&&"object"==typeof t||(p=this.data),o=o&&o instanceof Array?o:Object.keys(p);var r=Object.values(arguments).slice(3),a=e.querySelector("tbody"),n=a.querySelector("tr.tpl").cloneNode(!0);n.classList.remove("tpl");var i="";return"renderRow"in control&&"function"==typeof control.renderRow&&(Array.prototype.forEach.call(o,function(e){var t=control.renderRow(n,e,p[e],r);i+=t.outerHTML}),a.innerHTML=i,this._is_localized&&this.localize(e)),{rows:i,tpl:n,data:p,args:r}},app.view.control.prototype.fillForm=function(e,t){if(this.isInitialized("fillForm"),!this.form)return app.error("app.view.control.prototype.fillForm",[e,t]);var o=t;t&&"object"==typeof t||(o=this.data);var p=Object.values(arguments).slice(2);return"fillForm"in control&&"function"==typeof control.fillForm&&(control.fillForm(o,p),this._is_localized&&this.localize(e)),{data:o,args:p}},app.view.control.prototype.fillSelection=function(e,t){if(this.isInitialized("fillSelection"),!e||"object"!=typeof e)return app.error("app.view.control.prototype.fillSelection",[e,t]);var o=app._root.document.getElementById("selection");(t=t||null)?(o.innerHTML=app.layout.renderSelectOptions(o,e,t),o.value=t):o.parentNode.classList.add("hidden")},app.view.control.prototype.fillCTA=function(e){this.isInitialized("fillCTA"),e=parseInt(e);var t=app._root.document.getElementById("section-actions-top"),o=app._root.document.getElementById("section-actions-bottom");t&&(e?t.innerHTML=t.innerHTML.replace(/\{id\}/g,e):Array.prototype.forEach.call(t.querySelectorAll(".action"),function(e){e.remove()})),o&&(e?o.innerHTML=o.innerHTML.replace(/\{id\}/g,e):Array.prototype.forEach.call(o.querySelectorAll(".action"),function(e){e.remove()}))},app.view.control.prototype.localize=function(e){if(this.isInitialized("localize"),!e)return app.error("app.view.control.prototype.localize",[e]);var t=e.querySelectorAll("[data-localize]");t.length&&Array.prototype.forEach.call(t,function(e){app.layout.localize(e)})},app.view.action=function(e,t,o,p){var r=app._root.window.appe__config||app._root.process.env.appe__config;if(!r)return app.stop("app.view.action");if(!app._root.server.appe__control)return app.error("app.view.action","control");var a=!(void 0===app._root.server.appe__locale),n=app.view.action.prototype;return e&&e instanceof Array==!1||!t||!o?app.error("app.view.action",[e,t,o,p]):(n._initialized=!1,n._is_localized=a,r.events&&"object"==typeof r.events?(n.cfg_events=r.events,n.events=e,n.event=t.toString(),n.element=o,n.form=p||null,n.ctl={},n):app.error("app.view.action","config"))},app.view.action.prototype.isInitialized=function(e){if(!this._initialized)return app.error("app.view.action.prototype.isInitialized",e)},app.view.action.prototype.begin=function(){if(this.events&&-1===this.events.indexOf(this.event))return app.error("app.view.action.prototype.begin","event");this._initialized=!0},app.view.action.prototype.end=function(){this.isInitialized("end"),this._initialized=!1},app.view.action.prototype.getID=function(){this.isInitialized("getID");var e=0;try{e=this.element.parentNode.parentNode.getAttribute("data-index")}catch(e){}return!e&&control.temp.id&&(e=control.temp.id),parseInt(e)},app.view.action.prototype.validateForm=function(){if(this.isInitialized("validateForm"),!this.form)return app.error("app.view.action.prototype.validateForm","form");var e=app._root.document.getElementById("real-submit");return e?!this.form.checkValidity()&&(Array.prototype.forEach.call(this.form.elements,function(e){var t=null;-1!=e.parentNode.className.indexOf("form-group")?t=e.parentNode:-1!=e.parentNode.parentNode.className.indexOf("form-group")&&(t=e.parentNode.parentNode),t&&t.classList&&(t.querySelector(":invalid")?(t.classList.remove("has-success"),t.classList.add("has-error")):(t.classList.remove("has-error"),t.classList.add("has-success")))}),e.click(),!0):app.error("app.view.action.prototype.validateForm","action_submit")},app.view.action.prototype.prepare=function(e,t){if(this.isInitialized(this.event),e&&"object"!=typeof e)return app.error("app.view.action.prototype."+this.event,[e,t]);var o=this.getID(),p=self.cfg_events?self.cfg_events[this.event].toString():this.event;try{if(this.ctl.action=this.event,o&&(this.ctl.index=parseInt(o),"update"!=this.event&&(this.ctl.history=!0,this.ctl.title=this.ctl.title&&"string"==typeof this.ctl.title?'"'+this.ctl.index+'"':"# "+this.ctl.index,p&&(p=p[0].toUpperCase()+p.slice(1),this._is_localized&&(p=app.i18n(p,"action")||p),this.ctl.title="rtl"==app._runtime.locale_dir?this.ctl.title+" "+p:p+" "+this.ctl.title))),!0===t&&(this.ctl.submit=!0,this.ctl.data=JSON.stringify(e),control.temp.form)){control.temp.form_submit=!0;var r=app.view.getFormData(this.form.elements);control.temp.form_changes=r&&JSON.stringify(r)}return this.ctl}catch(e){return app.error("app.view.action.prototype."+this.event,e)}},app.view.action.prototype.prevent=function(e,t,o,p){if(!(app._root.window.appe__config||app._root.process.env.appe__config))return app.stop("app.view.action.prototype.prevent");if(this.isInitialized(this.event),"string"!=typeof o||e&&"object"!=typeof e)return app.error("app.view.action.prototype."+this.event,[e,t,o,p]);var r=self.cfg_events?self.cfg_events[this.event].toString():this.event;return this._is_localized&&(r=app.i18n(r,"event")||r),!o||"number"!=typeof p&&"string"!=typeof p?this.ctl.msg=o:(p="rtl"==app._runtime.locale_dir?"number"==typeof p?parseInt(p)+" #":'"'+p+'"':"number"==typeof p?"# "+parseInt(p):'"'+p+'"',this.ctl.msg=app.i18n("Are you sure to {{placeholder}} {{name}} {{title}}?","action",{placeholder:r,name:p,title:o})),this.prepare(e,t)},app.view.action.prototype.open=app.view.action.prototype.prepare,app.view.action.prototype.add=app.view.action.prototype.prepare,app.view.action.prototype.edit=app.view.action.prototype.prepare,app.view.action.prototype.update=app.view.action.prototype.prepare,app.view.action.prototype.delete=app.view.action.prototype.prevent,app.view.action.prototype.close=app.view.action.prototype.prevent,app.view.action.prototype.selection=function(){this.isInitialized("selection");var e={id:this.element.value?this.element.value.toString():""};return this.prepare(e,!0)},app.view.action.prototype.print=function(){this.isInitialized("print"),print()},app.view.sub=function(e,t,o){if(!(app._root.window.appe__config||app._root.process.env.appe__config))return app.stop("app.view.sub");var p=app.view.sub.prototype;return e&&t?p[e](t,o):app.error("app.view.sub",[e,t,o])},app.view.sub.prototype.csv=function(e,t){var o=app._root.window.appe__config||app._root.process.env.appe__config;if(!o)return app.stop("app.view.sub.prototype.csv");if(!e||!t)return app.error("app.view.sub.prototype.csv",[e,t]);var p="",r=app.view.convertTableCSV(t);Array.prototype.forEach.call(r,function(e){p+=e.join(";")+"\r\n"});var a="csv_export",n="_",i="Y-m-d_H-M-S";o.csv&&"object"==typeof o.csv&&(a=o.csv.filename_prefix.toString(),n=o.csv.filename_separator.toString(),i=o.csv.filename_date_format.toString());var s=a,l={action:"export",file:{name:(s+=n+app.utils.dateFormat(!0,i))+".csv",type:"text/csv;charset=utf-8"},data:p};return app.view.send(l)},app.view.sub.prototype.clipboard=function(e,t,o,p){if(!e||!t)return app.error("app.view.sub.prototype.clipboard",[e,t]);var r="",a=app.view.convertTableCSV(t);Array.prototype.forEach.call(a,function(e){r+=e.join("\t")+"\r\n"}),app.view.copyToClipboard(r);var n=e.parentNode.parentNode.parentNode;o=o||n.querySelector(".dropdown-menu"),(p=p||n.querySelector(".dropdown-toggle")).classList.add("btn-gray-lighter");var i=setTimeout(function(){p.classList.remove("btn-gray-lighter"),clearTimeout(i)},1e3)},app.view.sub.prototype.toggler=function(e,t,o,p){if(!("jQuery"in app._root.window&&"dropdown"in jQuery.fn)){if(void 0===e)return app.error("app.view.sub.prototype.toggler",[e]);var r=e.parentNode.parentNode;if(p=p||e,!(o=o||r.querySelector(".dropdown-menu")).getAttribute("data-is-visible")){o.setAttribute("data-is-visible","true");var a="ontouchstart"in document.documentElement?"touchstart":"click";o.dropdown=new app.layout.dropdown(null,p,o),app.utils.addEvent(a,app._root.document.documentElement,o.dropdown.close)}o.dropdown.toggle(null)}},app.view.handle=function(){if(!(app._root.window.appe__config||app._root.process.env.appe__config))return app.stop("app.view.handle");var e=app._root.server.appe__control;if(!e)return app.error("app.view.handle","control");"handle"in e&&"function"==typeof e.handle&&e.handle(app.data()),app.utils.addEvent("resize",app._root.window,app.view.resize),app.utils.addEvent("orientationchange",app._root.window,app.view.resize)},app.view.send=function(e){if(!(app._root.window.appe__config||app._root.process.env.appe__config))return app.stop("app.view.action");if(!app._root.server.appe__control)return app.error("app.view.action","control");if(e){if("object"!=typeof e)return app.error("app.view.send",[e]);if("view"in e==!1){var t=app.controller.cursor();t&&"view"in t&&(e.view=t.view)}if("action"in e!=!1)try{app._runtime.debug&&console.info("app.view.send",e),e=JSON.stringify(e),app._root.window.parent.postMessage(e,"*")}catch(e){return app.error("app.view.send",e)}}},app.view.resize=function(e){var t=app._root.server.appe__control;if(t&&t.temp){if(e){if((new Date).getTime()-t.temp.last_resize<1e3)return;t.temp.last_resize=(new Date).getTime()}var o={action:"resize",height:app._root.document.documentElement.scrollHeight};return app.view.send(o)}},app.view.getFormData=function(e){if(!e||!e.length)return app.error("app.view.getFormData",[e]);for(var t={},o={},p=0;o=e[p++];)if("FIELDSET"!=o.nodeName){var r=o.name,a=o.value.trim(),n=o.getAttribute("data-transform")||!1,i=o.getAttribute("data-sanitize")||!1;if(o.type&&("checkbox"!=o.type&&"radio"!=o.type||(a=!!o.checked)),n&&(a=app.utils.transform(n,a)),i&&(a=app.utils.sanitize(i,a)),void 0===a&&(a=null),r){r=r.match(/([\w]+)/g,"$1");var s={};Array.prototype.reduce.call(r,function(e,t,o){return e[t]=o!=r.length-1&&{}||a},s),app.utils.extendObject(!0,t,s)}}return t},app.view.convertTableCSV=function(e){if(!e)return app.error("app.view.convertTableCSV",[e]);var t=e.querySelectorAll("thead tr:not(.hidden-csv) th"),o=e.querySelectorAll("tbody tr:not(.hidden-csv)"),p=[[]];Array.prototype.forEach.call(t,function(e){e.classList.contains("hidden-print")||p[0].push(e.textContent)});var r=0;return Array.prototype.forEach.call(o,function(e){if(!e.classList.contains("tpl")){var t=e.querySelectorAll("td");p[++r]=[],Array.prototype.forEach.call(t,function(e){if(!e.classList.contains("hidden-print")){var t=e.querySelector(".form-control");t?p[r].push(t.value):p[r].push(e.textContent)}})}}),p},app.view.copyToClipboard=function(e){if(!e)return app.error("app.view.copyToClipboard",[e]);var t=app._root.document.createElement("TEXTAREA");if(t.style="position: absolute; top: 0; right: 0; width: 0; height: 0; z-index: -1; overflow: hidden;",t.value=e,app._root.document.body.appendChild(t),"ios"!=app._runtime.system.platform)t.focus(),t.select();else{var o=app._root.document.createRange();o.selectNodeContents(t);var p=getSelection();p.removeAllRanges(),p.addRange(o),t.setSelectionRange(0,999999)}app._root.document.execCommand("copy"),app._root.document.body.removeChild(t)},app.view.load=function(){var e=app._root.window.appe__config||app._root.process.env.appe__config;if("object"!=typeof e)return app.stop("app.view.load");var t=Object.assign?Object.assign({},e):app.utils.extendObject({},e);"secret_passphrase"in e&&delete e.secret_passphrase;var o=function(){!(void 0===app._root.server.appe__locale)&&function(){var e=app._root.document.querySelectorAll("[data-localize]");e.length&&Array.prototype.forEach.call(e,function(e){app.layout.localize(e)})}()};app.session(function(){"secret_passphrase"in t&&delete t.secret_passphrase,app.resume(t,!1);var e=t.aux&&"object"==typeof t.aux?t.aux:[];e.push({fn:app._runtime.name,schema:t.schema}),app.controller.retrieve(app.view.handle,e),null==app._root.document.native&&o()},t,!1)},app.view.unload=function(){var e=app._root.server.appe__control;if(!e)return app.error("app.view.unload","control");if(e.temp.form&&!e.temp.form_submit){try{var t=app.view.getFormData(e.temp.form_elements);t=t&&JSON.stringify(t)}catch(e){return app.error("app.view.unload",e)}if(e.temp.form_changes!==t)return!0}},app.layout={},app.layout.renderElement=function(e,t,o){if("string"!=typeof e||t&&"string"!=typeof t||o&&"object"!=typeof o)return app.error("app.layout.renderElement",[e,t,o]);var p=e.toLowerCase(),r="<"+p;if(o){var a=Object.keys(o);for(var n in a)null!==o[a[n]]&&(n!=a.length&&(r+=" "),r+=o[a[n]]?a[n]+'="'+o[a[n]].toString()+'"':a[n])}return r+=t?">"+t+"</"+p+">":">"},app.layout.renderSelect=function(e,t,o,p){if(!e||"object"!=typeof t)return app.error("app.layout.renderSelectOptions",[e,t,o,p]);var r=app.utils.extendObject({id:e},p),a="";return t&&(a=app.layout.renderSelectOptions(e,t,o)),app.layout.renderElement("select",a,r)},app.layout.renderSelectOption=function(e,t,o){return e&&t?app.layout.renderElement("option",t,{value:e,selected:o?"":null}):app.error("app.layout.renderSelectOption",[e,t,o])},app.layout.renderSelectOptionGroup=function(e,t){return e&&t?app.layout.renderElement("optgroup",t,{label:e}):app.error("app.layout.renderSelectOptionGroup",[e,t])},app.layout.renderSelectOptions=function(e,t,r){if(!e||"object"!=typeof t)return app.error("app.layout.renderSelectOptions",[e,t,r]);var a="";return Array.prototype.forEach.call(t,function(e){var t=Object.keys(e)[0],o=e[t];if(o instanceof Array){var p="";Array.prototype.forEach.call(o,function(e){if("object"==typeof e)var t=e[o=Object.keys(e)[0]];else var o=t=e;p+=app.layout.renderSelectOption(o,t,r)}),a+=app.layout.renderSelectOptionGroup(t,p)}else a+=app.layout.renderSelectOption(t,o,r)}),a},app.layout.dropdown=function(e,t,o,p){if(void 0===e||!t||!o)return app.error("app.view.dropdown",[e,t,o,p]);var r=app.layout.dropdown.prototype;return r.dropdown=o,r.toggler=t,r.callback="function"==typeof p?p:null,r.dropdown._dropdown||(r.dropdown._dropdown={toggler:t}),e?app.utils.proxy(!1,r[e],r.dropdown,r.callback):app.utils.proxy(!0,r,r.dropdown,r.callback)},app.layout.dropdown.prototype.open=function(e,t,o){if(app._runtime.debug&&console.info("app.layout.dropdown.prototype.open",e&&e.target,e),e&&e.preventDefault&&e.preventDefault(),"true"!==t.getAttribute("aria-expanded")&&(!e||!e.target||e.target!==t.toggler&&e.target.offsetParent!==t.toggler))return t._dropdown.toggler.parentNode.classList.add("open"),t._dropdown.toggler.setAttribute("aria-expanded","true"),t.classList.add("open"),t.setAttribute("aria-expanded","true"),o&&"function"==typeof o&&o.apply(this,[e,t]),!(e&&!e.preventDefault)&&void 0},app.layout.dropdown.prototype.close=function(e,t,o){if(app._runtime.debug&&console.info("app.layout.dropdown.prototype.close",e&&e.target,e),e&&e.preventDefault&&e.preventDefault(),"false"!==t.getAttribute("aria-expanded")&&(!e||!e.target||e.target!==t._dropdown.toggler&&e.target.offsetParent!==t._dropdown.toggler))return t._dropdown.toggler.parentNode.classList.remove("open"),t._dropdown.toggler.setAttribute("aria-expanded","false"),t.classList.remove("open"),t.setAttribute("aria-expanded","false"),o&&"function"==typeof o&&o.apply(this,[e,t]),!(e&&!e.preventDefault)&&void 0},app.layout.dropdown.prototype.toggle=function(e,t,o){if(app._runtime.debug&&console.info("app.layout.dropdown.prototype.toggle",e&&e.target,e),e&&e.preventDefault&&e.preventDefault(),!e||!e.target||e.target!==t._dropdown.toggler&&e.target.offsetParent!==t._dropdown.toggler)return"false"===t._dropdown.toggler.getAttribute("aria-expanded")?app.layout.dropdown.prototype.open.call(null,t):app.layout.dropdown.prototype.close.call(null,t),o&&"function"==typeof o&&o.apply(this,[e,t]),!(e&&!e.preventDefault)&&void 0},app.layout.collapse=function(e,t,o,p){if(void 0===e||!t||!o)return app.error("app.layout.collapse",[e,t,o,p]);var r=app.layout.collapse.prototype;return r.collapsible=o,r.toggler=t,r.callback="function"==typeof p?p:null,r.collapsible._collapsible||(r.collapsible._collapsible={toggler:t}),e?app.utils.proxy(!1,r[e],r.collapsible,r.callback):app.utils.proxy(!0,r,r.collapsible,r.callback)},app.layout.collapse.prototype.open=function(e,t,o){if(app._runtime.debug&&console.info("app.layout.collapse.prototype.open",e&&e.target,e),e&&e.preventDefault&&e.preventDefault(),"true"!==t.getAttribute("aria-expanded")&&(!e||!e.target||e.target!==t._collapsible.toggler&&e.target.offsetParent!==t._collapsible.toggler))return t.classList.add("collapse"),t.classList.add("in"),t.setAttribute("aria-expanded","true"),t._collapsible.toggler.setAttribute("aria-expanded","true"),t._collapsible.toggler.classList.remove("collapsed"),o&&"function"==typeof o&&o.apply(this,[e,t]),!(e&&!e.preventDefault)&&void 0},app.layout.collapse.prototype.close=function(e,t,o){if(app._runtime.debug&&console.info("app.layout.collapse.prototype.close",e&&e.target,e),e&&e.preventDefault&&e.preventDefault(),"false"!==t.getAttribute("aria-expanded")&&(!e||!e.target||e.target!==t._collapsible.toggler&&e.target.offsetParent!==t._collapsible.toggler))return t.classList.remove("collapse"),t.classList.remove("in"),t.setAttribute("aria-expanded","false"),t._collapsible.toggler.setAttribute("aria-expanded","false"),t._collapsible.toggler.classList.add("collapsed"),o&&"function"==typeof o&&o.apply(this,[e,t]),!(e&&!e.preventDefault)&&void 0},app.layout.collapse.prototype.toggle=function(e,t,o){if(app._runtime.debug&&console.info("app.layout.collapse.prototype.toggle",e&&e.target,e),e&&e.preventDefault&&e.preventDefault(),"false"===t.getAttribute("aria-expanded")?app.layout.collapse.prototype.open.call(null,t):app.layout.collapse.prototype.close.call(null,t),o&&"function"==typeof o&&o.apply(this,[e,t]),e&&!e.preventDefault)return!1},app.layout.draggable=function(e,t,o,p){if(void 0===e||!t)return app.error("app.view.draggable",[e,t,o,p]);var r=app.layout.draggable.prototype;return r.row=t,r.row_selector=o||".draggable",r.callback="function"==typeof p?p:null,r.row._draggable||(r.row._draggable={selector:o,current:null,prev_index:null,next_index:null}),e?app.utils.proxy(!1,r[e],r.row,r.callback):app.utils.proxy(!0,r,r.row,r.callback)},app.layout.draggable.prototype.start=function(e,t,o){if(app._runtime.debug&&console.info("app.layout.draggable.prototype.start",e,t._draggable),e&&e.stopPropagation&&e.stopPropagation(),t._draggable.current=this,t._draggable.next_index=this.getAttribute("data-index"),e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/html",this.innerHTML),this.classList.add("move"),o&&"function"==typeof o&&o.apply(this,[e,t]),e&&!e.stopPropagation)return!1},app.layout.draggable.prototype.over=function(e,t,o){if(app._runtime.debug&&console.info("app.layout.draggable.prototype.over",e,t._draggable),e&&e.preventDefault&&e.preventDefault(),e.dataTransfer.dropEffect="move",o&&"function"==typeof o&&"function"==typeof o&&o.apply(this,[e,t]),e&&!e.preventDefault)return!1},app.layout.draggable.prototype.enter=function(e,t,o){if(app._runtime.debug&&console.info("app.layout.draggable.prototype.enter",e,t._draggable),e&&e.preventDefault&&e.preventDefault(),this.classList.add("over"),o&&"function"==typeof o&&o.apply(this,[e,t]),e&&!e.preventDefault)return!1},app.layout.draggable.prototype.leave=function(e,t,o){if(app._runtime.debug&&console.info("app.layout.draggable.prototype.leave",e,t._draggable),e&&e.preventDefault&&e.preventDefault(),this.classList.remove("over"),o&&"function"==typeof o&&o.apply(this,[e,t]),e&&!e.preventDefault)return!1},app.layout.draggable.prototype.end=function(e,t,o){app._runtime.debug&&console.info("app.layout.draggable.prototype.end",e,t._draggable),e&&e.stopPropagation&&e.stopPropagation();var p=document.querySelectorAll(t._draggable.selector);if(Array.prototype.forEach.call(p,function(e){e.classList.remove("move"),e.classList.remove("over")}),o&&"function"==typeof o&&o.apply(this,[e,t]),e&&!e.stopPropagation)return!1},app.layout.draggable.prototype.drop=function(e,t,o){if(app._runtime.debug&&console.info("app.layout.draggable.prototype.drop",e,t._draggable),e&&e.stopPropagation&&e.stopPropagation(),t._draggable.current!=this?(t._draggable.prev_index=this.getAttribute("data-index"),t._draggable.current.innerHTML=this.innerHTML,t._draggable.current.setAttribute("data-index",t._draggable.prev_index),this.setAttribute("data-index",t._draggable.next_index),this.innerHTML=e.dataTransfer.getData("text/html"),this.querySelector("meta").remove()):t._draggable.next_index=null,o&&"function"==typeof o&&o.apply(this,[e,t]),e&&!e.stopPropagation)return!1},app.layout.localize=function(e){if(app._root.window.appe__locale){if(!e)return app.error("app.layout.localize",[e]);if(!e.localized){var t=e.innerHTML.toString(),o=e.getAttribute("data-localize-replacement"),p=e.getAttribute("data-localize");e.innerHTML=app.i18n(t,p,o),e.localized=!0}}},app.utils={},app.utils.system=function(e){var t,o,p,r={name:null,platform:null,architecture:null,release:null};if(null==app._root.window.native)t=navigator.userAgent.match(/(Chrome|CriOS|Safari|Firefox|Edge|IEMobile|MSIE|Trident)\/([\d]+)/i),o=navigator.userAgent.match(/(iPad|iPhone|iPod|android|windows phone)/i),p=null,t&&(p=t[2]||null,(t=(t=t[1]||t[0]).toLowerCase())&&("crios"===t&&(t="chrome"),-1==t.indexOf("ie")&&"trident"!=t||("trident"===t?p=(p=navigator.userAgent.match(/rv:([\d]+)/i))?(t="ie",p[1]):t=null:t="ie"),r.navigator=t,p&&(r.release=parseFloat(p)))),o?"android"===(o=o[0].toLowerCase())?r.platform="android":"windows phone"===o?r.platform="wm":"ipad"===o?(r.platform="ios",r.model="ipad"):(r.platform="ios",r.model="iphone"):(o=navigator.userAgent.match(/(Win|Mac|Linux)/i))&&("win"===(o=o[0].substring(0,3).toLowerCase())&&(-1!=navigator.userAgent.indexOf("WOW64")||-1!=navigator.userAgent.indexOf("Win64")?r.architecture=64:r.architecture=32),"lin"===o&&(o="nxl"),r.platform=o),r=r;else{if(null!=app._root.process.native||"node"!==app._root.process.title)return app.error("app.utils.system","This system is not supported.");r={name:app._root.process.title.toString(),platform:app._root.process.platform.toString(),architecture:parseInt(app._root.process.arch.replace(/\D+/,"")),release:parseFloat(app._root.process.versions.node)}}return e&&"string"==typeof e&&e in r?r[e]:r},app.utils.addEvent=function(e,t,o){if("string"!=typeof e||!t||"function"!=typeof o)return app.error("app.utils.addEvent",[e,t,o]);t.addEventListener?t.addEventListener(e,o,!1):t.attachEvent&&t.attachEvent("on"+e,o)},app.utils.removeEvent=function(e,t,o){if(!e||!t||"function"!=typeof o)return app.error("app.utils.removeEvent",[e,t,o]);t.addEventListener?t.removeEventListener(e,o,!1):t.attachEvent&&t.detachEvent("on"+e,o)},app.utils.proxy=function(e,t){var o=Object.values(arguments);if(e&&"object"==typeof t){for(var p in o[0]=!1,t)"function"==typeof t[p]&&(o[1]=t[p],t[p]=app.utils.proxy.apply(null,o));return t}return o=o.slice(1),function(e){o[0]=e,t.apply(this,o)}},app.utils.storage=function(e,t,o,p){if(void 0===e||void 0===t)return app.error("app.utils.storage",[e,t,o,p]);if(!app._runtime.storage)return app.stop("app.utils.storage","runtime");var r=app.utils.storage.prototype,a=app._runtime.storage.toString();return r._prefix="appe.",r._fn=e?a:"sessionStorage",r._persist=e,r._fn in app._root.window==!1?app.error("app.utils.storage",r._fn):r[t].apply(r,[o,p])},app.utils.storage.prototype.set=function(e,t){if(void 0===e||"string"!=typeof e||void 0===t)return app.error("app.utils.storage.prototype.set",[e,t]);var o=app.utils.base64("encode",this._prefix+e);if("object"==typeof t)try{t=JSON.stringify(t)}catch(e){return app.error("app.utils.storage.prototype.set",e)}t=t.toString(),app._root.window[this._fn].setItem(o,t)},app.utils.storage.prototype.get=function(e){if(void 0===e||"string"!=typeof e)return app.error("app.utils.storage.prototype.get",[e]);var t=app.utils.base64("encode",this._prefix+e),o=app._root.window[this._fn].getItem(t);try{var p=o;o=JSON.parse(p)}catch(e){o=p}return o},app.utils.storage.prototype.has=function(e,t){if(void 0===e||"string"!=typeof e)return app.error("app.utils.storage.prototype.has",[e,t]);if(null==t)return!!this.constructor.call(this,this._persist,"get",e);if("object"==typeof t)try{t=JSON.stringify(t)}catch(e){return app.error("app.utils.storage.prototype.has",e)}return t=t.toString(),this.constructor.call(this,this._persist,"get",e)===t},app.utils.storage.prototype.del=function(e){if(void 0===e||"string"!=typeof e)return app.error("app.utils.storage.prototype.del",[e]);var t=app.utils.base64("encode",this._prefix+e);app._root.window[this._fn].removeItem(t)},app.utils.storage.prototype.reset=function(){app._root.window[this._fn].clear()},app.utils.cookie=function(e,t,o,p){if(void 0===e)return app.error("app.utils.cookie",[e,t,o,p]);var r=app.utils.cookie.prototype;return r._prefix="appe.",r[e].apply(r,[t,o,p])},app.utils.cookie.prototype.set=function(e,t,o){if(void 0===e||"string"!=typeof e||void 0===t)return app.error("app.utils.cookie.prototype.set",[e,t,o]);var p="Fri, 31 Dec 9999 23:59:59 GMT";o&&o instanceof Date&&(p=o.toUTCString());var r=app.utils.base64("encode",this._prefix+e);if(r=encodeURIComponent(r),"object"==typeof t)try{t=JSON.stringify(t)}catch(e){return app.error("app.utils.cookie().set",e)}t=t.toString(),t=encodeURIComponent(t),app._root.document.cookie=r+"="+t+"; expires="+p},app.utils.cookie.prototype.get=function(e){if(void 0===e||"string"!=typeof e)return app.error("app.utils.cookie.prototype.get",[e]);var t=app.utils.base64("encode",this._prefix+e);t=encodeURIComponent(t);var o=null;if(-1!=app._root.document.cookie.indexOf(t)){var p=new RegExp(t+"=([^;]+)"),r=app._root.document.cookie.match(p);o=r.length?r[1]:null}if(!o)return null;try{var a=o;o=JSON.parse(a)}catch(e){o=a}return o=decodeURIComponent(o)},app.utils.cookie.prototype.has=function(e,t){if(void 0===e||"string"!=typeof e)return app.error("app.utils.cookie.prototype.has",[e,t]);if(null==t)return!!this.constructor.call(this,"get",e);if("object"==typeof t)try{t=JSON.stringify(t)}catch(e){return app.error("app.utils.cookie.prototype.has",e)}return t=t.toString(),t=encodeURIComponent(t),this.constructor.call(this,"get",e)===t},app.utils.cookie.prototype.del=function(e){if(void 0===e||"string"!=typeof e)return app.error("app.utils.cookie.prototype.del",[e]);var t=app.utils.base64("encode",this._prefix+e);t=encodeURIComponent(t),app._root.document.cookie=t+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT"},app.utils.cookie.prototype.reset=function(){app._root.document.cookie=""},app.utils.base64=function(e,t){var o=app.utils.base64.prototype;return"btoa"in app._root.window==0||"atob"in app._root.window==0?app.stop("app.utils.base64"):void 0!==e&&t?o[e](t):app.error("app.utils.base64",[e,t])},app.utils.base64.prototype.encode=function(e){var t=app._root.window.btoa;return"string"!=typeof e?app.error("app.utils.base64.prototype.encode",[e]):e=t(e=encodeURIComponent(e))},app.utils.base64.prototype.decode=function(e){var t=app._root.window.atob;return"string"!=typeof e?app.error("app.utils.base64.prototype.decode",[e]):(e=t(e),e=decodeURIComponent(e))},app.utils.transform=function(e,t){if(!e)return app.error("app.utils.transform",[e,t]);switch(e){case"lowercase":return t.toLowerCase();case"uppercase":return t.toUpperCase();case"numeric":return parseFloat(t);case"integer":return parseInt(t);case"json":try{return t=decodeURIComponent(t),JSON.parse(t)}catch(e){}}},app.utils.sanitize=function(e,t){if(!e)return app.error("app.utils.sanitize",[e,t]);switch(e){case"whitespace":return t.replace(/\\s/g,"");case"breakline":return t.replace(/\\r\\n/g,"");case"date":try{return new Date(t).toISOString().split("T")[0]}catch(e){}break;case"datetime":try{return new Date(t).toISOString()}catch(e){}break;case"datetime-local":try{return new Date(t).toISOString().split(".")[0]}catch(e){}break;case"array":if("object"==typeof t&&t instanceof Array){var o=[];return Array.prototype.forEach.call(t,function(e,t){null!==e&&(o[t]=e)}),o}}},app.utils.classify=function(e,t,o){if(!e||"object"!=typeof e||t&&"string"!=typeof t)return app.error("app.utils.classify",[e,t,o]);t=t||"";var p=e instanceof Array||!0,r="";for(var a in e)e[a]&&(r+=t+(p&&a+"-"||"")+e[a].toString().replace(/[^\d\D-_]/i,"-")+" ");return r=r.trim(),o&&(r=r.split(" ")),r},app.utils.numberFormat=function(e,t,o,p){if("number"!=typeof e)return app.error("app.utils.numberFormat",[e,t,o,p]);t=null!=t?parseInt(t):0,o=o?o.toString():".",p=p?p.toString():"";var r=parseFloat(e);return r=r.toFixed(t).replace(".",o).replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1"+p)},app.utils.dateFormat=function(e,t){var o=null;o=o instanceof Date==!0?e:!0===e?new Date:new Date(e);var p=function(e){switch(e){case"d":return app.utils.numberLendingZero(o.getDate());case"J":return o.getDate();case"w":return o.getDay();case"m":return app.utils.numberLendingZero(o.getMonth()+1);case"n":return o.getMonth()+1;case"N":return o.getMonth();case"Y":return o.getFullYear();case"y":return o.getFullYear().toString().slice(2);case"H":return app.utils.numberLendingZero(o.getHours());case"G":return o.getHours();case"M":return app.utils.numberLendingZero(o.getMinutes());case"I":return o.getMinutes();case"S":return app.utils.numberLendingZero(o.getSeconds());case"K":return o.getSeconds();case"v":return o.getMilliseconds();case"a":return o.toDateString().split(" ")[0];case"b":return o.toDateString().split(" ")[1];case"x":return o.toISOString().split("T")[0].replace(/-/g,"/");case"X":return o.toTimeString().split(" ")[0];case"s":return Math.round(o.getTime()/1e3);case"V":return o.getTime();case"O":return o.toTimeString().match(/([\+[\d]{4,})/)[0];case"z":return o.toTimeString().split("GMT")[1];case"C":return o.toUTCString();case"Q":return o.toISOString()}};t=(t=t||"Y-m-d H:M").match(/.{1}/g);for(var r="",a=0;a<t.length;a++)r+=/[\W_]/.test(t[a])?t[a]:p(t[a]);return r},app.utils.numberLendingZero=function(e){return e<10?"0"+e:e.toString()},app.utils.isPlainObject=function(e){var t,o,p={}.hasOwnProperty;return!(!e||"[object Object]"!==toString.call(e))&&(!(t=Object.getPrototypeOf(e))||"function"==typeof(o=p.call(t,"constructor")&&t.constructor)&&p.toString.call(o)===p.toString.call(Object))},app.utils.extendObject=function(){var e,t,o,p,r,a,n=arguments[0]||{},i=1,s=arguments.length,l=!1;for("boolean"==typeof n&&(l=n,n=arguments[i]||{},i++),"object"==typeof n||"function"==typeof n&&"number"!=typeof n.nodeType||(n={});i<s;i++)if(null!=(e=arguments[i]))for(t in e)o=n[t],n!==(p=e[t])&&(l&&p&&(app.utils.isPlainObject(p)||(r=Array.isArray(p)))?(a=r?(r=!1,o&&Array.isArray(o)?o:[]):o&&app.utils.isPlainObject(o)?o:{},n[t]=app.utils.extendObject(l,a,p)):void 0!==p&&(n[t]=p));return n},Object.freeze(app);