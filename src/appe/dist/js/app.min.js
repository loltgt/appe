/*!
 * {appe}
 *
 * @version 1.0.0~beta
 * @copyright Copyright (C) 2018-2019 Leonardo Laureti
 * @license MIT License
 *
 * contains:
 * - (jQuery.fn.isPlainObject) from jQuery JavaScript Library <https://jquery.com/>, Copyright JS Foundation and other contributors, MIT license <https://jquery.org/license>
 * - (jQuery.fn.extend) from jQuery JavaScript Library <https://jquery.com/>, Copyright JS Foundation and other contributors, MIT license <https://jquery.org/license>
 */
var app=app={_root:{},_runtime:{}};app._root.server=this,app._root.document=!!this.Document&&document||{native:!1,documentElement:null},app._root.window=!!this.Window&&window||{native:!1,document:app._root.document,navigator:null},app._root.process=!!this.Window&&!this.Process&&{native:!1}||process,app._runtime={version:"1.0",release:"1.0 beta",system:null,exec:!0,session:!1,title:"",name:"",locale:"en",locale_dir:"ltr",storage:!1,binary:!1,compression:!1,encryption:!1,debug:!1,hangs:0},app.load=function(e){if("function"!=typeof e)return app.stop("app.load","func");var t=!1,p=function(){t||(e(),t=!0)};null==app._root.window.native?("complete"==document.readyState?p():document.addEventListener("DOMContentLoaded",p),app.utils.addEvent("load",app._root.window,p)):app._root.server.load=e},app.unload=function(e){if("function"!=typeof e)return app.stop("app.unload","func");null==app._root.window.native?app.utils.addEvent("beforeunload",app._root.window,e):app._root.server.onunload=e},app.redirect=function(){var e=app._root.window.appe__config||app._root.process.env.appe__config;if(!e)return app.stop("app.redirect");var t=e.base_path.toString(),p="index";-1!=app._root.window.location.href.indexOf(t+"/")&&(t="..",p=e.launcher_name.toString()),app._root.window.location.href=t+"/"+p+".html"},app.position=function(){var e=app.controller.cursor();return e&&"object"!=typeof e?app.error("app.position","loc"):null},app.session=function(e,a,t){if("function"!=typeof e||!a)return app.stop("app.session",[e,"config",t]);var p=null;if("secret_passphrase"in a&&(p=a.secret_passphrase.toString(),delete a.secret_passphrase),app._root.server.appe__store={},app._runtime.name=a.app_ns.toString(),app._runtime.debug=!!a.debug,app._runtime.encryption=!!(a.encryption||a.file&&a.file.crypt),app._runtime.compression=!!(a.compression||a.file&&a.file.compress),app._runtime.binary=!!(a.binary||a.file&&a.file.binary),!app._runtime.binary||app._runtime.compression&&app._runtime.encryption||app.error("app.session","binary"),app._runtime.system=app.utils.system(),"localStorage"in app._root.window==!1?app._runtime.storage="sessionStorage":"sessionStorage"in app._root.window==!1?app._runtime.storage="localStorage":"safari"==app._runtime.system.name?app._runtime.storage="sessionStorage":null==app._root.process?app._runtime.storage="storage":app._runtime.storage="localStorage",app._runtime.session=!0,!(void 0===app._root.server.appe__locale)&&null===a.language){var o=app._root.window.appe__locale;if("object"!=typeof o)return app.error("app.session","locale");if(app._root.window.navigator&&navigator.languages&&"object"==typeof navigator.languages){var r=!1;for(lang in navigator.languages)!r&&navigator.languages[lang]in o&&(app._runtime.locale=navigator.languages[lang].toString(),r=!0);!r&&navigator.languages.length&&(app._runtime.locale=navigator.languages[lang].split("-")[0]||app._runtime.locale)}}app._runtime.locale=a.language?a.language.toString():app._runtime.locale,app._runtime.locale_dir=a.language_direction?a.language_direction.toString():app._runtime.locale_dir,null==app._root.document.native&&(document.documentElement.setAttribute("lang",app._runtime.locale),document.documentElement.setAttribute("class",app.utils.classify(app._runtime.system,"system--")));var n,i,s=0,l=function(e,t){var p=parseInt(a.open_attempts)||50,o=0,r=setInterval(function(){o++,e in app._root.window!=!0&&p!==o||(clearInterval(r),t(!0))},10)},c=function(t){if(!(CryptoJS&&CryptoJS.MD5&&CryptoJS.SHA512&&CryptoJS.AES))return t("CryptoJS");try{var e=CryptoJS.SHA512(Math.random().toString(),{outputLength:384});app._runtime.secret=e.toString(CryptoJS.enc.Hex),app._root.document[app._runtime.secret]=p,t(!1,!0)}catch(e){t(e)}},u=function(e){--s||f()},f=function(){void 0===t&&start&&"session"in start&&"function"==typeof start.session?start.session(e):!0===t&&main&&"session"in main&&"function"==typeof main.session?main.session(e):!1===t&&control&&"session"in control&&"function"==typeof control.session?control.session(e):e()};!1!==t?(app._runtime.encryption&&(s++,function(e){if(!a.secret_passphrase||"string"!=typeof a.secret_passphrase)return e("config");"CryptoJS"in app._root.window==0?l("CryptoJS",c.bind(null,e)):c(e)}(u)),app._runtime.compression&&(s++,i=u,"pako"in app._root.window==0?l("pako",c.bind(null,i)):function(e){if(!(pako&&pako.inflate&&pako.deflate))return e("pako");e(!1,!0)}(i)),s||(s=1,n=u,"CryptoJS"in app._root.window==0?l("CryptoJS",c.bind(null,n)):c(n))):f()},app.resume=function(e,t){if(!e)return app.stop("app.resume",["config",t]);var p="",o="";if(app._runtime.binary||(app.utils.cookie("has","last_opened_file")&&(p=app.utils.cookie("get","last_opened_file")),p||(p=app.memory.get("last_opened_file"))),app.utils.cookie("has","last_session")&&(o=app.utils.cookie("get","last_session")),o||(o=app.memory.get("last_session")),void 0!==t||p&&!o){if(app._runtime.debug&&void 0!==t)return!o&&app.newSession();if(!o)return app.redirect()}else;return p&&(p=app.utils.base64("decode",p)),p},app.data=function(e){var t=app._root.server.appe__store;if(!t)return app.stop("app.data","store");var p=app._runtime.name.toString();return t[p]?e&&"string"==typeof e?e in t[p]?t[p][e]:app.error("app.data","key"):t[p]:app.stop("app.data","store")},app.checkConfig=function(e){if(!e||"object"!=typeof e)return app.stop("app.checkConfig");for(var t=!1,p=["app_ns","launcher_name","app_name","schema","events","routes","default_route","default_event","base_path","save_path"],o=null,r=0;o=p[r++];)o in e==!1?t=!0:"schema"!=o&&"events"!=o&&"routes"!=o||"object"==typeof e[o]?"object"!=typeof e[o]&&"string"!=typeof e[o]&&"number"!=typeof e[o]&&"boolean"!=typeof e[o]&&(t=!0):t=!0;return(e.encryption&&(!e.secret_passphrase||"string"!=typeof e.secret_passphrase)||e.alt&&"object"!=typeof e.alt||e.file&&"object"!=typeof e.file||e.csv&&"object"!=typeof e.csv)&&(t=!0),!!t&&app.stop("app.checkConfig","config")},app.checkFile=function(e,t){var p=app._root.window.appe__config||app._root.process.env.appe__config;if(!p)return app.stop("app.checkFile");if(!e||"object"!=typeof e)return app.error("app.checkFile",["source","checksum"]);var o=app._runtime.version.toString();if(o!==e.file.version)return app.error("app.checkFile",app.i18n("This file is incompatible with running version: {{_app_version}}.",null,o),e.file);if(p.verify_checksum&&t)try{if(e.file.checksum!==t)throw"checksum"}catch(e){return app.error("app.checkFile",e)}return!0},app.openSessionFile=function(){var e=app._root.window.appe__config||app._root.process.env.appe__config;if(!e)return app.stop("app.openSessionFile");var p=!(void 0===app._root.server.appe__start);if(app._runtime.encryption&&!(CryptoJS&&CryptoJS.SHA512&&CryptoJS.AES))return app.error("app.openSessionFile","CryptoJS");if(app._runtime.compression&&!(pako&&pako.inflate&&pako.deflate))return app.error("app.openSessionFile","pako");if("object"!=typeof e.schema)return app.error("app.openSessionFile","schema");var o=new Date;o=app.utils.dateFormat(o,"Q");var r=app.utils.base64("encode",o),t=(app._runtime.name.toString(),e.file&&e.file.binary?!!e.file.binary:!!app._runtime.binary),a=e.file&&e.file.compress?!!e.file.compress:!!app._runtime.compression,n=e.file&&e.file.crypt?!!e.file.crypt:!!app._runtime.encryption;if(t&&(!a||!n))return app.error("app.openSessionFile","binary"),callback(!1);var i="js";t&&(i="appe"),i=e.file&&e.file.extension?"."+e.file.extension.toString():i;var s=function(e){if(p&&app.start.progress(0),e){app.utils.cookie("del","last_opened_file"),app.utils.cookie("del","last_session");var t=app.utils.base64("encode",e);app.utils.cookie("set","last_opened_file",t),app.utils.cookie("set","last_session",r),app.memory.set("last_opened_file",t),app.memory.set("last_stored",o),app.memory.set("last_time",o),app.memory.set("last_session",r),p?app.start.redirect(!0):app._root.window.location.reload()}},l=null;if(!this.getAttribute("data-open")){this.setAttribute("data-open","");var c=this.getAttribute("data-open-input");l=this.parentNode.querySelector(c);"ios"!=app._runtime.system.platform&&l.setAttribute("accept","."+i),app.utils.addEvent("change",l,function(){app.os.fileSessionOpen.call(this,s)})}l&&(p&&app.start.progress(2),l.click())},app.saveSessionFile=function(){var e=app._root.window.appe__config||app._root.process.env.appe__config;if(!e)return app.stop("app.saveSessionFile");var t=app._root.server.appe__store;if(!t)return app.stop("app.saveSessionFile","store");app._root.server.appe__start;if(app._runtime.encryption&&!(CryptoJS&&CryptoJS.SHA512&&CryptoJS.AES))return app.error("app.saveSessionFile","CryptoJS");if(app._runtime.compression&&!(pako&&pako.inflate&&pako.deflate))return app.error("app.saveSessionFile","pako");var p=app._runtime.name.toString(),o=e.schema;if("object"!=typeof o)return app.error("app.saveSessionFile","schema");var r={},a=new Date;Array.prototype.forEach.call(o,function(e){r[e]=t[p][e]}),r.file=app.os.generateJsonHead(r,a),app.os.fileSessionSave(function(e){app._runtime.debug&&console.info("save",e)},r,a)},app.newSession=function(){var e=app._root.window.appe__config||app._root.process.env.appe__config;if(!e)return app.stop("app.newSession");var t=!(void 0===app._root.server.appe__start),p=app._runtime.name.toString(),o=new Date;o=app.utils.dateFormat(o,"Q");var r=app.utils.base64("encode",o),a=e.schema;if("object"!=typeof a)return app.error("app.newSession","schema");var n=function(){t?app.start.redirect(!1):app._root.window.location.reload()};!function(){for(var e in app.controller.clear(),app.utils.cookie("del","last_opened_file"),app.utils.cookie("del","last_session"),app.utils.cookie("set","last_session",r),app.memory.del("last_opened_file"),app.memory.del("file_saves"),app.memory.set("last_stored",o),app.memory.set("last_time",o),app.memory.set("last_session",r),a)app.store.set(p+"_"+a[e],{});n()}()},app.openSession=app.openSessionFile,app.saveSession=app.saveSessionFile,app.i18n=function(e,t,p){var o=app._root.window.appe__locale;if(!o)return e;if("object"!=typeof o)return app.stop("app.i18n","locale");var r=app._runtime.locale.toString(),a=app._runtime.locale_dir.toString();if("string"!=typeof e||p&&"string"!=typeof p&&"object"!=typeof p||t&&"string"!=typeof t)return app.error("app.i18n",[e,t,p]);t=t?t.toString():"0";var n=null;if(o[r]&&o[r][t]&&e in o[r][t]&&o[r][t][e])n=o[r][t][e].toString();else{if(!/\{\{|\|\|/.test(e))return e;n=e}if(!p)return n;if("string"==typeof p){if(-1!=p.indexOf("{{")){var i=-1!=p.indexOf("[[")?p.match(/\{\{(.+)(?:\[\[([\w]+)\]\])\}\}/):p.match(/\{\{(.+)\}\}/),s=null;-1!=i[1].indexOf("%%")&&(i=(s=i[1].split("%%"))[0]?[null,s[0],i[2]]:(n="{{placeholder}}",[null,e.toString(),t]),(s=s[1]).length&&(s=/\D/.test(s[0])?s.split(","):[[s[0]]])),p=app.i18n(i[1],i[2],s)}n=n.replace(/\{\{[\w]+\}\}/,p)}else if("object"==typeof p)if(p[0]instanceof Array){var l=["$1","$2"];"rtl"==a&&l.reverse(),n=n.replace(/(.+)\|\|(.+)/,1<parseInt(p[0][0])?l[1]:l[0])}else if(p instanceof Array)for(var c in"rtl"==a&&p.reverse(),p)n=n.replace(/\{\{[\w]+\}\}/,p[c].toString());else for(var u in p)n=n.replace(new RegExp("{{"+u.toString()+"}}"),p[u]);return n},app.debug=function(){return app.getInfo("config","debug")},app.stop=function(e,t,p,o){if(!app._runtime.exec)return!1;var r=!(void 0===app._root.server.appe__main);return app._runtime.exec=!1,t=t||null,r&&app.blind(),app.error.apply(this,[e,t,p,o]),!1},app.error=function(e,t,p,o){var r=!(void 0===app._root.server.appe__control),a=null,n=null,i=null;p?(a=e,n=t,i=p):t?(a=e,i=t):e&&(n=e),3<app._runtime.hangs||(app._root.document.documentElement.lang||(document.documentElement.lang=app._runtime.locale.toString()),app._runtime.debug&&(app._runtime.exec?console.error("ERR",a,n,app.position()||""):console.warn("WARN",a,n,app.position()||""),i&&console.log(i)),n||(n=app.i18n("There was an error while executing."),app._runtime.exec||(n+="\n\n"+app.i18n("Please reload the application."))),r||o||app._runtime.hangs++||app._root.window.alert&&app._root.window.alert(n))},app.blind=function(){if(!(void 0===app._root.window.appe__main)){var e=app._root.document.createElement("div");e.setAttribute("style","position: absolute; top: 0; right: 0; bottom: 0; left: 0; z-index: 9999; background: rgba(0,0,0,0.3);"),null==app._root.document&&app._root.document.body.appendChild(e)}},app.getInfo=function(e,t){var p=app._root.window.appe__config||app._root.process.env.appe__config;if(!p)return app.stop("app.getConfig");if("string"!=typeof e&&t&&"string"!=typeof t)return app.error("app.getInfo",[e,t]);var o=null;switch(e){case"config":o={app_name:p.app_name.toString(),schema:"object"==typeof p.schema?p.schema:[],license:p.license&&("object"==typeof p.license?{text:p.license.text.toString(),file:p.license.file.toString()}:p.license.toString())||!1};break;case"runtime":o={debug:!!app._runtime.debug,locale:app._runtime.locale.toString(),version:app._runtime.version.toString(),release:app._runtime.release.toString()};break;default:return app.error("app.getInfo","info")}return t&&t in o?o[t]:o},app.getName=function(){return app.getInfo("config","app_name")},app.getVersion=function(e){return e&&"string"!=typeof e?app.error("app.getVersion",[e]):"version"==e||"release"==e?app.getInfo("runtime",e):{version:app.getInfo("runtime","version"),release:app.getInfo("runtime","release")}},app.getLicense=function(){return app.getInfo("config","license")},app.getLocale=function(){return app.getInfo("config","locale")},app.os={},app.os.fileSessionOpen=function(p){var e=app._root.window.appe__config||app._root.process.env.appe__config;if(!e)return app.stop("app.os.fileSessionOpen");var t=!0;if(e.file&&"object"!=typeof e.file&&(t=app.error("app.os.fileSessionOpen","config")),FileReader||(t=app.error("app.os.fileSessionOpen","FileReader")),CryptoJS&&CryptoJS.MD5||(t=app.error("app.os.fileSessionOpen","CryptoJS")),!app._runtime.encryption||CryptoJS&&CryptoJS.SHA512&&CryptoJS.AES||(t=app.error("app.os.fileSessionOpen","CryptoJS")),!app._runtime.compression||pako&&pako.inflate&&pako.deflate||(t=app.error("app.os.fileSessionOpen","pako")),p&&"function"==typeof p||(t=app.error("app.os.fileSessionOpen",[p])),!t||!this.files.length)return p(!1);var o=app._runtime.name.toString(),r=e.schema;if("object"!=typeof r)return app.error("app.os.fileSessionOpen","schema"),p(!1);var a=e.file&&e.file.binary?!!e.file.binary:!!app._runtime.binary,n=e.file&&e.file.compress?!!e.file.compress:!!app._runtime.compression,i=e.file&&e.file.crypt?!!e.file.crypt:!!app._runtime.encryption;if(a&&(!n||!i))return app.error("app.os.fileSessionOpen","binary"),p(!1);var s=this.files[0],l=e.file&&e.file.heads?e.file.heads.toString():o,c="js",u="application/x-javascript",f=null;if(a?(c="appe",u="application/octet-stream"):u+";charset=utf-8",c=e.file&&e.file.extension?e.file.extension.toString():c,app._runtime.debug&&console.info("app.os.fileSessionOpen","file",s,e.file),"ios"!=app._runtime.system.platform&&-1===s.name.indexOf(c))return app.error("app.os.fileSessionOpen",app.i18n("This file format cannot be open."),"file"),p(!1);var d=function(e,t){if(!e)return t(!1);if(a)return t(!1,e);-1!=e.indexOf("\r\n")&&(e=e.replace(/[\r\n]([\s]+){2}/g,""));var p=new RegExp(l+'=(?![^"{}]+)');e=e.replace(p,"").replace(/(^"|"$)/g,"")},m=function(e,t){var p=null;if(!(app._runtime.secret&&"string"==typeof app._runtime.secret&&app._runtime.secret in app._root.document))return t("runtime");p=app._root.document[app._runtime.secret];try{if(!(e=(e=CryptoJS.AES.decrypt(e,p,{mode:CryptoJS.mode.CTR,padding:CryptoJS.pad.NoPadding})).toString(CryptoJS.enc.Utf8)))throw"decryption";t(!1,e)}catch(e){t(e)}},v=function(e,t){try{e=JSON.parse(e)}catch(e){return t(e)}if(!app.checkFile(e,f))return t("check");for(var p in r){if(r[p]in e==!1)return t("schema");app.store.set(o+"_"+r[p],e[r[p]])}t(!1,s.name)},g=function(e){try{d(e,n&&i?function(e,t){if(e)throw e;!function(e,t){try{if(!(e=pako.inflate(e,{raw:!0,to:"string"})))throw"decompression";t(!1,e)}catch(e){t(e)}}(t,function(e,t){if(e)throw e;m(t,function(e,t){if(e)throw e;app.os.generateJsonChecksum(function(e){if(!e)throw null;f=e,v(t,function(e,t){if(e)throw e;p(t)})},t)})})}:i?function(e,t){if(e)throw e;m(t,function(e,t){if(e)throw e;app.os.generateJsonChecksum(function(e){if(!e)throw null;f=e,v(t,function(e,t){if(e)throw e;p(t)})},t)})}:function(e,t){if(e)throw e;app.os.generateJsonChecksum(function(e){if(!e)throw null;f=e,v(t,function(e,t){if(e)throw e;p(t)})},t)})}catch(e){return app.error("app.os.fileSessionOpen",e),p(!1)}},y=new FileReader;y.onloadend=function(){g(this.result)},y.onerror=function(e){app.error("app.os.fileSessionOpen",e),p(!1)},a?y.readAsArrayBuffer(s):y.readAsText(s)},app.os.fileSessionSave=function(p,e,s){var l=app._root.window.appe__config||app._root.process.env.appe__config;if(!l)return app.stop("app.os.fileSessionSave");var t=!0;if(l.file&&"object"!=typeof l.file&&(t=app.error("app.os.fileSessionSave","config")),Blob||(t=app.error("app.os.fileSessionSave","Blob")),FileReader||(t=app.error("app.os.fileSessionSave","FileReader")),CryptoJS&&CryptoJS.MD5||(t=app.error("app.os.fileSessionOpen","CryptoJS")),!app._runtime.encryption||CryptoJS&&CryptoJS.SHA512&&CryptoJS.AES||(t=app.error("app.os.fileSessionSave","CryptoJS")),!app._runtime.compression||pako&&pako.inflate&&pako.deflate||(t=app.error("app.os.fileSessionSave","pako")),p&&"function"==typeof p&&s&&s instanceof Date||(t=app.error("app.os.fileSessionSave",[p,e,s])),!t||!e||"object"!=typeof e)return p(!1);var c=app._runtime.name.toString(),o=l.file&&l.file.binary?!!l.file.binary:!!app._runtime.binary,r=l.file&&l.file.compress?!!l.file.compress:!!app._runtime.compression,a=l.file&&l.file.crypt?!!l.file.crypt:!!app._runtime.encryption;if(o&&(!r||!a))return app.error("app.os.fileSessionSave","binary"),p(!1);var n=l.file&&l.file.heads?l.file.heads.toString():c,u="js",i="application/x-javascript",f=null;f=o?(u="appe",i="application/octet-stream"):i+";charset=utf-8",u=l.file&&l.file.extension?l.file.extension.toString():u;var d=function(t,p){t.file.checksum="";for(var e=32;e--;)t.file.checksum+=" ";try{t=JSON.stringify(t);app.os.generateJsonChecksum(function(e){if(!e)throw null;e,t=t.replace(/"file":{"checksum":"[\s]{32}"/,'"file":{"checksum":"'+e+'"'),p(!1,t)},t)}catch(e){p(e)}},m=function(e,t){var p=null;if(!(app._runtime.secret&&"string"==typeof app._runtime.secret&&app._runtime.secret in app._root.document))return t("runtime");p=app._root.document[app._runtime.secret];try{if(!(e=(e=CryptoJS.AES.encrypt(e,p,{mode:CryptoJS.mode.CTR,padding:CryptoJS.pad.NoPadding})).toString()))throw"encryption";t(!1,e)}catch(e){t(e)}},v=function(e,t){if(!e)return t("source");o||(a&&(e='"'+e+'"'),e=n+"="+e),t(!1,e)},g=function(e,t){var p=app.memory.has("file_saves")?parseInt(app.memory.get("file_saves")):0;p++;var o=l.file&&l.file.filename_prefix?l.file.filename_prefix.toString():c+"_save",r=l.file&&l.file.filename_separator?l.file.filename_separator.toString():"_",a=l.file&&l.file.filename_date_format?l.file.filename_date_format.toString():"Y-m-d_H-M-S",n=o;n+=r+app.utils.dateFormat(s,a);var i=(n+=r+p)+"."+u;app._runtime.debug&&console.info("app.os.fileSessionSave","file",i,f,l.file);try{app.memory.set("file_saves",p),app.os.fileDownload(e,i,f),t(!1,i)}catch(e){t(e)}};!function(e){try{d(e,r&&a?function(e,t){if(e)throw e;m(t,function(e,t){if(e)throw e;!function(e,t){try{if(!(e=pako.deflate(e,{raw:!0,level:9})))throw"compression";t(!1,e)}catch(e){t(e)}}(t,function(e,t){if(e)throw e;v(t,function(e,t){if(e)throw e;g(t,function(e,t){if(e)throw e;p(t)})})})})}:a?function(e,t){if(e)throw e;m(t,function(e,t){if(e)throw e;v(t,function(e,t){if(e)throw e;g(t,function(e,t){if(e)throw e;p(t)})})})}:function(e,t){if(e)throw e;v(t,function(e,t){if(e)throw e;g(t,function(e,t){if(e)throw e;p(t)})})})}catch(e){app.error("app.os.fileSessionSave",e),p(!1)}}(e)},app.os.fileDownload=function(e,i,t){if(!FileReader)return app.error("app.os.fileDownload","FileReader");if(!Blob)return app.error("app.os.fileDownload","Blob");if("object"!=typeof e&&"string"!=typeof e||"string"!=typeof i||"string"!=typeof t)return app.error("app.os.fileDownload",[e,i,t]);var s=app._root.window.URL||app._root.window.webkitURL,n=function(e,t,p,o){if(p)!function(e,t,p){var o,r,a=!1,n=app._root.document.createElement("A");n.href=e.toString(),n.download=i,n.rel="noopener",n.target=p?"_blank":"_self",n.onclick=function(){a=!0,n.remove(),t&&s.revokeObjectURL(e),o&&clearTimeout(o),r&&clearTimeout(r)},o=setTimeout(function(){var t;try{t=new MouseEvent("click"),n.dispatchEvent(t)}catch(e){(t=document.createEvent("MouseEvents")).initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),n.dispatchEvent(t)}clearTimeout(o)},0),r=setTimeout(function(){a||(n.target="_blank",n.click()),clearTimeout(r)},10)}(e,t,o);else{var r=app._root.window.open("",o?"_blank":"_self");r&&r.location?(r.location.href=e,r=null):app._root.window.open(e,o?"_blank":"_self")}},p=function(e,t,p,o){var r,a=p?"attachment/file":"application/octet-stream";try{r=new File([l],i,{type:a})}catch(e){app.error("app.os.fileDownload() > _downloadAttachment","File",null,!0),r=new Blob([l],{type:a})}t?function(e,t,p){try{data=s.createObjectURL(e),n(data,!0,t,p)}catch(e){return app.error("app.os.fileDownload() > _objectURL",e)}}(r,e,o):function(e,t,p){var o=new FileReader;o.onloadend=function(){if(!o.result)throw"data";var e=o.result;n(e,!1,t,p)},o.onerror=function(e){return app.error("app.os.fileDownload() > _blob",e)},o.readAsDataURL(e)}(r,e,o)};try{var l=new Blob([e],{type:t});if(!l)throw"blob"}catch(e){return app.error("app.os.fileDownload",e)}var o="file:"!=app._root.window.location.protocol;if("download"in app._root.window.HTMLAnchorElement.prototype)p(!0),app._runtime.debug&&console.info("app.os.fileDownload",[1,0,0,0],t,i);else if("msSaveOrOpenBlob"in app._root.window.navigator)navigator.msSaveOrOpenBlob(file,i)||p(!0,o,!1,!1),app._runtime.debug&&console.info("app.os.fileDownload",[1,o,0,1],t,i);else if("open"in app._root.window){var r="chrome"==app._runtime.system.name;o="chrome"!=app._runtime.system.name&&o;var a="safari"==app._runtime.system.name,c="safari"==app._runtime.system.name;p(r,o,a,c),app._runtime.debug&&console.info("app.os.fileDownload",[r,o,a,c],t,i)}else p(!0,o,!0,!0),app._runtime.debug&&console.info("app.os.fileDownload",[1,o,1,1],t,i)},app.os.scriptOpen=function(e,t,p,o){if("function"!=typeof e||"string"!=typeof t||p&&"string"!=typeof p)return app.error("app.os.scriptOpen",[e,t,p,o]),e(!1);p=p.toString();var r,a,n,i,s,l,c;if(app._root.window.native)return e(!0);r=t,(a=app._root.document.createElement("script")).src=r,a.async=!0,a.defer=!0,app._root.document.head.appendChild(a),p in app._root.window==!1?(n=p,i=e,s=parseInt(o)||50,l=0,c=setInterval(function(){l++,n in app._root.window!=1&&s!==l||(clearInterval(c),i(!0))},10)):e(!0)},app.os.generateJsonHead=function(e,t){if(!(app._root.window.appe__config||app._root.process.env.appe__config))return app.stop("app.os.generateJsonHead");if(!(e&&"object"==typeof e||t&&t instanceof Date))return app.error("app.os.generateJsonHead",[e,t]);return{checksum:"",date:t=app.utils.dateFormat(t,"Q"),version:app._runtime.version.toString(),release:app._runtime.release.toString()}},app.os.generateJsonChecksum=function(t,e){if("function"!=typeof t&&"string"!=typeof e)return app.error("app.os.generateJsonChecksum",[t,e]),t(!1);CryptoJS&&CryptoJS.MD5||(step=app.error("app.os.generateJsonChecksum","CryptoJS"));try{var p=CryptoJS.MD5(e.length.toString());t(p=p.toString())}catch(e){app.error("app.os.generateJsonChecksum",e),t(!1)}},app.os.getLastFileName=function(){if(!(app._root.window.appe__config||app._root.process.env.appe__config))return app.stop("app.os.getLastFileName");var e="";return app.utils.cookie("has","last_opened_file")&&(e=app.utils.cookie("get","last_opened_file")),e||(e=app.memory.get("last_opened_file")),!!e&&(e=e?app.utils.base64("decode",e):null)},app.os.getLastFileVersion=function(){var e=app._root.server.appe__store;if(!e)return app.stop("app.os.getLastFileVersion","store");var t=e[app._runtime.name.toString()].file;if(!t)return app.error("app.os.getLastFileVersion","data");var p=null;return t.version&&(p=t.version),p},app.os.getLastFileChecksum=function(){var e=app._root.server.appe__store;if(!e)return app.stop("app.os.getLastFileChecksum","store");var t=e[app._runtime.name.toString()].file;if(!t)return app.error("app.os.getLastFileChecksum","data");var p=null;return t.checksum&&(p=t.checksum),p},app.os.getLastFileHead=function(){return{name:app.os.getLastFileName(),version:app.os.getLastFileVersion(),checksum:app.os.getLastFileChecksum()}},app.controller={},app.controller.spoof=function(){var e={view:null,action:null,index:null};if(-1==app._root.window.location.href.indexOf("?"))return e;var t=app._root.window.location.href.split("?")[1];if(-1!=t.indexOf("&"))if(-1!=(t=t.split("&"))[1].indexOf("=")){var p=t[1].split("=");e={view:t[0],action:p[0],index:parseInt(p[1])}}else e={view:t[0],action:t[1]};else e.view=t;return e},app.controller.history=function(e,t){var p=app._runtime.title.toString();e?e+=" â€“ "+p:e=p,"safari"==app._runtime.system.name?app._root.window.location.href=t:history.replaceState(null,e,t),app.controller.setTitle(e)},app.controller.cursor=function(e){return e&&"object"!=typeof e?app.error("app.controller.cursor",[e]):e?(app.memory.set("cursor",e),e):e=app.memory.get("cursor",e)},app.controller.setTitle=function(e){return app._runtime.title=e.toString(),app._root.document.title=app._runtime.title,app._runtime.title},app.controller.getTitle=function(){return app._runtime.title.toString()},app.controller.store=function(e,o,t,p){var r=app._root.server.appe__store;if(!r)return app.stop("app.controller.store","store");if("function"!=typeof e||"string"!=typeof o||"object"!=typeof t||"object"!=typeof p)return app.stop("app.controller.store",[e,o,t,p]);var a=r[o];if(!a)return app.stop("app.controller.store","source");var n=function(e,t){if("string"!=typeof e||"object"!=typeof t)return app.stop("app.controller.store() > _store",[e,t]);if(!a[e])return app.stop("app.controller.store() > _store","source");var p=t;return app.store.set(o+"_"+e,p),p},i=new Date;i=app.utils.dateFormat(i,"Q");var s=Object.keys(p);for(var l in s){var c=s[l],u=p[c];if(-1===t.indexOf(c)||!Object.keys(u).length)return app.stop("app.controller.store","data");r[o][c]=n(c,u)}app.memory.del("save_reminded"),app.memory.set("last_stored",i),e()},app.controller.retrieve=function(e,t){var p=app._root.window.appe__config||app._root.process.env.appe__config;if(!p)return app.stop("app.controller.retrieve");var a=app._root.server.appe__store;if(!a)return app.stop("app.controller.retrieve","store");if("function"!=typeof e||"object"!=typeof t)return app.stop("app.controller.retrieve",[e,t]);if("object"!=typeof p.schema)return app.error("app.controller.retrieve","schema");for(var o=function(e,t){if("string"!=typeof e||"object"!=typeof t)return app.stop("app.controller.retrieve() > _retrieve",[e,t]);if(a[e]&&"object"==typeof a[e])return a[e];for(var p in a={},t){var o=t[p].toString(),r=app.store.get(e+"_"+o);if(!r)return app.stop("app.controller.retrieve() > _retrieve","schema");a[o]=r}return a},r=t.length;r--;){var n=t[r].fn.toString();t[r].file&&(t[r].file="../"+t[r].file.toString()),a[n]=o(n,t[r].schema)}e()},app.controller.clear=function(){var e=app._root.window.appe__config||app._root.process.env.appe__config;if(!e)return app.stop("app.controller.clear");var t=app._root.server.appe__store;if(!t)return app.stop("app.controller.clear","store");var p=app._runtime.name.toString(),o=e.schema;if("object"!=typeof o)return app.error("app.controller.clear","schema");for(var r in o){var a=o[r].toString();app.store.del(p+"_"+a),t[p]&&a in t[p]&&delete t[p][a]}return app.memory.del("last_stored"),!0},app.memory={},app.memory.set=function(e,t){return app.utils.storage(!0,"set",e,t)},app.memory.get=function(e){return app.utils.storage(!0,"get",e)},app.memory.has=function(e,t){return app.utils.storage(!0,"has",e,t)},app.memory.del=function(e){return app.utils.storage(!0,"del",e)},app.memory.reset=function(){return app.utils.storage(!0,"reset")},app.store={},app.store.set=function(e,t){return app.utils.storage(!1,"set",e,t)},app.store.get=function(e){return app.utils.storage(!1,"get",e)},app.store.has=function(e,t){return app.utils.storage(!1,"has",e,t)},app.store.del=function(e){return app.utils.storage(!1,"del",e)},app.store.reset=function(){return app.utils.storage(!1,"reset")},app.start={},app.start.progress=function(e){var t=document.getElementById("start-progress-wait"),p=document.getElementById("start-progress-open");switch(e){case 2:p.setAttribute("style","visibility: visible;"),t.setAttribute("style","visibility: visible;");break;case 1:p.setAttribute("style","visibility: visible;"),t.setAttribute("style","visibility: hidden;");break;default:t.setAttribute("style","visibility: visible;"),p.setAttribute("style","visibility: hidden;")}},app.start.loadComplete=function(e){var t=app._root.window.appe__config||app._root.process.env.appe__config;if(!t)return app.stop("app.start.loadComplete");if(t.file&&"object"!=typeof t.file)return app.error("app.start.loadComplete","config");var p=app._runtime.name.toString(),o=t.schema;if("object"!=typeof o)return app.error("app.start.loadComplete","schema");if(app.start.progress(1),e){e=t.save_path.toString()+"/"+e;var r=t.file&&t.file.heads?t.file.heads.toString():p;app.start.attemptLoad(function(e){e?app.start.redirect(!0):app.start.progress(1)},r,e,o,!0)}},app.start.attemptLoad=function(o,r,e,a,n){var t=app._root.window.appe__config||app._root.process.env.appe__config;if(!t)return app.stop("app.start.attemptLoad");var p=!0;if(t.file&&"object"!=typeof t.file&&(p=app.error("app.start.attemptLoad","config")),CryptoJS&&CryptoJS.MD5||(p=app.error("app.start.attemptLoad","CryptoJS")),!app._runtime.encryption||CryptoJS&&CryptoJS.SHA512&&CryptoJS.AES||(p=app.error("app.start.attemptLoad","CryptoJS")),"function"==typeof o&&r&&"string"==typeof r&&e&&"string"==typeof e&&"object"==typeof a||(p=app.stop("app.start.attemptLoad",[o,r,e,a,n])),!p)return o(!1);app._runtime.name.toString();r=r.toString();t.file&&t.file.binary?t.file.binary:app._runtime.binary;var i=t.file&&t.file.compress?!!t.file.compress:!!app._runtime.compression,s=t.file&&t.file.crypt?!!t.file.crypt:!!app._runtime.encryption;if(i)return app.error("app.start.attemptLoad","Misleading settings.","compression",!0),o(!1);var l=null,c=function(e,t){if(!app.checkFile(e,l))return t("check");for(var p in a){var o=a[p].toString();if(o in e==!1)return t("schema");app.store.set(r+"_"+o,e[o])}t(!1,!0)},u=!1,f=parseInt(t.open_attempts);app.os.scriptOpen(function(t,e){if(r in app._root.window==0)return app.error("app.start.attemptLoad() > _attempt","source"),o(!1);try{if(t=app._root.window[r],s)!function(e,t){var p=null;if(!(app._runtime.secret&&"string"==typeof app._runtime.secret&&app._runtime.secret in app._root.document))return t("runtime");p=app._root.document[app._runtime.secret];try{if(!(e=(e=CryptoJS.AES.decrypt(e,p,{mode:CryptoJS.mode.CTR,padding:CryptoJS.pad.NoPadding})).toString(CryptoJS.enc.Utf8)))throw"decryption";t(!1,e)}catch(e){t(e)}}(t,function(e,t){if(e)throw e;if(!n)return o(!1);app.os.generateJsonChecksum(function(e){if(!e)throw null;l=e,t=JSON.parse(t),c(t,function(e,t){if(e)throw e;o(t)})},t)});else if(n){var p=JSON.stringify(t);app.os.generateJsonChecksum(function(e){if(!e)throw null;l=e,c(t,function(e,t){if(e)throw e;o(t)})},p)}else o(!1)}catch(e){app.error("app.start.attemptLoad() > _attempt",e),o(u)}},e,r,f)},app.start.redirect=function(e){setTimeout(function(){app.start.progress(0),app.redirect(),this.clearTimeout()},1e3)},app.start.alternative=function(){var e=app._root.window.appe__config||app._root.process.env.appe__config;if(!e)return app.stop("app.start.alternative");if("object"!=typeof e.alt||!e.alt.exec_folder||!e.alt.exec_platform)return app.error("app.start.alternative","config");var t=app.utils.system(),p={chrome:"Chrome",safari:"Safari",firefox:"Firefox",edge:"Edge",ie:"Explorer",iemobile:"Explorer"}[t.name],o=t.platform in e.alt.exec_platform?t.platform:null,r="";if(r=app.i18n("This application cannot be run due to restrictions into the software {{browser}}.",null,p),o&&e.alt.exec_folder&&e.alt.exec_folder){var a=e.alt.exec_folder.toString(),n=o in e.alt.exec_platform?e.alt.exec_platform[o].toString():"";r+=app.i18n('GO TO FOLDER "{{alt_exec_folder}}" AND OPEN "{{alt_exec_platform}}."',null,{alt_exec_folder:a,alt_exec_platform:n})}r=r.replace("{browser}",p),app.start.progress(1),app.error(r),app.blind()},app.start.load=function(){var e=app._root.window.appe__config||app._root.process.env.appe__config;if("object"!=typeof e)return app.stop("app.start.load");var o="assign"in Object?Object.assign({},e):app.utils.extendObject({},e);"secret_passphrase"in e&&delete e.secret_passphrase,app.checkConfig(o);var t=!0;null==app._root.window.native&&("sessionStorage"in window==0&&"localStorage"in window==0||"FileReader"in window==0||"Blob"in window==0||"history"in window==0||"atob"in window==0||"btoa"in window==0?t=!1:void 0!==sessionStorage&&"replaceState"in history!=!1&&"checkValidity"in document.createElement("form")!=!1||(t=!1));var r=function(){var e=!(void 0===app._root.server.appe__locale),t=document.getElementById("start-action-open"),p=document.getElementById("start-action-new");app.utils.addEvent("click",t,app.openSession),app.utils.addEvent("click",p,app.newSession),e&&function(){var e=app._root.document.querySelectorAll("[data-localize]");e.length&&Array.prototype.forEach.call(e,function(e){app.layout.localize(e)})}()};app.session(function(){if("secret_passphrase"in o&&delete o.secret_passphrase,t){app.controller.setTitle(o.app_name),null==app._root.document.native&&r();var p=app.resume(o);!function(t){var e=o.aux&&"object"==typeof o.aux?o.aux:[];if(e.length)for(var p=e.length;p--;)app.start.attemptLoad(function(e){return e?p?void 0:t(!1,!0):t("aux")},e[p].fn,e[p].file,e[p].schema,e[p].memoize);else t(!1,!0)}(function(e,t){if(e)return app.stop("app.start.load","aux");app.start.loadComplete(p)})}else o.alt&&start&&"alternative"in start&&"function"==typeof start.alternative?start.alternative():o.alt?app.start.alternative():app.blind()},o)},app.main={},app.main.control=function(e){var t=app._root.window.appe__config||app._root.process.env.appe__config;if(!t)return app.stop("app.main.control");if(!t.routes||"object"!=typeof t.routes||!t.events||"object"!=typeof t.events)return app.error("app.main.control","config");for(var p=t.routes,o=t.events,r=Object.keys(o),a=null,n=0,i={};a=r[n++];)i[o[a]]=a;e||(e=app.controller.spoof());var s=t.default_route.toString(),l=s+".html",c=!0;if(e&&"object"==typeof e?e.view?(p[e.view]?l=encodeURIComponent(e.view)+".html":c=!1,e.action&&(p[e.view][e.action]?(l=p[e.view][e.action].toString()+".html",l+="?"+encodeURIComponent(e.action)):c=!1,e.index&&(l+="&id="+encodeURIComponent(e.index)))):e={view:s}:c=!1,!c||"string"!=typeof l)return app.stop("app.main.control",[e]);if(app.controller.cursor(e),!app._root.document.native){var u="views/"+l,f=app._root.document.getElementById("view");f.removeAttribute("height"),f.setAttribute("src",u),"list"==i[e.action]?app._root.document.body.classList.add("full-width"):app._root.document.body.classList.remove("full-width");var d=app._root.document.getElementById("master-navigation"),m=d.querySelector("li.active"),v=d.querySelector('a[data-view="'+e.view+'"]');m&&m.classList.remove("active"),v&&v.parentNode.classList.add("active")}},app.main.handle=function(e){var t=app._root.window.appe__config||app._root.process.env.appe__config;if(!t)return app.stop("app.main.handle");if(!t.events||"object"!=typeof t.events)return app.error("app.main.handle","config");var p=app._root.server.appe__main,o=app.main.handle.prototype;if(!e.data)return app.error("app.main.handle",[e]);try{o.ctl=JSON.parse(e.data)}catch(e){return app.error("app.main.handle",e)}var r=t.events;return o.events=app.utils.extendObject(r,{resize:"resize",refresh:"refresh",export:"export"}),o.event=null,o.ctl.action&&o.ctl.action in o.events?(o.event=o.ctl.action,o._initialized=!0,o.loc="assign"in Object?Object.assign({},o.ctl):app.utils.extendObject({},o.ctl),o._href="",o._title="",o._msg="",p&&"handle"in p&&"function"==typeof p.handle?p.handle(o,o.event,o.ctl):o[o.event].apply(o)):app.error("app.main.handle",o.ctl)},app.main.handle.prototype.getID=function(){return parseInt(this.ctl.index)},app.main.handle.prototype.setAction=function(){return this.ctl.action in this.events==!1?app.error("app.main.prototype.setAction","ctl"):(this.loc.action=this.events[this.loc.action].toString(),this.loc.action)},app.main.handle.prototype.getAction=function(){return this.loc.action?this.loc.action:app.error("app.main.prototype.setAction","loc")},app.main.handle.prototype.setTitle=function(e){return e&&"string"==typeof e?(this._title=e,this._title):app.error("app.main.handle.prototype.setTitle","title")},app.main.handle.prototype.getTitle=function(){return this._title?this._title:this.ctl.title&&"string"==typeof this.ctl.title&&this.ctl.title},app.main.handle.prototype.setMsg=function(e){return e&&"string"==typeof e?(this._msg=e,this._msg):app.error("app.main.handle.prototype.setMsg","msg")},app.main.handle.prototype.getMsg=function(){return this._msg?this._msg:this.ctl.msg&&"string"==typeof this.ctl.msg&&this.ctl.msg},app.main.handle.prototype.setURL=function(e,t){var p="index.html";return p+=(e||this.ctl.view)&&"?"+(e&&"string"==typeof e?e:this.ctl.view),p+=t&&"&"+(t&&"string"==typeof t&&t),this._href=p,this._href},app.main.handle.prototype.getURL=function(){return this._href},app.main.handle.prototype.redirect=function(){var e=this.getURL();app._root.window.location.href=e},app.main.handle.prototype.refresh=function(){app._root.window.location.reload()},app.main.handle.prototype.resize=function(){if(this.ctl.height){var e=parseInt(this.ctl.height),t=app._root.document.getElementById("view");t.height=e,t.scrolling="no"}},app.main.handle.prototype.selection=function(){this.refresh()},app.main.handle.prototype.export=function(){if(!Blob)return app.error("app.main.handle.prototype.export","Blob");if(!FileReader)return app.error("app.main.handle.prototype.export","FileReader");if(!this.ctl.data||!this.ctl.file||"object"!=typeof this.ctl.file)return app.error("app.main.handle.prototype.export","ctl");if(!this.ctl.file.name||"string"!=typeof this.ctl.file.name||!this.ctl.file.type||"string"!=typeof this.ctl.file.type)return app.error("app.main.handle.prototype.export","file");try{app.os.fileDownload(this.ctl.data,this.ctl.file.name,this.ctl.file.type)}catch(e){return app.error("app.main.handle.prototype.export",e)}},app.main.handle.prototype.prepare=function(){var e=this.setAction(),t=this.getID();this.setURL(null,e+(t&&"="+t)),this.ctl.history&&this.history(),this.receiver()},app.main.handle.prototype.prevent=function(){var e=this.setAction(),t=this.getMsg();if(!t)return app.error("app.main.handle.prototype."+this.event,"msg");this.setURL(null,e),confirm(t)&&this.receiver()},app.main.handle.prototype.open=app.main.handle.prototype.prepare,app.main.handle.prototype.add=app.main.handle.prototype.prepare,app.main.handle.prototype.edit=app.main.handle.prototype.prepare,app.main.handle.prototype.update=app.main.handle.prototype.prepare,app.main.handle.prototype.delete=app.main.handle.prototype.prevent,app.main.handle.prototype.close=app.main.handle.prototype.prevent,app.main.handle.prototype.history=function(){var e=this.getTitle(),t=this.getURL();app.controller.history(e,t)},app.main.handle.prototype.receiver=function(){var e=app._root.window.appe__config||app._root.process.env.appe__config;if(!e)return app.stop("app.main.handle.prototype.receiver");var t=e.schema;if("object"!=typeof t)return app.error("app.main.handle.prototype.receiver","schema");var p=app._runtime.name.toString();if(this.ctl.submit&&this.ctl.data){var o=this.getAction();try{var r=this,a=JSON.parse(this.ctl.data);app.controller.store(function(){var e=app.controller.spoof();e.action=null,e.index=null,"update"===o?r.refresh():app.main.control(e)},p,t,a)}catch(e){return app.error("app.main.handle.prototype.receiver",e)}}else app.main.control(this.loc)},app.main.action=function(e,t,p){if(!(app._root.window.appe__config||app._root.process.env.appe__config))return app.stop("app.main.action");app._root.server.appe__main;var o=app.main.action.prototype;return e&&e instanceof Array==!1||!t||!p?app.error("app.main.action",[e,t,p]):(this._initialized=!1,o)},app.main.action.prototype.isInitialized=function(e){if(!this._initialized)return app.error("app.main.action.prototype.isInitialized",e)},app.main.action.prototype.begin=function(){this._initialized=!0},app.main.action.prototype.end=function(){this.isInitialized("end"),this._initialized=!1},app.main.action.prototype.menu=function(e){if(this.isInitialized("menu"),!("jQuery"in app._root.window&&"collapse"in jQuery.fn)){if(!e)return app.error("app.main.action.prototype.menu",[e]);var t=app._root.document.querySelector(e.getAttribute("data-target"));if(!e.getAttribute("data-is-visible")){e.setAttribute("data-is-visible",!0),e.setAttribute("aria-expanded",!1),t.setAttribute("aria-expanded",!1);var p="ontouchstart"in document.documentElement?"touchstart":"click";app.utils.addEvent(p,app._root.document.documentElement,app.layout.collapse("close",e,t))}app.layout.collapse("toggle",e,t)(),app._root.window.scrollTo(0,0)}},app.main.setup=function(){var e=app._root.server.appe__main;e&&"setup"in e&&"function"==typeof e.setup&&e.setup(app.data()),app.main.control()},app.main.load=function(){var e=app._root.window.appe__config||app._root.process.env.appe__config;if("object"!=typeof e)return app.stop("app.main.load");var t="assign"in Object?Object.assign({},e):app.utils.extendObject({},e);"secret_passphrase"in e&&delete e.secret_passphrase,app.checkConfig(t);var p=function(){var e=!(void 0===app._root.server.appe__locale);app._root.document.getElementById("brand");brand.innerHTML=app.controller.getTitle();var t=app._root.document.querySelectorAll(".main-action-open"),p=app._root.document.querySelectorAll(".main-action-new"),o=app._root.document.querySelectorAll(".main-action-save");app._root.document.querySelectorAll("[data-localize]");t.length&&Array.prototype.forEach.call(t,function(e){app.utils.addEvent("click",e,app.openSession)}),p.length&&Array.prototype.forEach.call(p,function(e){app.utils.addEvent("click",e,app.newSession)}),o.length&&Array.prototype.forEach.call(o,function(e){app.utils.addEvent("click",e,app.saveSession)}),e&&function(){var e=app._root.document.querySelectorAll("[data-localize]");e.length&&Array.prototype.forEach.call(e,function(e){app.layout.localize(e)})}()};app.session(function(){"secret_passphrase"in t&&delete t.secret_passphrase,app.resume(t,!0);var e=t.aux&&"object"==typeof t.aux?t.aux:[];e.push({file:"",fn:app._runtime.name,schema:t.schema}),app.controller.retrieve(app.main.setup,e),app.controller.setTitle(t.app_name),app.utils.addEvent("message",app._root.window,app.main.handle),null==app._root.document.native&&p()},t,!0)},app.main.unload=function(){if(!app.memory.has("save_reminded")&&app.memory.get("last_time")!==app.memory.get("last_stored"))return app.memory.set("save_reminded",!0),!0},app.view={},app.view.spoof=function(){var e={action:null,index:null};if(-1==app._root.window.location.href.indexOf("?"))return e;var t=app._root.window.location.href.split("?")[1];if(-1!=t.indexOf("&"))if(-1!=(t=t.split("&"))[1].indexOf("=")){var p=t[1].split("=");e={action:t[0],index:parseInt(p[1])}}else e={action:t[1]};return e},app.view.control=function(e,t,p){if(!(app._root.window.appe__config||app._root.process.env.appe__config))return app.stop("app.view.control");if(!app._root.server.appe__control)return app.error("app.view.control","control");var o=!(void 0===app._root.server.appe__locale),r=app.view.control.prototype;return e&&e instanceof Array==!1||t&&"object"!=typeof t?app.error("app.view.control",[e,t,p]):(r._initialized=!1,r._is_localized=o,r.events=e||null,r.data=t||{},r.form=p||null,r.ctl={},r)},app.view.control.prototype.isInitialized=function(e){if(!this._initialized)return app.error("app.view.control.prototype.isInitialized",e)},app.view.control.prototype.begin=function(){var e=app._root.window.appe__config||app._root.process.env.appe__config;if(!e)return app.stop("app.view.control.prototype.begin");if(!e.routes||"object"!=typeof e.routes||!e.events||"object"!=typeof e.events)return app.error("app.view.control.prototype.begin","config");var t=app.controller.cursor(),p=null,o=null,r=0;t&&"view"in t&&(p=t.view);var a=e.routes,n=e.events,i={};Array.prototype.forEach.call(Object.keys(n),function(e){i[n[e]]=e});var s=app.view.spoof(),l=e.default_event.toString(),c=!0;return s&&"object"==typeof s?s.action?(a[p][s.action]?o=i[s.action]:c=!1,s.index&&(r=s.index)):o=l:c=!1,this.events&&-1===this.events.indexOf(o)||!c?app.error("app.view.control.prototype.begin","event"):(control.temp={},this._initialized=!0,o&&"add"===(o=this.setEvent(o))&&(r=this.getLastID()),r=this.setID(r))},app.view.control.prototype.end=function(){if(this.isInitialized("end"),app.view.resize(!0),this.form){control.temp.form=!0,control.temp.form_submit=!1,control.temp.form_elements=this.form.elements,control.temp.form_changes=null;try{var e=app.view.getFormData(this.form.elements);control.temp.form_changes=e&&JSON.stringify(e)}catch(e){return app.error("app.view.control.prototype.end",e)}}_initialized=!1},app.view.control.prototype.setID=function(e){return this.isInitialized("setID"),control.temp.id=parseInt(e),control.temp.id},app.view.control.prototype.getID=function(){return this.isInitialized("getID"),control.temp.id?parseInt(control.temp.id):(app.error("app.view.control.prototype.getID","id"),0)},app.view.control.prototype.getLastID=function(){this.isInitialized("getLastID");var e=Object.keys(this.data).pop();return e?parseInt(e)+1:1},app.view.control.prototype.setEvent=function(e){return this.isInitialized("setEvent"),this.events&&-1===this.events.indexOf(e)?app.error("app.view.control.prototype.setEvent","event"):(control.temp.event=e.toString(),control.temp.event)},app.view.control.prototype.getEvent=function(){return this.isInitialized("getEvent"),control.temp.event.toString()},app.view.control.prototype.setTitle=function(e,t,p){this.isInitialized("setTitle");var o=this.getEvent();p=0!=p?parseInt(p):app.view.control.prototype.getID(),"edit"===o&&p&&("rtl"==app._runtime.locale_dir?e="# "+p+" "+e:e+=" # "+p);var r=app._root.document.getElementById("view-title"),a=app._root.document.getElementById("section-title");null!=t&&(r.innerHTML=t),null!=e&&(a.innerHTML=e)},app.view.control.prototype.setActionHandler=function(e,t){this.isInitialized("setActionHandler");var p=this.getEvent();t=parseInt(t)||this.getID();var o=app._root.document.getElementById("submit"),r=app._root.document.getElementById("index");if(!r)return app.error("app.view.control.prototype.setActionHandler","action_index");if(r.setAttribute("value",t),o){var a=o.getAttribute("onclick");a=a.replace("{action_event}",p),o.setAttribute("onclick",a)}e&&"string"==typeof e&&(o.innerHTML=e)},app.view.control.prototype.denySubmit=function(){this.isInitialized("denySubmit");var e=app._root.document.getElementById("submit");e&&(e.removeAttribute("onclick"),e.setAttribute("disabled","")),this.form&&this.form.setAttribute("action","")},app.view.control.prototype.fillTable=function(e,t,p){if(this.isInitialized("fillTable"),!e)return app.error("app.view.control.prototype.fillTable",[e,t,p]);var o=t;t&&"object"==typeof t||(o=this.data),p=p&&p instanceof Array?p:Object.keys(o);var r=Object.values(arguments).slice(3),a=e.querySelector("tbody"),n=a.querySelector("tr.tpl").cloneNode(!0);n.classList.remove("tpl");var i="";return"renderRow"in control&&"function"==typeof control.renderRow&&(Array.prototype.forEach.call(p,function(e){var t=control.renderRow(n,e,o[e],r);i+=t.outerHTML}),a.innerHTML=i,this._is_localized&&this.localize(e)),{rows:i,tpl:n,data:o,args:r}},app.view.control.prototype.fillForm=function(e,t){if(this.isInitialized("fillForm"),!this.form)return app.error("app.view.control.prototype.fillForm",[e,t]);var p=t;t&&"object"==typeof t||(p=this.data);var o=Object.values(arguments).slice(2);return"fillForm"in control&&"function"==typeof control.fillForm&&(control.fillForm(p,o),this._is_localized&&this.localize(e)),{data:p,args:o}},app.view.control.prototype.fillSelection=function(e,t){if(this.isInitialized("fillSelection"),!e||"object"!=typeof e)return app.error("app.view.control.prototype.fillSelection",[e,t]);var p=app._root.document.getElementById("selection");(t=t||null)?(p.innerHTML=app.layout.renderSelectOptions(p,e,t),p.value=t):p.parentNode.classList.add("hidden")},app.view.control.prototype.fillCTA=function(e){this.isInitialized("fillCTA"),e=parseInt(e);var t=app._root.document.getElementById("section-actions-top"),p=app._root.document.getElementById("section-actions-bottom");t&&(e?t.innerHTML=t.innerHTML.replace(/\{id\}/g,e):Array.prototype.forEach.call(t.querySelectorAll(".action"),function(e){e.remove()})),p&&(e?p.innerHTML=p.innerHTML.replace(/\{id\}/g,e):Array.prototype.forEach.call(p.querySelectorAll(".action"),function(e){e.remove()}))},app.view.control.prototype.localize=function(e){if(this.isInitialized("localize"),!e)return app.error("app.view.control.prototype.localize",[e]);var t=e.querySelectorAll("[data-localize]");t.length&&Array.prototype.forEach.call(t,function(e){app.layout.localize(e)})},app.view.action=function(e,t,p,o){var r=app._root.window.appe__config||app._root.process.env.appe__config;if(!r)return app.stop("app.view.action");if(!app._root.server.appe__control)return app.error("app.view.action","control");var a=!(void 0===app._root.server.appe__locale),n=app.view.action.prototype;return e&&e instanceof Array==!1||!t||!p?app.error("app.view.action",[e,t,p,o]):(n._initialized=!1,n._is_localized=a,r.events&&"object"==typeof r.events?(n.cfg_events=r.events,n.events=e,n.event=t.toString(),n.element=p,n.form=o||null,n.ctl={},n):app.error("app.view.action","config"))},app.view.action.prototype.isInitialized=function(e){if(!this._initialized)return app.error("app.view.action.prototype.isInitialized",e)},app.view.action.prototype.begin=function(){if(this.events&&-1===this.events.indexOf(this.event))return app.error("app.view.action.prototype.begin","event");this._initialized=!0},app.view.action.prototype.end=function(){this.isInitialized("end"),this._initialized=!1},app.view.action.prototype.getID=function(){this.isInitialized("getID");var e=0;try{e=this.element.parentNode.parentNode.getAttribute("data-index")}catch(e){}return!e&&control.temp.id&&(e=control.temp.id),parseInt(e)},app.view.action.prototype.validateForm=function(){if(this.isInitialized("validateForm"),!this.form)return app.error("app.view.action.prototype.validateForm","form");var e=app._root.document.getElementById("real-submit");return e?!this.form.checkValidity()&&(Array.prototype.forEach.call(this.form.elements,function(e){var t=null;-1!=e.parentNode.className.indexOf("form-group")?t=e.parentNode:-1!=e.parentNode.parentNode.className.indexOf("form-group")&&(t=e.parentNode.parentNode),t&&t.classList&&(t.querySelector(":invalid")?(t.classList.remove("has-success"),t.classList.add("has-error")):(t.classList.remove("has-error"),t.classList.add("has-success")))}),e.click(),!0):app.error("app.view.action.prototype.validateForm","action_submit")},app.view.action.prototype.prepare=function(e,t){if(this.isInitialized(this.event),e&&"object"!=typeof e)return app.error("app.view.action.prototype."+this.event,[e,t]);var p=this.getID(),o=self.cfg_events?self.cfg_events[this.event].toString():this.event;try{if(this.ctl.action=this.event,p&&(this.ctl.index=parseInt(p),"update"!=this.event&&(this.ctl.history=!0,this.ctl.title=this.ctl.title&&"string"==typeof this.ctl.title?'"'+this.ctl.index+'"':"# "+this.ctl.index,o&&(o=o[0].toUpperCase()+o.slice(1),this._is_localized&&(o=app.i18n(o,"action")||o),this.ctl.title="rtl"==app._runtime.locale_dir?this.ctl.title+" "+o:o+" "+this.ctl.title))),!0===t&&(this.ctl.submit=!0,this.ctl.data=JSON.stringify(e),control.temp.form)){control.temp.form_submit=!0;var r=app.view.getFormData(this.form.elements);control.temp.form_changes=r&&JSON.stringify(r)}return this.ctl}catch(e){return app.error("app.view.action.prototype."+this.event,e)}},app.view.action.prototype.prevent=function(e,t,p,o){if(!(app._root.window.appe__config||app._root.process.env.appe__config))return app.stop("app.view.action.prototype.prevent");if(this.isInitialized(this.event),"string"!=typeof p||e&&"object"!=typeof e)return app.error("app.view.action.prototype."+this.event,[e,t,p,o]);var r=self.cfg_events?self.cfg_events[this.event].toString():this.event;return this._is_localized&&(r=app.i18n(r,"event")||r),!p||"number"!=typeof o&&"string"!=typeof o?this.ctl.msg=p:(o="rtl"==app._runtime.locale_dir?"number"==typeof o?parseInt(o)+" #":'"'+o+'"':"number"==typeof o?"# "+parseInt(o):'"'+o+'"',this.ctl.msg=app.i18n("Are you sure to {{placeholder}} {{name}} {{title}}?","action",{placeholder:r,name:o,title:p})),this.prepare(e,t)},app.view.action.prototype.open=app.view.action.prototype.prepare,app.view.action.prototype.add=app.view.action.prototype.prepare,app.view.action.prototype.edit=app.view.action.prototype.prepare,app.view.action.prototype.update=app.view.action.prototype.prepare,app.view.action.prototype.delete=app.view.action.prototype.prevent,app.view.action.prototype.close=app.view.action.prototype.prevent,app.view.action.prototype.selection=function(){this.isInitialized("selection");var e={id:this.element.value?this.element.value.toString():""};return this.prepare(e,!0)},app.view.action.prototype.print=function(){this.isInitialized("print"),print()},app.view.sub=function(e,t,p){if(!(app._root.window.appe__config||app._root.process.env.appe__config))return app.stop("app.view.sub");var o=app.view.sub.prototype;return e&&t?o[e](t,p):app.error("app.view.sub",[e,t,p])},app.view.sub.prototype.csv=function(e,t){var p=app._root.window.appe__config||app._root.process.env.appe__config;if(!p)return app.stop("app.view.sub.prototype.csv");if(!e||!t)return app.error("app.view.sub.prototype.csv",[e,t]);var o="",r=app.view.convertTableCSV(t);Array.prototype.forEach.call(r,function(e){o+=e.join(";")+"\r\n"});var a="csv_export",n="_",i="Y-m-d_H-M-S";p.csv&&"object"==typeof p.csv&&(a=p.csv.filename_prefix.toString(),n=p.csv.filename_separator.toString(),i=p.csv.filename_date_format.toString());var s=a,l={action:"export",file:{name:(s+=n+app.utils.dateFormat(!0,i))+".csv",type:"text/csv;charset=utf-8"},data:o};return app.view.send(l)},app.view.sub.prototype.clipboard=function(e,t){if(!e||!t)return app.error("app.view.sub.prototype.clipboard",[e,t]);var p="",o=app.view.convertTableCSV(t);Array.prototype.forEach.call(o,function(e){p+=e.join("\t")+"\r\n"}),app.view.copyToClipboard(p);var r=e.parentNode.parentNode.parentNode.querySelector(".dropdown-toggle");r.classList.add("btn-gray-lighter");var a=setTimeout(function(){r.classList.remove("btn-gray-lighter"),clearTimeout(a)},1e3)},app.view.sub.prototype.toggler=function(e,t){if(!("jQuery"in app._root.window&&"dropdown"in jQuery.fn)){if(!e)return app.error("app.view.sub.prototype.clipboard",[e]);if(t=t||e.parentNode.parentNode.parentNode,!e.getAttribute("data-is-visible")){e.setAttribute("data-is-visible",!0);var p="ontouchstart"in document.documentElement?"touchstart":"click";app.utils.addEvent(p,app._root.document.documentElement,app.layout.dropdown("close",e,t))}app.layout.dropdown("toggle",e,t)()}},app.view.handle=function(){if(!(app._root.window.appe__config||app._root.process.env.appe__config))return app.stop("app.view.handle");var e=app._root.server.appe__control;if(!e)return app.error("app.view.handle","control");"handle"in e&&"function"==typeof e.handle&&e.handle(app.data()),app.utils.addEvent("resize",app._root.window,app.view.resize),app.utils.addEvent("orientationchange",app._root.window,app.view.resize)},app.view.send=function(e){if(!(app._root.window.appe__config||app._root.process.env.appe__config))return app.stop("app.view.action");if(!app._root.server.appe__control)return app.error("app.view.action","control");if(e){if("object"!=typeof e)return app.error("app.view.send",[e]);if("view"in e==!1){var t=app.controller.cursor();t&&"view"in t&&(e.view=t.view)}if("action"in e!=!1)try{app._runtime.debug&&console.info("app.view.send",e),e=JSON.stringify(e),app._root.window.parent.postMessage(e,"*")}catch(e){return app.error("app.view.send",e)}}},app.view.resize=function(e){var t=app._root.server.appe__control;if(t&&t.temp){if(e){if((new Date).getTime()-t.temp.last_resize<1e3)return;t.temp.last_resize=(new Date).getTime()}var p={action:"resize",height:app._root.document.documentElement.scrollHeight};return app.view.send(p)}},app.view.getFormData=function(e){if(!e||!e.length)return app.error("app.view.getFormData",[e]);for(var t={},p={},o=0;p=e[o++];)if("FIELDSET"!=p.nodeName){var r=p.name,a=p.value.trim(),n=p.getAttribute("data-transform")||!1,i=p.getAttribute("data-sanitize")||!1;if(p.type&&("checkbox"!=p.type&&"radio"!=p.type||(a=!!p.checked)),n&&(a=app.utils.transform(n,a)),i&&(a=app.utils.sanitize(i,a)),void 0===a&&(a=null),r){r=r.match(/([\w]+)/g,"$1");var s={};Array.prototype.reduce.call(r,function(e,t,p){return e[t]=p!=r.length-1&&{}||a},s),app.utils.extendObject(!0,t,s)}}return t},app.view.convertTableCSV=function(e){if(!e)return app.error("app.view.convertTableCSV",[e]);var t=e.querySelectorAll("thead tr:not(.hidden-csv) th"),p=e.querySelectorAll("tbody tr:not(.hidden-csv)"),o=[[]];Array.prototype.forEach.call(t,function(e){e.classList.contains("hidden-print")||o[0].push(e.textContent)});var r=0;return Array.prototype.forEach.call(p,function(e){if(!e.classList.contains("tpl")){var t=e.querySelectorAll("td");o[++r]=[],Array.prototype.forEach.call(t,function(e){if(!e.classList.contains("hidden-print")){var t=e.querySelector(".form-control");t?o[r].push(t.value):o[r].push(e.textContent)}})}}),o},app.view.copyToClipboard=function(e){if(!e)return app.error("app.view.copyToClipboard",[e]);var t=app._root.document.createElement("TEXTAREA");if(t.style="position: absolute; top: 0; right: 0; width: 0; height: 0; z-index: -1; overflow: hidden;",t.value=e,app._root.document.body.appendChild(t),"ios"!=app._runtime.system.platform)t.focus(),t.select();else{var p=app._root.document.createRange();p.selectNodeContents(t);var o=getSelection();o.removeAllRanges(),o.addRange(p),t.setSelectionRange(0,999999)}app._root.document.execCommand("copy"),app._root.document.body.removeChild(t)},app.view.load=function(){var e=app._root.window.appe__config||app._root.process.env.appe__config;if("object"!=typeof e)return app.stop("app.view.load");var t="assign"in Object?Object.assign({},e):app.utils.extendObject({},e);"secret_passphrase"in e&&delete e.secret_passphrase;var p=function(){!(void 0===app._root.server.appe__locale)&&function(){var e=app._root.document.querySelectorAll("[data-localize]");e.length&&Array.prototype.forEach.call(e,function(e){app.layout.localize(e)})}()};app.session(function(){"secret_passphrase"in t&&delete t.secret_passphrase,app.resume(t,!1);var e=t.aux&&"object"==typeof t.aux?t.aux:[];e.push({fn:app._runtime.name,schema:t.schema}),app.controller.retrieve(app.view.handle,e),null==app._root.document.native&&p()},t,!1)},app.view.unload=function(){var e=app._root.server.appe__control;if(!e)return app.error("app.view.unload","control");if(e.temp.form&&!e.temp.form_submit){try{var t=app.view.getFormData(e.temp.form_elements);t=t&&JSON.stringify(t)}catch(e){return app.error("app.view.unload",e)}if(e.temp.form_changes!==t)return!0}},app.layout={},app.layout.renderElement=function(e,t,p){if("string"!=typeof e||t&&"string"!=typeof t||p&&"object"!=typeof p)return app.error("app.layout.renderElement",[e,t,p]);var o=e.toLowerCase(),r="<"+o;if(p){var a=Object.keys(p);for(var n in a)null!==p[a[n]]&&(n!=a.length&&(r+=" "),r+=p[a[n]]?a[n]+'="'+p[a[n]].toString()+'"':a[n])}return r+=t?">"+t+"</"+o+">":">"},app.layout.renderSelect=function(e,t,p,o){if(!e||"object"!=typeof t)return app.error("app.layout.renderSelectOptions",[e,t,p,o]);var r=app.utils.extendObject({id:e},o),a="";return t&&(a=app.layout.renderSelectOptions(e,t,p)),app.layout.renderElement("select",a,r)},app.layout.renderSelectOption=function(e,t,p){return e&&t?app.layout.renderElement("option",t,{value:e,selected:p?"":null}):app.error("app.layout.renderSelectOption",[e,t,p])},app.layout.renderSelectOptionGroup=function(e,t){return e&&t?app.layout.renderElement("optgroup",t,{label:e}):app.error("app.layout.renderSelectOptionGroup",[e,t])},app.layout.renderSelectOptions=function(e,t,r){if(!e||"object"!=typeof t)return app.error("app.layout.renderSelectOptions",[e,t,r]);var a="";return Array.prototype.forEach.call(t,function(e){var t=Object.keys(e)[0],p=e[t];if(p instanceof Array){var o="";Array.prototype.forEach.call(p,function(e){if("object"==typeof e)var t=e[p=Object.keys(e)[0]];else var p=t=e;o+=app.layout.renderSelectOption(p,t,r)}),a+=app.layout.renderSelectOptionGroup(t,o)}else a+=app.layout.renderSelectOption(t,p,r)}),a},app.layout.dropdown=function(e,t,p){if(!e||!t||!p)return app.error("app.view.dropdown",[e,t,p]);var o=app.layout.dropdown.prototype;return o.event=e,o.element=t,o.dropdown=p,o[e].bind(o)},app.layout.dropdown.prototype.open=function(e){app._runtime.debug&&console.info("app.layout.collapse.prototype.open",e&&e.target,e),"true"!==this.element.getAttribute("aria-expanded")&&(e&&e.target&&(e.target===this.element||e.target.offsetParent===this.element)||(this.element.parentNode.classList.add("open"),this.element.setAttribute("aria-expanded",!0),this.dropdown.classList.add("open"),this.dropdown.querySelector(".dropdown-toggle").setAttribute("aria-expanded",!0)))},app.layout.dropdown.prototype.close=function(e){app._runtime.debug&&console.info("app.layout.collapse.prototype.open",e&&e.target,e),"false"!==this.element.getAttribute("aria-expanded")&&(e&&e.target&&(e.target===this.element||e.target.offsetParent===this.element)||(this.element.parentNode.classList.remove("open"),this.element.setAttribute("aria-expanded",!1),this.dropdown.classList.remove("open"),this.dropdown.querySelector(".dropdown-toggle").setAttribute("aria-expanded",!1)))},app.layout.dropdown.prototype.toggle=function(){app._runtime.debug&&console.info("app.layout.dropdown.prototype.toggle"),"false"===this.element.getAttribute("aria-expanded")?this.open():this.close()},app.layout.collapse=function(e,t,p){if(!e||!t||!p)return app.error("app.layout.collapse",[e,t,p]);var o=app.layout.collapse.prototype;return o.event=e,o.element=t,o.collapsible=p,o[e].bind(o)},app.layout.collapse.prototype.open=function(e){app._runtime.debug&&console.info("app.layout.collapse.prototype.open",e&&e.target,e),"true"!==this.element.getAttribute("aria-expanded")&&(e&&e.target&&(e.target===this.element||e.target.offsetParent===this.element)||(this.collapsible.classList.add("collapse"),this.collapsible.classList.add("in"),this.collapsible.setAttribute("aria-expanded",!0),this.element.setAttribute("aria-expanded",!0),this.element.classList.remove("collapsed")))},app.layout.collapse.prototype.close=function(e){app._runtime.debug&&console.info("app.layout.collapse.prototype.open",e&&e.target,e),"false"!==this.element.getAttribute("aria-expanded")&&(e&&e.target&&(e.target===this.element||e.target.offsetParent===this.element)||(this.collapsible.classList.remove("collapse"),this.collapsible.classList.remove("in"),this.collapsible.setAttribute("aria-expanded",!1),this.element.setAttribute("aria-expanded",!1),this.element.classList.add("collapsed")))},app.layout.collapse.prototype.toggle=function(){app._runtime.debug&&console.info("app.layout.collapse.prototype.toggle"),"false"===this.element.getAttribute("aria-expanded")?this.open():this.close()},app.layout.draggable=function(t,p,e,o){if(!t||!p)return app.error("app.view.draggable",[t,p,field]);var r=app.layout.draggable.prototype;e=e||".draggable",o="function"==typeof o?o:null,p._draggable||(p._draggable={row:e,current:null,prev_index:null,next_index:null});return function(e){return r[t].apply(this,[e,p,o])}},app.layout.draggable.prototype.start=function(e,t,p){if(app._runtime.debug&&console.info("app.layout.draggable.prototype.start",e,t._draggable),e.stopPropagation&&e.stopPropagation(),t._draggable.current=this,t._draggable.next_index=this.getAttribute("data-index"),e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/html",this.innerHTML),this.classList.add("move"),p&&"function"==typeof p&&p.apply(this,[e,t]),!e.stopPropagation)return!1},app.layout.draggable.prototype.over=function(e,t,p){if(app._runtime.debug&&console.info("app.layout.draggable.prototype.over",e,t._draggable),e.preventDefault&&e.preventDefault(),e.dataTransfer.dropEffect="move",p&&"function"==typeof p&&"function"==typeof p&&p.apply(this,[e,t]),!e.preventDefault)return!1},app.layout.draggable.prototype.enter=function(e,t,p){if(app._runtime.debug&&console.info("app.layout.draggable.prototype.enter",e,t._draggable),e.preventDefault&&e.preventDefault(),this.classList.add("over"),p&&"function"==typeof p&&p.apply(this,[e,t]),!e.preventDefault)return!1},app.layout.draggable.prototype.leave=function(e,t,p){if(app._runtime.debug&&console.info("app.layout.draggable.prototype.leave",e,t._draggable),e.preventDefault&&e.preventDefault(),this.classList.remove("over"),p&&"function"==typeof p&&p.apply(this,[e,t]),!e.preventDefault)return!1},app.layout.draggable.prototype.end=function(e,t,p){app._runtime.debug&&console.info("app.layout.draggable.prototype.end",e,t._draggable),e.preventDefault&&e.preventDefault();var o=document.querySelectorAll(t._draggable.row);if(Array.prototype.forEach.call(o,function(e){e.classList.remove("move"),e.classList.remove("over")}),p&&"function"==typeof p&&p.apply(this,[e,t]),!e.preventDefault)return!1},app.layout.draggable.prototype.drop=function(e,t,p){if(app._runtime.debug&&console.info("app.layout.draggable.prototype.drop",e,t._draggable),e.stopPropagation&&e.stopPropagation(),t._draggable.current!=this?(t._draggable.prev_index=this.getAttribute("data-index"),t._draggable.current.innerHTML=this.innerHTML,t._draggable.current.setAttribute("data-index",t._draggable.prev_index),this.setAttribute("data-index",t._draggable.next_index),this.innerHTML=e.dataTransfer.getData("text/html"),this.querySelector("meta").remove()):t._draggable.next_index=null,p&&"function"==typeof p&&p.apply(this,[e,t]),!e.stopPropagation)return!1},app.layout.localize=function(e){if(app._root.window.appe__locale){if(!e)return app.error("app.layout.localize",[e]);if(!e.localized){var t=e.innerHTML.toString(),p=e.getAttribute("data-localize-replacement"),o=e.getAttribute("data-localize");e.innerHTML=app.i18n(t,o,p),e.localized=!0}}},app.utils={},app.utils.system=function(e){var t,p,o,r={name:null,platform:null,architecture:null,release:null};if(null==app._root.window.native)t=navigator.userAgent.match(/(Chrome|CriOS|Safari|Firefox|Edge|IEMobile|MSIE|Trident)\/([\d]+)/i),p=navigator.userAgent.match(/(iPad|iPhone|iPod|android|windows phone)/i),o=null,t&&(o=t[2]||null,(t=(t=t[1]||t[0]).toLowerCase())&&("crios"===t&&(t="chrome"),-1==t.indexOf("ie")&&"trident"!=t||("trident"===t?o=(o=navigator.userAgent.match(/rv:([\d]+)/i))?(t="ie",o[1]):t=null:t="ie"),r.navigator=t,o&&(r.release=parseFloat(o)))),p?"android"===(p=p[0].toLowerCase())?r.platform="android":"windows phone"===p?r.platform="wm":"ipad"===p?(r.platform="ios",r.model="ipad"):(r.platform="ios",r.model="iphone"):(p=navigator.userAgent.match(/(Win|Mac|Linux)/i))&&("win"===(p=p[0].substring(0,3).toLowerCase())&&(-1!=navigator.userAgent.indexOf("WOW64")||-1!=navigator.userAgent.indexOf("Win64")?r.architecture=64:r.architecture=32),"lin"===p&&(p="nxl"),r.platform=p),r=r;else{if(null!=app._root.process.native||"node"!==app._root.process.title)return app.error("app.utils.system","This system is not supported.");r={name:app._root.process.title.toString(),platform:app._root.process.platform.toString(),architecture:parseInt(app._root.process.arch.replace(/\D+/,"")),release:parseFloat(app._root.process.versions.node)}}return e&&"string"==typeof e&&e in r?r[e]:r},app.utils.addEvent=function(e,t,p){if("string"!=typeof e||!t||"function"!=typeof p)return app.error("app.utils.addEvent",[e,t,p]);t.addEventListener?t.addEventListener(e,p,!1):t.attachEvent&&t.attachEvent("on"+e,p)},app.utils.removeEvent=function(e,t,p){if(!e||!t||"function"!=typeof p)return app.error("app.utils.removeEvent",[e,t,p]);t.addEventListener?t.removeEventListener(e,p,!1):t.attachEvent&&t.detachEvent("on"+e,p)},app.utils.storage=function(e,t,p,o){if(void 0===e||void 0===t)return app.error("app.utils.storage",[e,t,p,o]);if(!app._runtime.storage)return app.stop("app.utils.storage","runtime");var r=app.utils.storage.prototype,a=app._runtime.storage.toString();return r._prefix="appe.",r._fn=e?a:"sessionStorage",r._persist=e,r._fn in app._root.window==!1?app.error("app.utils.storage",r._fn):r[t].apply(r,[p,o])},app.utils.storage.prototype.set=function(e,t){if(void 0===e||"string"!=typeof e||void 0===t)return app.error("app.utils.storage.prototype.set",[e,t]);var p=app.utils.base64("encode",this._prefix+e);if("object"==typeof t)try{t=JSON.stringify(t)}catch(e){return app.error("app.utils.storage.prototype.set",e)}t=t.toString(),app._root.window[this._fn].setItem(p,t)},app.utils.storage.prototype.get=function(e){if(void 0===e||"string"!=typeof e)return app.error("app.utils.storage.prototype.get",[e]);var t=app.utils.base64("encode",this._prefix+e),p=app._root.window[this._fn].getItem(t);try{var o=p;p=JSON.parse(o)}catch(e){p=o}return p},app.utils.storage.prototype.has=function(e,t){if(void 0===e||"string"!=typeof e)return app.error("app.utils.storage.prototype.has",[e,t]);if(null==t)return!!this.constructor.call(this,this._persist,"get",e);if("object"==typeof t)try{t=JSON.stringify(t)}catch(e){return app.error("app.utils.storage.prototype.has",e)}return t=t.toString(),this.constructor.call(this,this._persist,"get",e)===t},app.utils.storage.prototype.del=function(e){if(void 0===e||"string"!=typeof e)return app.error("app.utils.storage.prototype.del",[e]);var t=app.utils.base64("encode",this._prefix+e);app._root.window[this._fn].removeItem(t)},app.utils.storage.prototype.reset=function(){app._root.window[this._fn].clear()},app.utils.cookie=function(e,t,p,o){if(void 0===e)return app.error("app.utils.cookie",[e,t,p,o]);var r=app.utils.cookie.prototype;return r._prefix="appe.",r[e].apply(r,[t,p,o])},app.utils.cookie.prototype.set=function(e,t,p){if(void 0===e||"string"!=typeof e||void 0===t)return app.error("app.utils.cookie.prototype.set",[e,t,p]);var o="Fri, 31 Dec 9999 23:59:59 GMT";p&&p instanceof Date&&(o=p.toUTCString());var r=app.utils.base64("encode",this._prefix+e);if(r=encodeURIComponent(r),"object"==typeof t)try{t=JSON.stringify(t)}catch(e){return app.error("app.utils.cookie().set",e)}t=t.toString(),t=encodeURIComponent(t),app._root.document.cookie=r+"="+t+"; expires="+o},app.utils.cookie.prototype.get=function(e){if(void 0===e||"string"!=typeof e)return app.error("app.utils.cookie.prototype.get",[e]);var t=app.utils.base64("encode",this._prefix+e);t=encodeURIComponent(t);var p=null;if(-1!=app._root.document.cookie.indexOf(t)){var o=new RegExp(t+"=([^;]+)"),r=app._root.document.cookie.match(o);p=r.length?r[1]:null}if(!p)return null;try{var a=p;p=JSON.parse(a)}catch(e){p=a}return p=decodeURIComponent(p)},app.utils.cookie.prototype.has=function(e,t){if(void 0===e||"string"!=typeof e)return app.error("app.utils.cookie.prototype.has",[e,t]);if(null==t)return!!this.constructor.call(this,"get",e);if("object"==typeof t)try{t=JSON.stringify(t)}catch(e){return app.error("app.utils.cookie.prototype.has",e)}return t=t.toString(),t=encodeURIComponent(t),this.constructor.call(this,"get",e)===t},app.utils.cookie.prototype.del=function(e){if(void 0===e||"string"!=typeof e)return app.error("app.utils.cookie.prototype.del",[e]);var t=app.utils.base64("encode",this._prefix+e);t=encodeURIComponent(t),app._root.document.cookie=t+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT"},app.utils.cookie.prototype.reset=function(){app._root.document.cookie=""},app.utils.base64=function(e,t){var p=app.utils.base64.prototype;return"btoa"in app._root.window==0||"atob"in app._root.window==0?app.stop("app.utils.base64"):void 0!==e&&t?p[e](t):app.error("app.utils.base64",[e,t])},app.utils.base64.prototype.encode=function(e){var t=app._root.window.btoa;return"string"!=typeof e?app.error("app.utils.base64.prototype.encode",[e]):e=t(e=encodeURIComponent(e))},app.utils.base64.prototype.decode=function(e){var t=app._root.window.atob;return"string"!=typeof e?app.error("app.utils.base64.prototype.decode",[e]):(e=t(e),e=decodeURIComponent(e))},app.utils.transform=function(e,t){if(!e)return app.error("app.utils.transform",[e,t]);switch(e){case"lowercase":return t.toLowerCase();case"uppercase":return t.toUpperCase();case"numeric":return parseFloat(t);case"integer":return parseInt(t);case"json":try{return t=decodeURIComponent(t),JSON.parse(t)}catch(e){}}},app.utils.sanitize=function(e,t){if(!e)return app.error("app.utils.sanitize",[e,t]);switch(e){case"whitespace":return t.replace(/\\s/g,"");case"breakline":return t.replace(/\\r\\n/g,"");case"date":try{return new Date(t).toISOString().split("T")[0]}catch(e){}break;case"datetime":try{return new Date(t).toISOString()}catch(e){}break;case"datetime-local":try{return new Date(t).toISOString().split(".")[0]}catch(e){}break;case"array":if("object"==typeof t&&t instanceof Array){var p=[];return Array.prototype.forEach.call(t,function(e,t){null!==e&&(p[t]=e)}),p}}},app.utils.classify=function(e,t,p){if(!e||"object"!=typeof e||t&&"string"!=typeof t)return app.error("app.utils.classify",[e,t,p]);t=t||"";var o=e instanceof Array||!0,r="";for(var a in e)e[a]&&(r+=t+(o&&a+"-"||"")+e[a].toString().replace(/[^\d\D-_]/i,"-")+" ");return r=r.trim(),p&&(r=r.split(" ")),r},app.utils.numberFormat=function(e,t,p,o){if("number"!=typeof e)return app.error("app.utils.numberFormat",[e,t,p,o]);t=null!=t?parseInt(t):0,p=p?p.toString():".",o=o?o.toString():"";var r=parseFloat(e);return r=r.toFixed(t).replace(".",p).replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1"+o)},app.utils.dateFormat=function(e,t){var p=null;p=p instanceof Date==!0?e:!0===e?new Date:new Date(e);var o=function(e){switch(e){case"d":return app.utils.numberLendingZero(p.getDate());case"J":return p.getDate();case"w":return p.getDay();case"m":return app.utils.numberLendingZero(p.getMonth()+1);case"n":return p.getMonth()+1;case"N":return p.getMonth();case"Y":return p.getFullYear();case"y":return p.getFullYear().toString().slice(2);case"H":return app.utils.numberLendingZero(p.getHours());case"G":return p.getHours();case"M":return app.utils.numberLendingZero(p.getMinutes());case"I":return p.getMinutes();case"S":return app.utils.numberLendingZero(p.getSeconds());case"K":return p.getSeconds();case"v":return p.getMilliseconds();case"a":return p.toDateString().split(" ")[0];case"b":return p.toDateString().split(" ")[1];case"x":return p.toISOString().split("T")[0].replace(/-/g,"/");case"X":return p.toTimeString().split(" ")[0];case"s":return Math.round(p.getTime()/1e3);case"V":return p.getTime();case"O":return p.toTimeString().match(/([\+[\d]{4,})/)[0];case"z":return p.toTimeString().split("GMT")[1];case"C":return p.toUTCString();case"Q":return p.toISOString()}};t=(t=t||"Y-m-d H:M").match(/.{1}/g);for(var r="",a=0;a<t.length;a++)r+=/[\W_]/.test(t[a])?t[a]:o(t[a]);return r},app.utils.numberLendingZero=function(e){return e<10?"0"+e:e.toString()},app.utils.isPlainObject=function(e){var t,p,o={}.hasOwnProperty;return!(!e||"[object Object]"!==toString.call(e))&&(!(t=Object.getPrototypeOf(e))||"function"==typeof(p=o.call(t,"constructor")&&t.constructor)&&o.toString.call(p)===o.toString.call(Object))},app.utils.extendObject=function(){var e,t,p,o,r,a,n=arguments[0]||{},i=1,s=arguments.length,l=!1;for("boolean"==typeof n&&(l=n,n=arguments[i]||{},i++),"object"==typeof n||"function"==typeof n&&"number"!=typeof n.nodeType||(n={});i<s;i++)if(null!=(e=arguments[i]))for(t in e)p=n[t],n!==(o=e[t])&&(l&&o&&(app.utils.isPlainObject(o)||(r=Array.isArray(o)))?(a=r?(r=!1,p&&Array.isArray(p)?p:[]):p&&app.utils.isPlainObject(p)?p:{},n[t]=app.utils.extendObject(l,a,o)):void 0!==o&&(n[t]=o));return n},Object.freeze(app);