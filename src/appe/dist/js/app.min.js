/*!
 * {appe}
 *
 * @version 1.0.0~beta
 * @copyright Copyright (C) 2018-2019 Leonardo Laureti
 * @license MIT License
 *
 * contains:
 * - ($.jQuery.fn.isPlainObject) from jQuery JavaScript Library <https://jquery.com/>, Copyright JS Foundation and other contributors, MIT license <https://jquery.org/license>
 * - ($.jQuery.fn.extend) from jQuery JavaScript Library <https://jquery.com/>, Copyright JS Foundation and other contributors, MIT license <https://jquery.org/license>
 */
var app=window.app={};app._runtime={version:"1.0",release:"1.0 beta",system:null,exec:!0,title:"",name:"",storage:!1,compression:!1,encryption:!1,debug:!1,hangs:0},app.load=function(e){if("function"!=typeof e)return app.stop("app.load");var t=!1,r=function(){(t=!0)||e()};"complete"===document.readyState?r():document.addEventListener("DOMContentLoaded",r),t||app.utils.addEvent("load",window,e)},app.unload=function(e){if("function"!=typeof e)return app.stop("app.unload");app.utils.addEvent("beforeunload",window,e)},app.redirect=function(){var e=window.appe__config;if(!e)return app.stop("app.redirect");var t=e.basePath.toString(),r="index";-1!=window.location.href.indexOf(t+"/")&&(t="..",r=e.launcherName.toString()),window.location.href=t+"/"+r+".html"},app.position=function(){var e="undefined",t=app.controller.cursor();if(!t||"object"!=typeof t)return app.error("app.position","loc");try{e=JSON.stringify(t)}catch(e){return app.error("app.position",e)}return e},app.session=function(e,t){if(!e)return app.stop("app.session");if(window.appe__store={},app._runtime.name=e.app.toString(),app._runtime.debug=!!e.debug,app._runtime.encryption=!!e.encryption,app._runtime.compression=!!(e.compression||e.file&&e.file.binary)&&app._runtime.encryption,t&&setTimeout(function(){app.store.has("notify")&&app.store.del("notify"),this.clearTimeout()},0),!1!==t){if(app._runtime.compression&&!(pako&&pako.inflate&&pako.deflate))return app.error("app.session","pako");if(app._runtime.encryption&&!(CryptoJS&&CryptoJS.SHA512&&CryptoJS.AES))return app.error("app.session","CryptoJS");var r=null,a=e.openAttempts,p=function(e,t){var r=parseInt(a)||5,p=0,o=setInterval(function(){p++,(window[t]||r===p)&&(clearInterval(o),e())},1e3)},o=function(){if(!(pako&&pako.inflate&&pako.deflate))return app.error("app.session","pako")},n=function(){if(!(CryptoJS&&CryptoJS.SHA512&&CryptoJS.AES))return app.error("app.session","CryptoJS");var e=CryptoJS.SHA512(Math.random().toString(),{outputLength:384});app._runtime.secret=e.toString(CryptoJS.enc.Hex),document[app._runtime.secret]=r};(app._runtime.compression||app._runtime.encryption)&&(app._runtime.compression&&("pako"in window==0?(!1,p(o,"pako")):o()),app._runtime.encryption&&function(){if(!e.secret_passphrase||"string"!=typeof e.secret_passphrase)return app.error("app.session","config");r=e.secret_passphrase.toString(),delete e.secret_passphrase,"CryptoJS"in window==0?(!1,p(n,"CryptoJS")):n()}())}},app.resume=function(e,r){if(!e)return app.stop("app.resume");return app._runtime.system=app.utils.system(),"localStorage"in window==!1?app._runtime.storage="sessionStorage":"sessionStorage"in window==!1?app._runtime.storage="localStorage":"safari"===app._runtime.system.navigator?app._runtime.storage="sessionStorage":app._runtime.storage="localStorage",document.documentElement.setAttribute("lang",e.language.toString()),function(){var e="",t="";if(app.utils.cookie("has","last_opened_file")&&(e=app.utils.cookie("get","last_opened_file")),e||(e=app.memory.get("last_opened_file")),app.utils.cookie("has","last_session")&&(t=app.utils.cookie("get","last_session")),t||(t=app.memory.get("last_session")),void 0!==r||e&&!t){if(app._runtime.debug&&void 0!==r)return!t&&app.newSession();if(!t)return app.redirect()}return e&&(e=app.utils.base64("decode",e)+".js"),e}()},app.data=function(e){var t=window.appe__store;if(!t)return app.stop("app.data","store");var r=app._runtime.name.toString();return t[r]?e&&"string"==typeof e?e in t[r]?t[r][e]:app.error("app.data","key"):t[r]:app.stop("app.data","store")},app.checkConfig=function(t){if(!t||"object"!=typeof t)return app.stop("app.checkConfig");var r=!1;return Array.prototype.forEach.call(["app","launcherName","name","language","debug","schema","events","routes","defaultRoute","defaultEvent","verifyFileChecksum","basePath","savePath","openAttempts"],function(e){e in t==!1?r=!0:"schema"!=e&&"events"!=e&&"routes"!=e||"object"==typeof t[e]?"object"!=typeof t[e]&&"string"!=typeof t[e]&&"number"!=typeof t[e]&&"boolean"!=typeof t[e]&&(r=!0):r=!0}),(t.encryption&&(!t.secret_passphrase||"string"!=typeof t.secret_passphrase)||t.file&&"object"!=typeof t.file||t.csv&&"object"!=typeof t.csv)&&(r=!0),!!r&&app.stop("app.checkConfig")},app.checkFile=function(e){var t=window.appe__config;if(!t)return app.stop("app.checkFile");if(!e||"object"!=typeof e)return app.error("app.checkFile",arguments);var r=app._runtime.version.toString();if(r!==e.file.version)return app.error("app.checkFile","This file is incompatible with running version: "+r+".",e.file);if(t.verifyFileChecksum)try{e=JSON.stringify(e)}catch(e){return app.error("app.checkFile","source")}return!0},app.newSession=function(){var e=window.appe__config;if(!e)return app.stop("app.openSession");var t=!(void 0===window.appe__start),r=app._runtime.name.toString(),p=new Date;p=app.utils.dateFormat(p,"Q");var o=app.utils.base64("encode",p),a=e.schema;if("object"!=typeof a)return app.error("app.openSession","schema");var n=function(){t?app.start.redirect(!1):location.reload()};!function(){app.controller.clear(),app.utils.cookie("del","last_opened_file"),app.utils.cookie("del","last_session"),app.utils.cookie("set","last_session",o),app.memory.del("last_opened_file"),app.memory.del("file_saves"),app.memory.set("last_stored",p),app.memory.set("last_time",p),app.memory.set("last_session",o);for(var e=0;e<a.length;e++)app.store.set(r+"_"+a[e],{});n()}()},app.openSession=function(){var e=window.appe__config;if(!e)return app.stop("app.openSession");var r=!(void 0===window.appe__start);if("object"!=typeof e.schema)return app.error("app.openSession","schema");var p=new Date;p=app.utils.dateFormat(p,"Q");var o=app.utils.base64("encode",p),t=function(e){if(r&&app.start.progress(0),e){app.utils.cookie("del","last_opened_file"),app.utils.cookie("del","last_session");var t=e.replace(".js","");t=app.utils.base64("encode",t),app.utils.cookie("set","last_opened_file",t),app.utils.cookie("set","last_session",o),app.memory.set("last_opened_file",t),app.memory.set("last_stored",p),app.memory.set("last_time",p),app.memory.set("last_session",o),r?app.start.redirect(!0):location.reload()}},a=null;if(!this.getAttribute("data-open")){this.setAttribute("data-open","");var n=this.getAttribute("data-open-input");a=this.parentNode.querySelector(n);app.utils.addEvent("change",a,function(){app.os.fileOpen.call(this,t)})}a&&(r&&app.start.progress(2),a.click())},app.saveSession=function(){var e=window.appe__config;if(!e)return app.stop("app.saveSession");var t=window.appe__store;if(!t)return app.stop("app.saveSession","store");window.appe__start;var r=app._runtime.name.toString(),p=e.schema;if("object"!=typeof p)return app.error("app.saveSession","schema");var o={},a=new Date;Array.prototype.forEach.call(p,function(e){o[e]=t[r][e]}),o.file=app.os.generateFileHead(o,a),app.os.fileSave(function(e){app._runtime.debug&&console.info("save",e)},o,a)},app.debug=function(){return app.getInfo("config","debug")},app.stop=function(){if(console.log(arguments),!app._runtime.exec)return!1;app._runtime.exec=!1;var e=Object.values(arguments).slice(0);return 1==arguments.length&&e.push(null),app.error.apply(this,e),app.blind(),!1},app.error=function(){var e=null,t=null,r=null;if(console.log(arguments),3==arguments.length?(e=arguments[0],t=arguments[1],r=arguments[2]):2==arguments.length?(e=arguments[0],r=arguments[1]):1==arguments.length&&(t=arguments[0]),app._runtime.debug&&(app._runtime.exec?console.error("ERR",e,app.position(),t):console.warn("WARN",e,app.position(),t),r&&console.log(r)),t||(t="There is an error while executing.",app._runtime.exec||(t+="\n\nPlease reload the application.")),!app._runtime.hangs++)return app.store.has("notify","false")||(window.alert(t),app._runtime.exec||app.store.set("notify","false")),!1},app.blind=function(){if(!(void 0===window.appe__main)){var e=document.createElement("div");e.setAttribute("style","position: absolute; top: 0; right: 0; bottom: 0; left: 0; z-index: 9999; background: rgba(0,0,0,0.3);"),window.document.body.appendChild(e)}},app.getInfo=function(e,t){var r=window.appe__config;if(!r)return app.stop("app.getConfig");var p=null;switch(e){case"config":p={debug:!!r.debug,name:r.name.toString(),language:r.language.toString(),schema:"object"==typeof r.schema?r.schema:{},license:r.license&&("object"==typeof r.license?{text:r.license.text.toString(),file:r.license.file.toString()}:r.license.toString())||!1};break;case"runtime":p={version:app._runtime.version.toString(),release:app._runtime.release.toString()};break;default:return app.error("app.getInfo",arguments)}return t?t in p?p[t]:app.error("app.getInfo","info"):p},app.getName=function(){return app.getInfo("config","name")},app.getVersion=function(e){return"version"==e||"release"==e?app.getInfo("runtime",e):{version:app.getInfo("runtime","version"),release:app.getInfo("runtime","release")}},app.getLicense=function(){return app.getInfo("config","license")},app.os={},app.os.fileOpen=function(r){var e=window.appe__config;if(!e)return app.stop("app.os.fileOpen");if(e.file&&"object"!=typeof e.file)return app.error("app.os.fileOpen","config");if(app._runtime.compression&&!(pako&&pako.inflate&&pako.deflate))return app.error("app.os.fileOpen","pako");if(app._runtime.encryption&&!(CryptoJS&&CryptoJS.SHA512&&CryptoJS.AES))return app.error("app.os.fileSave","CryptoJS");if(!FileReader)return app.error("app.os.fileOpen","FileReader");if(!r||"function"!=typeof r)return app.error("app.os.fileOpen",arguments);if(this.files.length){var p=app._runtime.name.toString(),o=this.files[0];if(-1===o.type.indexOf("javascript"))return app.error("app.os.fileOpen","The file format is not correct.",arguments);var a=e.schema,n=e.file&&e.file.binary?!!e.file.binary:!!app._runtime.compression,i=e.file&&e.file.heads?e.file.heads.toString():p,s=e.file&&e.file.crypt?!!e.file.crypt:!!app._runtime.encryption,l=null;if(s){if(!(app._runtime.secret&&"string"==typeof app._runtime.secret&&app._runtime.secret in document))return app.error("app.os.fileOpen","runtime");l=document[app._runtime.secret]}var t=new FileReader;t.onload=function(){var e=this.result;try{if(e=e.replace(new RegExp(i+'=(?![^"]+)'),"").replace(/(^"|"$)/g,""),n&&(e=e.replace(/\"/g,'"'),!(e=pako.inflate(e,{level:9,to:"string"}))))throw"binary";if(s&&l&&!(e=(e=CryptoJS.AES.decrypt(e,l,{mode:CryptoJS.mode.CTR,padding:CryptoJS.pad.NoPadding})).toString(CryptoJS.enc.Utf8)))throw"crypt";e=JSON.parse(e)}catch(e){return app.error("app.os.fileOpen",e)}app.checkFile(e);for(var t=0;t<a.length;t++){if(a[t]in e==!1)return app.error("app.os.fileOpen","schema[i]");app.store.set(p+"_"+a[t],e[a[t]])}r(o.name)},t.onerror=function(e){app.error("app.os.fileOpen",e),r(!1)},t.readAsText(o)}},app.os.fileSave=function(t,e,r){var p=window.appe__config;if(!p)return app.stop("app.os.fileSave");if(p.file&&"object"!=typeof p.file)return app.error("app.os.fileSave","config");if(app._runtime.compression&&!(pako&&pako.inflate&&pako.deflate))return app.error("app.os.fileSave","pako");if(app._runtime.encryption&&!(CryptoJS&&CryptoJS.SHA512&&CryptoJS.AES))return app.error("app.os.fileSave","CryptoJS");if(!t||"function"!=typeof t||!(r&&r instanceof Date))return app.error("app.os.fileSave",arguments);if(!e||"object"!=typeof e)return t(!1);var o=app._runtime.name.toString(),a=p.file&&p.file.binary?!!p.file.binary:!!app._runtime.compression,n=p.file&&p.file.heads?p.file.heads.toString():o,i=p.file&&p.file.crypt?!!p.file.crypt:!!app._runtime.encryption,s=null;a&&(s=!0);var l=null;if(i){if(!(app._runtime.secret&&"string"==typeof app._runtime.secret&&app._runtime.secret in document))return app.error("app.session","runtime");l=document[app._runtime.secret]}var c=!!(i&&l||a&&s);try{if(e=(e=JSON.stringify(e)).replace(/\"/g,'"'),i&&l&&!(e=(e=CryptoJS.AES.encrypt(e,l,{mode:CryptoJS.mode.CTR,padding:CryptoJS.pad.NoPadding})).toString()))throw"crypt";if(a&&!(e=(e=pako.deflate(e,{level:9,to:"string"})).replace(/"/g,'"')))throw"binary";c&&(e='"'+e+'"'),e=n+"="+e}catch(e){return app.error("app.os.fileSave",e)}var u=app.memory.has("file_saves")?parseInt(app.memory.get("file_saves")):0;u++;var f=p.file&&p.file.filename_prefix?p.file.filename_prefix.toString():o+"_save",d=p.file&&p.file.filename_separator?p.file.filename_separator.toString():"_",m=p.file&&p.file.filename_date_format?p.file.filename_date_format.toString():"Y-m-d_H-M-S",y=f;y+=d+app.utils.dateFormat(r,m),y+=d+u;var v=new File([e],y+".js",{type:"application/x-javascript;charset=utf-8"});try{saveAs(v),app.memory.set("file_saves",u),t(y)}catch(e){t(!1)}},app.os.scriptOpen=function(e,t,r,p){if("function"!=typeof e||"string"!=typeof t||r&&"string"!=typeof r)return app.error("app.os.scriptOpen",arguments);r=r.toString();var o,a,n,i,s,l,c;o=t,(a=document.createElement("script")).src=o,a.async=!0,a.defer=!0,document.head.appendChild(a),r in window==!1?(n=e,i=r,s=parseInt(p)||5,l=0,c=setInterval(function(){l++,(window[i]||s===l)&&(clearInterval(c),n())},1e3)):e()},app.os.generateFileHead=function(e,t){if(!window.appe__config)return app.stop("app.os.generateFileHead");if(!(e&&"object"==typeof e||t&&t instanceof Date))return app.error("app.os.generateFileHead",arguments);return{checksum:"",date:t=app.utils.dateFormat(t,"Q"),version:app._runtime.version.toString(),release:app._runtime.release.toString()}},app.os.getLastFileName=function(){if(!window.appe__config)return app.stop("app.os.getLastFileName");var e="";return app.utils.cookie("has","last_opened_file")&&(e=app.utils.cookie("get","last_opened_file")),e||(e=app.memory.get("last_opened_file")),!!e&&(e=e?app.utils.base64("decode",e)+".js":null)},app.os.getLastFileVersion=function(){var e=window.appe__store;if(!e)return app.stop("app.os.getLastFileVersion","store");var t=e[app._runtime.name.toString()].file;if(!t)return app.error("app.os.getLastFileVersion","data_file");var r=null;return t.version&&(r=t.version),r},app.os.getLastFileChecksum=function(){var e=window.appe__store;if(!e)return app.stop("app.os.getLastFileChecksum","store");var t=e[app._runtime.name.toString()].file;if(!t)return app.error("app.os.getLastFileChecksum","data_file");var r=null;return t.checksum&&(r=t.checksum),r},app.os.getLastFileHead=function(){return{name:app.os.getLastFileName(),version:app.os.getLastFileVersion(),checksum:app.os.getLastFileChecksum()}},app.controller={},app.controller.cursor=function(e){return e?"object"!=typeof e?app.error("app.controller.cursor",arguments):(app.memory.set("cursor",e),e):e=app.memory.get("cursor")},app.controller.spoof=function(){var e={view:null,action:null,index:null};if(-1!=location.href.indexOf("?")){var t=location.href.split("?")[1];if(-1!=t.indexOf("&"))if(-1!=(t=t.split("&"))[1].indexOf("=")){var r=t[1].split("=");e={view:t[0],action:r[0],index:parseInt(r[1])}}else e={view:t[0],action:t[1]};else e.view=t}return e},app.controller.history=function(e,t){var r=app._runtime.title.toString();e?e+=" – "+r:e=r,"safari"!==app._runtime.system.navigator?(history.replaceState(null,e,t),app.controller.setTitle(e)):location.href=t},app.controller.setTitle=function(e){return app._runtime.title=e.toString(),document.title=app._runtime.title,app._runtime.title},app.controller.getTitle=function(){return app._runtime.title.toString()},app.controller.retrieve=function(e,t){var r=window.appe__config;if(!r)return app.stop("app.controller.retrieve");var a=window.appe__store;if(!a)return app.stop("app.controller.retrieve","store");if("function"!=typeof e||"object"!=typeof t)return app.stop("app.controller.retrieve",arguments);if("object"!=typeof r.schema)return app.error("app.controller.retrieve","schema");for(var p=function(e,t){if("string"!=typeof e||"object"!=typeof t)return app.stop("app.controller.retrieve() > _retrieve",arguments);if(a[e]&&"object"==typeof a[e])return a[e];a={};for(var r=0;r<t.length;r++){var p=t[r].toString(),o=app.store.get(e+"_"+p);if(!o)return app.stop("app.controller.retrieve() > _retrieve","obj");a[p]=o}return a},o=0;o<t.length;o++){var n=t[o].fn.toString();t[o].file&&(t[o].file="../"+t[o].file.toString()),a[n]=p(n,t[o].schema)}e()},app.controller.store=function(e,p,t,r){var o=window.appe__store;if(!o)return app.stop("app.controller.store","store");if("function"!=typeof e||"string"!=typeof p||"object"!=typeof t||"object"!=typeof r)return app.stop("app.controller.store",arguments);var a=o[p];if(!a)return app.stop("app.controller.store","source");var n=function(e,t){if("string"!=typeof e||"object"!=typeof t)return app.stop("app.controller.store() > _store",arguments);if(!a[e])return app.stop("app.controller.store() > _store","source[key]");var r=t;return app.store.set(p+"_"+e,r),r},i=new Date;i=app.utils.dateFormat(i,"Q");for(var s=Object.keys(r),l=0;l<s.length;l++){var c=s[l],u=r[c];if(-1===t.indexOf(c)||!Object.keys(u).length)return app.stop("app.controller.store","keys");o[p][c]=n(c,u)}app.memory.del("save_reminded"),app.memory.set("last_stored",i),e()},app.controller.clear=function(){var e=window.appe__config;if(!e)return app.stop("app.controller.clear");var t=window.appe__store;if(!t)return app.stop("app.controller.clear","store");var r=app._runtime.name.toString(),p=e.schema;if("object"!=typeof p)return app.error("app.controller.clear","schema");for(var o=0;o<p.length;o++){var a=p[o].toString();app.store.del(r+"_"+a),t[r]&&a in t[r]&&delete t[r][a]}return app.memory.del("last_stored"),!0},app.memory={},app.memory.set=function(e,t){return app.utils.storage(!0,"set",e,t)},app.memory.get=function(e){return app.utils.storage(!0,"get",e)},app.memory.has=function(e,t){return app.utils.storage(!0,"has",e,t)},app.memory.del=function(e){return app.utils.storage(!0,"del",e)},app.memory.reset=function(){return app.utils.storage(!0,"reset")},app.store={},app.store.set=function(e,t){return app.utils.storage(!1,"set",e,t)},app.store.get=function(e){return app.utils.storage(!1,"get",e)},app.store.has=function(e,t){return app.utils.storage(!1,"has",e,t)},app.store.del=function(e){return app.utils.storage(!1,"del",e)},app.store.reset=function(){return app.utils.storage(!1,"reset")},app.start={},app.start.progress=function(e){var t=document.getElementById("start-progress-wait"),r=document.getElementById("start-progress-open");switch(e){case 2:r.setAttribute("style","visibility: visible;"),t.setAttribute("style","visibility: visible;");break;case 1:r.setAttribute("style","visibility: visible;"),t.setAttribute("style","visibility: hidden;");break;default:t.setAttribute("style","visibility: visible;"),r.setAttribute("style","visibility: hidden;")}},app.start.loadAttempt=function(p,o,e,a,n){var t=window.appe__config;if(!t)return app.stop("app.start.loadAttempt");if(t.file&&"object"!=typeof t.file)return app.error("app.start.loadAttemp","config");if(app._runtime.compression&&!(pako&&pako.inflate&&pako.deflate))return app.error("app.start.loadAttemp","pako");if(app._runtime.encryption&&!(CryptoJS&&CryptoJS.SHA512&&CryptoJS.AES))return app.error("app.start.loadAttemp","CryptoJS");if(!(p&&o&&e&&a))return app.stop("app.start.loadAttemp",arguments);if("function"!=typeof p||"string"!=typeof o||"string"!=typeof e||"object"!=typeof a)return app.stop("app.start.loadAttemp",arguments);o=o.toString();var i=t.file&&t.file.binary?!!t.file.binary:!!app._runtime.compression,s=t.file&&t.file.crypt?!!t.file.crypt:!!app._runtime.encryption,l=null;if(s){if(!(app._runtime.secret&&"string"==typeof app._runtime.secret&&app._runtime.secret in document))return app.error("app.start.loadAttemp","runtime");l=document[app._runtime.secret]}var c=!1,r=parseInt(t.openAttempts);app.os.scriptOpen(function(){if(o in window==0)return app.error("app.start.loadAttemp","source");var e=window[o];if(!n)return p(!1);try{(i||s)&&(i&&(e=function(e){try{if(e=e.replace(/\"/g,'"'),!(e=pako.inflate(e,{level:9,to:"string"})))throw"binary";return e}catch(e){return app.error("app.start.loadAttempt() > _binary",e)}}(e)),s&&l&&(e=function(e){try{if(!(e=(e=CryptoJS.AES.decrypt(e,l,{mode:CryptoJS.mode.CTR,padding:CryptoJS.pad.NoPadding})).toString(CryptoJS.enc.Utf8)))throw"crypt";return e}catch(e){return app.error("app.start.loadAttempt() > _crypto",e)}}(e)),e=JSON.parse(e))}catch(e){return app.error("app.start.loadAttemp",e)}if(!e)return p(!1);for(var t=0;t<a.length;t++){var r=a[t].toString();if(r in e==0)return app.error("app.start.loadAttemp","schema");c=app.store.set(o+"_"+r,e[r])}p(c)},e,o,r)},app.start.loadComplete=function(e){var t=window.appe__config;if(!t)return app.stop("app.start.loadComplete");if(t.file&&"object"!=typeof t.file)return app.error("app.start.loadComplete","config");if(app._runtime.compression&&!(pako&&pako.inflate&&pako.deflate))return app.error("app.start.loadComplete","pako");if(app._runtime.encryption&&!(CryptoJS&&CryptoJS.SHA512&&CryptoJS.AES))return app.error("app.start.loadComplete","CryptoJS");if(!e)return app.start.progress(1);var r=app._runtime.name.toString(),p=t.schema;if("object"!=typeof p)return app.error("app.start.loadComplete","schema");e=t.savePath.toString()+"/"+e;var o=t.file&&t.file.heads?t.file.heads.toString():r;app.start.loadAttempt(function(e){e?app.start.redirect(!0):app.start.progress(1)},o,e,p,!0),app.start.progress(1)},app.start.redirect=function(e){setTimeout(function(){app.start.progress(!1),app.redirect(),this.clearTimeout()},1e3)},app.start.alternative=function(){var e=window.appe__config;if(!e)return app.stop("app.start.alternative");var t=["Purtroppo non è possibile eseguire l'applicazione per via di restrizioni nel programma {browser}.",'VAI NELLA CARTELLA "{alt_exec_folder}" E APRI "{alt_exec_platform}".'],r=app.utils.system(),p={chrome:"Chrome",safari:"Safari",firefox:"Firefox",edge:"Edge",ie:"Explorer",iemobile:"Explorer"}[r.navigator],o=r.platform in e.altExecPlatform?r.platform:null;if(o&&e.altExecFolder&&e.altExecFolder){var a=e.altExecFolder,n=e.altExecPlatform[o];t=(t=t[0]+"\n\n"+t[1]).replace("{alt_exec_folder}",a).replace("{alt_exec_platform}",n)}else t=t[0];return alt_electron=t.replace("{browser}",p),app.start.progress(1),app.error(alt_electron)},app.start.load=function(){var e=window.appe__config;if(!e)return app.stop("app.start.load");app.checkConfig(e);var t=!0;if(("sessionStorage"in window==!1&&"localStorage"in window==!1||"history"in window==!1||"atob"in window==!1||"btoa"in window==!1)&&(t=!1),void 0!==window.sessionStorage&&"replaceState"in window.history!=!1&&"checkValidity"in document.createElement("form")!=!1||(t=!1),app.session(e),!t)return app.start.alternative(),void setTimeout(function(){app.stop("app.start.load"),this.clearTimeout()},0);var r=app.resume(e);app.controller.setTitle(e.name);var p=document.getElementById("start-action-open");app.utils.addEvent("click",p,app.openSession);var o=document.getElementById("start-action-new");app.utils.addEvent("click",o,app.newSession);var a=!0,n=e.auxs&&"object"==typeof e.auxs?e.auxs:{};if(n.length)for(var i=0;i<n.length;i++)app.start.loadAttempt(function(e){e||(a=!1)},n[i].fn,n[i].file,n[i].schema,n[i].memoize);if(!a)return app.error("app.start.alternative","aux_loaded");app.start.loadComplete(r)},app.main={},app.main.control=function(e){var t=window.appe__config;if(!t)return app.stop("app.main.control");if(!t.routes||"object"!=typeof t.routes||!t.events||"object"!=typeof t.events)return app.error("app.main.control","config");var r=document.getElementById("view"),p=t.routes,o=t.events,a={};Array.prototype.forEach.call(Object.keys(o),function(e){a[o[e]]=e}),e||(e=app.controller.spoof());var n=t.defaultRoute.toString(),i=n+".html",s=!0;if(e&&"object"==typeof e?e.view?(p[e.view]?i=encodeURIComponent(e.view)+".html":s=!1,e.action&&(p[e.view][e.action]?(i=p[e.view][e.action].toString()+".html",i+="?"+encodeURIComponent(e.action)):s=!1,e.index&&(i+="&id="+encodeURIComponent(e.index)))):e={view:n}:s=!1,!s||"string"!=typeof i)return app.stop("app.main.control",arguments);app.controller.cursor(e);var l="views/"+i;r.removeAttribute("height"),r.setAttribute("src",l),"list"===a[e.action]?document.body.classList.add("full-width"):document.body.classList.remove("full-width");var c=document.getElementById("master-navigation"),u=c.querySelector("li.active"),f=c.querySelector('a[data-view="'+e.view+'"]');u&&u.classList.remove("active"),f&&f.parentNode.classList.add("active")},app.main.handle=function(e){var t=window.appe__config;if(!t)return app.stop("app.main.handle");if(!t.events||"object"!=typeof t.events)return app.error("app.main.handle","config");var r=window.appe__main,p=app.main.handle.prototype;if(!e.data)return app.error("app.main.handle",arguments);try{p.ctl=JSON.parse(e.data)}catch(e){return app.error("app.main.handle",e)}var o=t.events;return p.events=app.utils.extendObject(o,{resize:"resize",refresh:"refresh",export:"export"}),p.event=null,p.ctl.action&&p.ctl.action in p.events?(p.event=p.ctl.action,p.loc=app.utils.extendObject({},p.ctl),p._href="",p._title="",p._msg="",r&&"handle"in r&&"function"==typeof r.handle?r.handle(p,p.event,p.ctl):p[p.event].apply(p)):app.error("app.main.handle",p.ctl)},app.main.handle.prototype.getID=function(){return parseInt(this.ctl.index)||0},app.main.handle.prototype.setAction=function(){return this.ctl.action in this.events==!1?app.error("app.main.prototype.setAction","ctl"):(this.loc.action=this.events[this.loc.action].toString(),this.loc.action)},app.main.handle.prototype.getAction=function(){return this.loc.action?this.loc.action:app.error("app.main.prototype.setAction","loc")},app.main.handle.prototype.setTitle=function(e){return e&&"string"==typeof e?(this._title=e,this._title):app.error("app.main.handle.prototype.setTitle","title")},app.main.handle.prototype.getTitle=function(){return this._title?this._title:this.ctl.title&&"string"==typeof this.ctl.title&&this.ctl.title},app.main.handle.prototype.setMsg=function(e){return e&&"string"==typeof e?(this._msg=e,this._msg):app.error("app.main.handle.prototype.setTitle","title")},app.main.handle.prototype.getMsg=function(){return this._msg?this._msg:this.ctl.msg&&"string"==typeof this.ctl.msg&&this.ctl.msg},app.main.handle.prototype.setURL=function(e,t){var r="index.html";return r+=(e||this.ctl.view)&&"?"+(e&&"string"==typeof e?e:this.ctl.view),r+=t&&"&"+(t&&"string"==typeof t&&t),this._href=r,this._href},app.main.handle.prototype.getURL=function(){return this._href},app.main.handle.prototype.redirect=function(){var e=this.getURL();location.href=e},app.main.handle.prototype.refresh=function(){location.reload()},app.main.handle.prototype.resize=function(){if(this.ctl.height){var e=parseInt(this.ctl.height),t=document.getElementById("view");t.height=e,t.scrolling="no"}},app.main.handle.prototype.selection=function(){this.refresh()},app.main.handle.prototype.export=function(){if(!this.ctl.data||!this.ctl.file||"object"!=typeof this.ctl.file)return app.error("app.main.handle.prototype.export","ctl");if(!this.ctl.file.name||"string"!=typeof this.ctl.file.name||!this.ctl.file.options||"object"!=typeof this.ctl.file.options)return app.error("app.main.handle.prototype.export","file");var e=new File([this.ctl.data],this.ctl.file.name,this.ctl.file.options||{});saveAs(e)},app.main.handle.prototype.prepare=function(){var e=this.setAction(),t=this.getID();this.setURL(null,e+(t&&"="+t)),this.ctl.history&&this.history(),this.receive()},app.main.handle.prototype.prevent=function(){var e=this.setAction(),t=this.getMsg();if(!t)return app.error("app.main.handle.prototype."+this.event,"msg");this.setURL(null,e),window.confirm(t)&&this.receive()},app.main.handle.prototype.open=app.main.handle.prototype.prepare,app.main.handle.prototype.add=app.main.handle.prototype.prepare,app.main.handle.prototype.edit=app.main.handle.prototype.prepare,app.main.handle.prototype.update=app.main.handle.prototype.prepare,app.main.handle.prototype.delete=app.main.handle.prototype.prevent,app.main.handle.prototype.close=app.main.handle.prototype.prevent,app.main.handle.prototype.history=function(){var e=this.getTitle(),t=this.getURL();app.controller.history(e,t)},app.main.handle.prototype.receive=function(){var e=window.appe__config;if(!e)return app.stop("app.main.handle.prototype.receive");var t=e.schema;if("object"!=typeof t)return app.error("app.main.handle.prototype.receive","schema");var r=app._runtime.name.toString();if(this.ctl.submit&&this.ctl.data){var p=this.getAction();try{var o=this,a=JSON.parse(this.ctl.data);app.controller.store(function(){var e=app.controller.spoof();e.action=null,e.index=null,"update"===p?o.refresh():app.main.control(e)},r,t,a)}catch(e){return app.error("app.main.handle.prototype.receive",e)}}else app.main.control(this.loc)},app.main.action=function(e,t,r){if(!window.appe__config)return app.stop("app.main.action");window.appe__main;var p=app.main.action.prototype;return e&&e instanceof Array==!1||!t||!r?app.error("app.main.action",arguments):(this._initialized=!1,p)},app.main.action.prototype.isInitialized=function(e){if(!this._initialized)return app.error("app.main.action.prototype.isInitialized",e)},app.main.action.prototype.begin=function(){this._initialized=!0},app.main.action.prototype.end=function(){this.isInitialized("end"),this._initialized=!1},app.main.action.prototype.menu=function(e){if(this.isInitialized("menu"),!("jQuery"in window&&"collapse"in jQuery.fn)){if(!e)return app.error("app.main.action.prototype.menu",arguments);var t=document.querySelector(e.getAttribute("data-target"));e.getAttribute("data-is-visible")||(e.setAttribute("data-is-visible",!0),e.setAttribute("aria-expanded",!1),t.setAttribute("aria-expanded",!1)),app.layout.collapse("toggle",e,t)(),app.utils.addEvent("click",document.body,app.layout.collapse("close",e,t))}},app.main.setup=function(){var e=window.appe__main;e&&"setup"in e&&"function"==typeof e.setup&&e.setup(app.data()),app.main.control()},app.main.load=function(){var e=window.appe__config;if(!e)return app.stop("app.main.load");app.checkConfig(e),app.session(e,!0),app.resume(e,!0);var t=e.auxs&&"object"==typeof e.auxs?e.auxs:{};t.push({file:"",fn:e.app,schema:e.schema}),app.controller.retrieve(app.main.setup,t),app.controller.setTitle(e.name);document.getElementById("brand");brand.innerHTML=app.controller.getTitle();var r=document.querySelectorAll(".main-action-open");r.length&&Array.prototype.forEach.call(r,function(e){app.utils.addEvent("click",e,app.openSession)});var p=document.querySelectorAll(".main-action-new");p.length&&Array.prototype.forEach.call(p,function(e){app.utils.addEvent("click",e,app.newSession)});var o=document.querySelectorAll(".main-action-save");o.length&&Array.prototype.forEach.call(o,function(e){app.utils.addEvent("click",e,app.saveSession)}),app.utils.addEvent("message",window,app.main.handle)},app.main.unload=function(){if(!app.memory.has("save_reminded")&&app.memory.get("last_time")!==app.memory.get("last_stored"))return app.memory.set("save_reminded",!0),!0},app.view={},app.view.spoof=function(){var e={action:null,index:null};if(-1!=location.href.indexOf("?")){var t=location.href.split("?")[1];if(-1!=t.indexOf("&"))if(-1!=(t=t.split("&"))[1].indexOf("=")){var r=t[1].split("=");e={action:t[0],index:parseInt(r[1])}}else e={action:t[1]}}return e},app.view.control=function(e,t,r){if(!window.appe__config)return app.stop("app.view.control");if(!window.appe__control)return app.error("app.view.control","control");var p=app.view.control.prototype;return e&&e instanceof Array==!1||t&&"object"!=typeof t?app.error("app.view.control",arguments):(p._initialized=!1,p.events=e||null,p.data=t||{},p.form=r||null,p.ctl={},p)},app.view.control.prototype.isInitialized=function(e){if(!this._initialized)return app.error("app.view.control.prototype.isInitialized",e)},app.view.control.prototype.begin=function(){var e=window.appe__config;if(!e)return app.stop("app.view.control.prototype.begin");if(!e.routes||"object"!=typeof e.routes||!e.events||"object"!=typeof e.events)return app.error("app.view.control.prototype.begin","config");var t=app.controller.cursor(),r=null,p=null,o=0;t&&"view"in t&&(r=t.view);var a=e.routes,n=e.events,i={};Array.prototype.forEach.call(Object.keys(n),function(e){i[n[e]]=e});var s=app.view.spoof(),l=e.defaultEvent.toString(),c=!0;return s&&"object"==typeof s?s.action?(a[r][s.action]?p=i[s.action]:c=!1,s.index&&(o=s.index)):p=l:c=!1,this.events&&-1===this.events.indexOf(p)||!c?app.error("app.view.control.prototype.begin","event"):(control.temp={},this._initialized=!0,p&&"add"===(p=this.setEvent(p))&&(o=this.getLastID()),o=this.setID(o))},app.view.control.prototype.end=function(){if(this.isInitialized("end"),app.view.resize(!0),this.form){control.temp.form=!0,control.temp.form_submit=!1,control.temp.form_elements=this.form.elements,control.temp.form_changes=null;try{var e=app.view.getFormData(this.form.elements);control.temp.form_changes=e&&JSON.stringify(e)}catch(e){return app.error("app.view.control.prototype.end",e)}}_initialized=!1},app.view.control.prototype.setID=function(e){return this.isInitialized("setID"),control.temp.id=parseInt(e),control.temp.id},app.view.control.prototype.getID=function(){return this.isInitialized("getID"),control.temp.id?control.temp.id:parseInt(control.temp.id)},app.view.control.prototype.getLastID=function(){this.isInitialized("getLastID");var e=Object.keys(this.data).pop();return e?parseInt(e)+1:1},app.view.control.prototype.setEvent=function(e){return this.isInitialized("setEvent"),this.events&&-1===this.events.indexOf(e)?app.error("app.view.control.prototype.setEvent",arguments):(control.temp.event=e,control.temp.event)},app.view.control.prototype.getEvent=function(){return this.isInitialized("getEvent"),control.temp.event},app.view.control.prototype.setTitle=function(e,t,r){this.isInitialized("setTitle");var p=this.getEvent(),o=document.getElementById("view-title"),a=document.getElementById("section-title");r=parseInt(r)||app.view.control.prototype.getID(),"edit"===p&&(e+=" # "+r),null!=t&&(o.innerHTML=t),null!=e&&(a.innerHTML=e)},app.view.control.prototype.setActionHandler=function(e,t){this.isInitialized("setActionHandler");var r=this.getEvent();t=parseInt(t)||this.getID();var p=document.getElementById("submit"),o=document.getElementById("index");if(!o)return app.error("app.view.control.prototype.setActionHandler",null,"action_index");if(o.setAttribute("value",t),p){var a=p.getAttribute("onclick");a=a.replace("{action_event}",r),p.setAttribute("onclick",a)}e&&"string"==typeof e&&(p.innerHTML=e)},app.view.control.prototype.denySubmit=function(){this.isInitialized("denySubmit");var e=document.getElementById("submit");e&&(e.removeAttribute("onclick"),e.setAttribute("disabled","")),this.form&&this.form.setAttribute("action","")},app.view.control.prototype.fillTable=function(e,t,r){if(this.isInitialized("fillTable"),!e)return app.error("app.view.control.prototype.fillTable",arguments);var p=t;t&&"object"==typeof t||(p=this.data),r=r&&r instanceof Array?r:Object.keys(p);var o=Object.values(arguments).slice(3),a=e.querySelector("tbody"),n=a.querySelector("tr.tpl").cloneNode(!0);n.classList.remove("tpl");var i="";return"renderRow"in control&&"function"==typeof control.renderRow&&(Array.prototype.forEach.call(r,function(e){var t=control.renderRow(n,e,p[e],o);i+=t.outerHTML}),a.innerHTML=i),{rows:i,tpl:n,data:p,args:o}},app.view.control.prototype.fillForm=function(e,t){if(this.isInitialized("fillForm"),!this.form)return app.error("app.view.control.prototype.fillForm",arguments);var r=t;t&&"object"==typeof t||(r=this.data);var p=Object.values(arguments).slice(2);return"fillForm"in control&&"function"==typeof control.fillForm&&control.fillForm(r,p),{data:r,args:p}},app.view.control.prototype.fillSelection=function(e,t){if(this.isInitialized("fillSelection"),!e||"object"!=typeof e)return app.error("app.view.control.prototype.fillSelection",arguments);var r=document.getElementById("selection");(t=t||null)?(r.innerHTML=app.layout.renderSelectOptions(r,e,t),r.value=t):r.parentNode.classList.add("hidden")},app.view.control.prototype.fillCTA=function(e){this.isInitialized("fillCTA"),e=parseInt(e)||null;var t=document.getElementById("section-actions-top"),r=document.getElementById("section-actions-bottom");t&&(e?t.innerHTML=t.innerHTML.replace(/\{id\}/g,e):Array.prototype.forEach.call(t.querySelectorAll(".action"),function(e){e.remove()})),r&&(e?r.innerHTML=r.innerHTML.replace(/\{id\}/g,e):Array.prototype.forEach.call(r.querySelectorAll(".action"),function(e){e.remove()}))},app.view.action=function(e,t,r,p){if(!window.appe__config)return app.stop("app.view.action");if(!window.appe__control)return app.error("app.view.action","control");var o=app.view.action.prototype;return e&&e instanceof Array==!1||!t||!r?app.error("app.view.action",arguments):(o._initialized=!1,o.events=e,o.event=t.toString(),o.element=r,o.form=p||null,o.ctl={},o)},app.view.action.prototype.isInitialized=function(e){if(!this._initialized)return app.error("app.view.action.prototype.isInitialized",e)},app.view.action.prototype.begin=function(){if(this.events&&-1===this.events.indexOf(this.event))return app.error("app.view.action.prototype.begin","event");this._initialized=!0},app.view.action.prototype.end=function(){this.isInitialized("end"),this._initialized=!1},app.view.action.prototype.getID=function(){this.isInitialized("getID");var e=0;try{e=this.element.parentNode.parentNode.getAttribute("data-index")}catch(e){}return!e&&control.temp.id&&(e=control.temp.id),parseInt(e)},app.view.action.prototype.validateForm=function(){if(this.isInitialized("validateForm"),!this.form)return app.error("app.view.action.prototype.validateForm","form");var e=document.getElementById("real-submit");return e?!this.form.checkValidity()&&(Array.prototype.forEach.call(this.form.elements,function(e){var t=null;-1!=e.parentNode.className.indexOf("form-group")?t=e.parentNode:-1!=e.parentNode.parentNode.className.indexOf("form-group")&&(t=e.parentNode.parentNode),t&&t.classList&&(t.querySelector(":invalid")?(t.classList.remove("has-success"),t.classList.add("has-error")):(t.classList.remove("has-error"),t.classList.add("has-success")))}),e.click(),!0):app.error("app.view.action.prototype.validateForm","action_submit")},app.view.action.prototype.prepare=function(e,t){if(this.isInitialized(this.event),e&&"object"!=typeof e)return app.error("app.view.action.prototype."+this.event,arguments);var r=this.getID();try{if(this.ctl.action=this.event,r&&(this.ctl.index=parseInt(r),"update"!=this.event&&(this.ctl.history=!0)),!0===t&&(this.ctl.submit=!0,this.ctl.data=JSON.stringify(e),control.temp.form)){control.temp.form_submit=!0;var p=app.view.getFormData(this.form.elements);control.temp.form_changes=p&&JSON.stringify(p)}return this.ctl}catch(e){return app.error("app.view.action.prototype."+this.event,e)}},app.view.action.prototype.prevent=function(e,t,r,p){var o=window.appe__config;if(!o)return app.stop("app.view.action.prototype.prevent");if(this.isInitialized(this.event),!o.events||"object"!=typeof o.events)return app.error("app.view.control.prototype.begin","config");var a=o.events;if(e&&"object"!=typeof e)return app.error("app.view.action.prototype."+this.event,arguments);if("string"!=typeof r)return app.error("app.view.action.prototype."+this.event,arguments);var n=a?a[this.event].toString():this.event;return!r||"number"!=typeof p&&"string"!=typeof p?this.ctl.msg=r:(this.ctl.msg="Are you sure to "+n+" "+r+" ",this.ctl.msg+="number"==typeof p?"#"+p:'"'+p+'"',this.ctl.msg+=" ?"),this.prepare(e,t)},app.view.action.prototype.open=app.view.action.prototype.prepare,app.view.action.prototype.add=app.view.action.prototype.prepare,app.view.action.prototype.edit=app.view.action.prototype.prepare,app.view.action.prototype.update=app.view.action.prototype.prepare,app.view.action.prototype.delete=app.view.action.prototype.prevent,app.view.action.prototype.close=app.view.action.prototype.prevent,app.view.action.prototype.selection=function(){this.isInitialized("selection");var e=this.element.value.toString();if(!e)return app.error("app.view.action().selection","selected");var t={id:e};return this.prepare(t,!0)},app.view.action.prototype.print=function(){this.isInitialized("print"),window.print()},app.view.sub=function(e,t,r){if(!window.appe__config)return app.stop("app.view.sub");var p=app.view.sub.prototype;return e&&t?p[e](t,r):app.error("app.view.sub",arguments)},app.view.sub.prototype.csv=function(e,t){var r=window.appe__config;if(!r)return app.stop("app.view.sub.prototype.csv");if(!e||!t)return app.error("app.view.sub.prototype.csv",arguments);var p="",o=app.view.convertTableCSV(t);Array.prototype.forEach.call(o,function(e){p+=e.join(";")+"\r\n"});var a="csv_export",n="_",i="Y-m-d_H-M-S";r.csv&&"object"==typeof r.csv&&(a=r.csv.filename_prefix.toString(),n=r.csv.filename_separator.toString(),i=r.csv.filename_date_format.toString());var s=a,l={action:"export",file:{name:(s+=n+app.utils.dateFormat(!0,i))+".csv",options:{type:"text/csv;charset=utf-8"}},data:p};return app.view.send(l)},app.view.sub.prototype.clipboard=function(e,t){if(!e||!t)return app.error("app.view.sub.prototype.clipboard",arguments);var r="",p=app.view.convertTableCSV(t);Array.prototype.forEach.call(p,function(e){r+=e.join("\t")+"\r\n"}),app.view.copyToClipboard(r);var o=e.parentNode.parentNode.parentNode.querySelector(".dropdown-toggle");o.classList.add("btn-gray-lighter"),setTimeout(function(){o.classList.remove("btn-gray-lighter"),this.clearTimeout()},1e3)},app.view.sub.prototype.toggler=function(e){if(!("jQuery"in window&&"dropdown"in jQuery.fn)){if(!e)return app.error("app.view.sub.prototype.clipboard",arguments);var t=e.parentNode.parentNode.parentNode;app.layout.dropdown("toggle",e,t)(),app.utils.addEvent("click",document.body,app.layout.dropdown("close",e,t))}},app.view.handle=function(){if(!window.appe__config)return app.stop("app.view.handle");var e=window.appe__control;if(!e)return app.error("app.view.handle","control");"handle"in e&&"function"==typeof e.handle&&e.handle(app.data()),app.utils.addEvent("resize",window,app.view.resize),app.utils.addEvent("orientationchange",window,app.view.resize)},app.view.resize=function(e){var t=window.appe__control;if(t&&t.temp){if(e){if((new Date).getTime()-t.temp.last_resize<1e3)return;t.temp.last_resize=(new Date).getTime()}var r={action:"resize",height:document.documentElement.scrollHeight};return app.view.send(r)}},app.view.send=function(e){if(!window.appe__config)return app.stop("app.view.action");if(!window.appe__control)return app.error("app.view.action","control");if(e){if("object"!=typeof e)return app.error("app.view.send",arguments);if("view"in e==!1){var t=app.controller.cursor();t&&"view"in t&&(e.view=t.view)}if("action"in e!=!1)try{app._runtime.debug&&console.info("app.view.send",e),e=JSON.stringify(e),window.parent.postMessage(e,"*")}catch(e){return app.error("app.view.send",e)}}},app.view.getFormData=function(e){if(!e||!e.length)return app.error("app.view.getFormData",arguments);for(var t={},r=0;r<e.length;r++)if("FIELDSET"!=e[r].nodeName){var p=e[r].name,o=e[r].value.trim(),a=e[r].getAttribute("data-transform")||!1,n=e[r].getAttribute("data-sanitize")||!1;if(e[r].type&&(e[r].type,"checkbox"!==e[r].type&&"radio"!==e[r].type||(o=!!e[r].checked)),a&&(o=app.utils.transform(a,o)),n&&(o=app.utils.sanitize(n,o)),void 0===o&&(o=null),p){p=p.match(/([\w]+)/g,"$1");var i={};Array.prototype.reduce.call(p,function(e,t,r){return e[t]=r!=p.length-1&&{}||o},i),app.utils.extendObject(!0,t,i)}}return t},app.view.convertTableCSV=function(e){if(!e)return app.error("app.view.convertTableCSV",arguments);var t=e.querySelectorAll("thead tr:not(.hidden-csv) th"),r=e.querySelectorAll("tbody tr:not(.hidden-csv)"),p=[[]];Array.prototype.forEach.call(t,function(e){e.classList.contains("hidden-print")||p[0].push(e.textContent)});var o=0;return Array.prototype.forEach.call(r,function(e){if(!e.classList.contains("tpl")){var t=e.querySelectorAll("td");p[++o]=[],Array.prototype.forEach.call(t,function(e){if(!e.classList.contains("hidden-print")){var t=e.querySelector(".form-control");t?p[o].push(t.value):p[o].push(e.textContent)}})}}),p},app.view.copyToClipboard=function(e){if(!e)return app.error("app.view.copyToClipboard",arguments);var t=document.createElement("TEXTAREA");t.style="position: absolute; top: 0; right: 0; width: 0; height: 0; z-index: -1; overflow: hidden;",t.value=e,document.body.appendChild(t),t.focus(),t.select(),document.execCommand("copy"),document.body.removeChild(t)},app.view.load=function(){var e=window.appe__config;if(!e)return app.stop("app.view.load");app.session(e,!1),app.resume(e,!1);var t=e.auxs||{};t.push({fn:e.app,schema:e.schema}),app.controller.retrieve(app.view.handle,t)},app.view.unload=function(){var e=window.appe__control;if(!e)return app.error("app.view.unload","control");if(e.temp.form&&!e.temp.form_submit){try{var t=app.view.getFormData(e.temp.form_elements);t=t&&JSON.stringify(t)}catch(e){return app.error("app.view.unload",e)}if(e.temp.form_changes!==t)return!0}},app.layout={},app.layout.renderElement=function(e,t,r){if("string"!=typeof e||t&&"string"!=typeof t||r&&"object"!=typeof r)return app.error("app.layout.renderElement",arguments);var p=e.toLowerCase(),o="<"+p;if(r)for(var a=Object.keys(r),n=a.length,i=0;i<n;i++)null!==r[a[i]]&&(n!=i&&(o+=" "),o+=r[a[i]]?a[i]+'="'+r[a[i]].toString()+'"':a[i]);return o+=t?">"+t+"</"+p+">":">"},app.layout.renderSelect=function(e,t,r,p){if(!e||"object"!=typeof t)return app.error("app.layout.renderSelectOptions",arguments);var o=app.utils.extendObject({id:e},p),a="";return t&&(a=app.layout.renderSelectOptions(e,t,r)),app.layout.renderElement("select",a,o)},app.layout.renderSelectOption=function(e,t,r){return e&&t?app.layout.renderElement("option",t,{value:e,selected:r?"":null}):app.error("app.layout.renderSelectOption",arguments)},app.layout.renderSelectOptionGroup=function(e,t){return e&&t?app.layout.renderElement("optgroup",t,{label:e}):app.error("app.layout.renderSelectOptionGroup",arguments)},app.layout.renderSelectOptions=function(e,t,o){if(!e||"object"!=typeof t)return app.error("app.layout.renderSelectOptions",arguments);var a="";return Array.prototype.forEach.call(t,function(e){var t=Object.keys(e)[0],r=e[t];if(r instanceof Array){var p="";Array.prototype.forEach.call(r,function(e){if("object"==typeof e)var t=e[r=Object.keys(e)[0]];else var r=t=e;p+=app.layout.renderSelectOption(r,t,o)}),a+=app.layout.renderSelectOptionGroup(t,p)}else a+=app.layout.renderSelectOption(t,r,o)}),a},app.layout.draggable=function(t,r,p){if(!t||!r)return app.error("app.view.draggable",arguments);var o=app.layout.draggable.prototype;r._draggable||(r._draggable={current:null,prev_index:null,next_index:null});return function(e){return o[t].apply(this,[r,e,p])}},app.layout.draggable.prototype.start=function(e,t){app._runtime.debug&&console.info("app.layout.draggable.prototype.start",t,e._draggable),e._draggable.current=this,e._draggable.next_index=this.getAttribute("data-index"),t.dataTransfer.effectAllowed="move",t.dataTransfer.setData("text/html",this.innerHTML),this.classList.add("move")},app.layout.draggable.prototype.over=function(e,t){return app._runtime.debug&&console.info("app.layout.draggable.prototype.over",t,e._draggable),t.preventDefault&&t.preventDefault(),!(t.dataTransfer.dropEffect="move")},app.layout.draggable.prototype.enter=function(e,t){app._runtime.debug&&console.info("app.layout.draggable.prototype.enter",t,e._draggable),this.classList.add("over")},app.layout.draggable.prototype.leave=function(e,t){app._runtime.debug&&console.info("app.layout.draggable.prototype.leave",t,e._draggable),this.classList.remove("over")},app.layout.draggable.prototype.end=function(e,t,r){app._runtime.debug&&console.info("app.layout.draggable.prototype.end",t,e._draggable);var p=e.querySelector("tbody").querySelectorAll("tr.draggable"),o=[];Array.prototype.forEach.call(p,function(e){o.push(e.getAttribute("data-index")),e.classList.remove("move"),e.classList.remove("over")});try{o=JSON.stringify(o),o=encodeURIComponent(o),r&&r.setAttribute("value",o)}catch(e){return app.error("app.view.draggable.end",e)}},app.layout.draggable.prototype.drop=function(e,t){return app._runtime.debug&&console.info("app.layout.draggable.prototype.drop",t,e._draggable),t.stopPropagation&&t.stopPropagation(),e._draggable.current!=this?(e._draggable.prev_index=this.getAttribute("data-index"),e._draggable.current.innerHTML=this.innerHTML,e._draggable.current.setAttribute("data-index",e._draggable.prev_index),this.setAttribute("data-index",e._draggable.next_index),this.innerHTML=t.dataTransfer.getData("text/html"),this.querySelector("meta").remove()):e._draggable.next_index=null,!1},app.layout.dropdown=function(e,t,r){if(!e||!t||!r)return app.error("app.view.dropdown",arguments);var p=app.layout.dropdown.prototype;return p.event=e,p.element=t,p.dropdown=r,p[e].bind(p)},app.layout.dropdown.prototype.open=function(e){app._runtime.debug&&console.info("app.layout.collapse.prototype.open",e&&e.target,e),"true"!==this.element.getAttribute("aria-expanded")&&(e&&e.target&&(e.target===this.element||e.target.offsetParent===this.element)||(this.element.parentNode.classList.add("open"),this.element.setAttribute("aria-expanded",!0),this.dropdown.classList.add("open"),this.dropdown.querySelector(".dropdown-toggle").setAttribute("aria-expanded",!0)))},app.layout.dropdown.prototype.close=function(e){app._runtime.debug&&console.info("app.layout.collapse.prototype.open",e&&e.target,e),"false"!==this.element.getAttribute("aria-expanded")&&(e&&e.target&&(e.target===this.element||e.target.offsetParent===this.element)||(this.element.parentNode.classList.remove("open"),this.element.setAttribute("aria-expanded",!1),this.dropdown.classList.remove("open"),this.dropdown.querySelector(".dropdown-toggle").setAttribute("aria-expanded",!1)))},app.layout.dropdown.prototype.toggle=function(){app._runtime.debug&&console.info("app.layout.dropdown.prototype.toggle"),"false"===this.element.getAttribute("aria-expanded")?this.open():this.close()},app.layout.collapse=function(e,t,r){if(!e||!t||!r)return app.error("app.layout.collapse",arguments);var p=app.layout.collapse.prototype;return p.event=e,p.element=t,p.collapsible=r,p[e].bind(p)},app.layout.collapse.prototype.open=function(e){app._runtime.debug&&console.info("app.layout.collapse.prototype.open",e&&e.target,e),"true"!==this.element.getAttribute("aria-expanded")&&(e&&e.target&&(e.target===this.element||e.target.offsetParent===this.element)||(this.collapsible.classList.add("collapse"),this.collapsible.classList.add("in"),this.collapsible.setAttribute("aria-expanded",!0),this.element.setAttribute("aria-expanded",!0),this.element.classList.remove("collapsed")))},app.layout.collapse.prototype.close=function(e){app._runtime.debug&&console.info("app.layout.collapse.prototype.open",e&&e.target,e),"false"!==this.element.getAttribute("aria-expanded")&&(e&&e.target&&(e.target===this.element||e.target.offsetParent===this.element)||(this.collapsible.classList.remove("collapse"),this.collapsible.classList.remove("in"),this.collapsible.setAttribute("aria-expanded",!1),this.element.setAttribute("aria-expanded",!1),this.element.classList.add("collapsed")))},app.layout.collapse.prototype.toggle=function(){app._runtime.debug&&console.info("app.layout.collapse.prototype.toggle"),"false"===this.element.getAttribute("aria-expanded")?this.open():this.close()},app.utils={},app.utils.isPlainObject=function(e){var t,r,p={}.hasOwnProperty;return!(!e||"[object Object]"!==toString.call(e))&&(!(t=Object.getPrototypeOf(e))||"function"==typeof(r=p.call(t,"constructor")&&t.constructor)&&p.toString.call(r)===p.toString.call(Object))},app.utils.extendObject=function(){var e,t,r,p,o,a,n=arguments[0]||{},i=1,s=arguments.length,l=!1;for("boolean"==typeof n&&(l=n,n=arguments[i]||{},i++),"object"==typeof n||"function"==typeof n&&"number"!=typeof n.nodeType||(n={}),i===s&&(n=this,i--);i<s;i++)if(null!=(e=arguments[i]))for(t in e)r=n[t],n!==(p=e[t])&&(l&&p&&(app.utils.isPlainObject(p)||(o=Array.isArray(p)))?(a=o?(o=!1,r&&Array.isArray(r)?r:[]):r&&app.utils.isPlainObject(r)?r:{},n[t]=app.utils.extendObject(l,a,p)):void 0!==p&&(n[t]=p));return n},app.utils.system=function(e){var t={platform:null,architecture:null,navigator:null,release:null},r=window.navigator.userAgent.match(/(iPad|iPhone|iPod|android|windows phone)/i),p=window.navigator.userAgent.match(/(Chrome|CriOS|Safari|Firefox|Edge|IEMobile|MSIE|Trident)\/([\d]+)/i),o=null;return r?"android"===(r=r[0].toLowerCase())?t.platform="android":"windows phone"===r?t.platform="wm":"ipad"===r?(t.platform="ios",t.model="ipad"):(t.platform="ios",t.model="iphone"):(r=window.navigator.userAgent.match(/(Win|Mac|Linux)/i))&&("win"===(r=r[0].substring(0,3).toLowerCase())&&(-1!=window.navigator.userAgent.indexOf("WOW64")||-1!=window.navigator.userAgent.indexOf("Win64")?t.architecture=64:t.architecture=32),"lin"===r&&(r="nxl"),t.platform=r),p&&(o=p[2]||null,(p=(p=p[1]||p[0]).toLowerCase())&&("crios"===p&&(p="chrome"),-1==p.indexOf("ie")&&"trident"!=p||("trident"===p?o=(o=window.navigator.userAgent.match(/rv:([\d]+)/i))?(p="ie",o[1]):p=null:p="ie"),t.navigator=p,o&&(t.release=parseFloat(o)))),e&&"string"==typeof e&&e in t?t[e]:t},app.utils.addEvent=function(e,t,r){if("string"!=typeof e||!t||"function"!=typeof r)return app.error("app.utils.addEvent",arguments);t.addEventListener?t.addEventListener(e,r,!1):t.attachEvent&&t.attachEvent("on"+e,r)},app.utils.removeEvent=function(e,t,r){if(!e||!t||"function"!=typeof r)return app.error("app.utils.removeEvent",arguments);t.addEventListener?t.removeEventListener(e,r,!1):t.attachEvent&&t.detachEvent("on"+e,r)},app.utils.transform=function(e,t){if(!e)return app.error("app.utils.transform",arguments);switch(e){case"lowercase":return t.toLowerCase();case"uppercase":return t.toUpperCase();case"numeric":return parseFloat(t);case"integer":return parseInt(t);case"json":try{return t=decodeURIComponent(t),JSON.parse(t)}catch(e){}}},app.utils.sanitize=function(e,t){if(!e)return app.error("app.utils.sanitize",arguments);switch(e){case"whitespace":return t.replace(/\\s/g,"");case"breakline":return t.replace(/\\r\\n/g,"");case"date":try{return new Date(t).toISOString().split("T")[0]}catch(e){}break;case"datetime":try{return new Date(t).toISOString()}catch(e){}break;case"datetime-local":try{return new Date(t).toISOString().split(".")[0]}catch(e){}break;case"array":if("object"==typeof t&&t instanceof Array){var r=[];return Array.prototype.forEach.call(t,function(e,t){null!==e&&(r[t]=e)}),r}}},app.utils.storage=function(e,t,r,p){if(void 0===e||void 0===t)return app.error("app.utils.storage",arguments);if(!app._runtime.storage)return app.stop("app.utils.storage","runtime");var o=app.utils.storage.prototype,a=app._runtime.storage.toString();return o._prefix="appe.",o._fn=e?a:"sessionStorage",o._fn in window==!1?app.error("app.utils.storage",o._fn):o[t].apply(o,[r,p])},app.utils.storage.prototype.set=function(e,t){if(void 0===e||"string"!=typeof e||void 0===t)return app.error("app.utils.storage.prototype.set",arguments);var r=app.utils.base64("encode",this._prefix+e);if("object"==typeof t)try{t=JSON.stringify(t)}catch(e){return app.error("app.utils.storage.prototype.set",e)}return t=t.toString(),window[this._fn].setItem(r,t),!0},app.utils.storage.prototype.get=function(e){if(void 0===e||"string"!=typeof e)return app.error("app.utils.storage.prototype.get",arguments);var t=app.utils.base64("encode",this._prefix+e),r=window[this._fn].getItem(t);try{var p=r;r=JSON.parse(p)}catch(e){r=p}return r},app.utils.storage.prototype.has=function(e,t){if(void 0===e||"string"!=typeof e)return app.error("app.utils.storage.prototype.has",arguments);if(null==t)return!!this.get(e);if("object"==typeof t)try{t=JSON.stringify(t)}catch(e){return app.error("app.utils.storage.prototype.has",e)}return t=t.toString(),this.get(e)===t},app.utils.storage.prototype.del=function(e){if(void 0===e||"string"!=typeof e)return app.error("app.utils.storage.prototype.del",arguments);var t=app.utils.base64("encode",this._prefix+e);return window[this._fn].removeItem(t),!0},app.utils.storage.prototype.reset=function(){return window[this._fn].clear(),!0},app.utils.cookie=function(e,t,r,p){if(void 0===e)return app.error("app.utils.cookie",arguments);var o=app.utils.cookie.prototype;return o._prefix="appe.",o[e].apply(o,[t,r,p])},app.utils.cookie.prototype.set=function(e,t,r){if(void 0===e||"string"!=typeof e||void 0===t)return app.error("app.utils.cookie.prototype.set",arguments);var p="Fri, 31 Dec 9999 23:59:59 GMT";r&&r instanceof Date&&(p=r.toUTCString());var o=app.utils.base64("encode",this._prefix+e);if(o=encodeURIComponent(o),"object"==typeof t)try{t=JSON.stringify(t)}catch(e){return app.error("app.utils.cookie().set",e)}return t=t.toString(),t=encodeURIComponent(t),document.cookie=o+"="+t+"; expires="+p,!0},app.utils.cookie.prototype.get=function(e){if(void 0===e||"string"!=typeof e)return app.error("app.utils.cookie.prototype.get",arguments);var t=app.utils.base64("encode",this._prefix+e);t=encodeURIComponent(t);var r=null;if(-1!=document.cookie.indexOf(t)){var p=new RegExp(t+"=([^;]+)"),o=document.cookie.match(p);r=o.length?o[1]:null}if(!r)return null;try{var a=r;r=JSON.parse(a)}catch(e){r=a}return r=decodeURIComponent(r)},app.utils.cookie.prototype.has=function(e,t){if(void 0===e||"string"!=typeof e)return app.error("app.utils.cookie.prototype.has",arguments);if(null==t)return!!this.get(e);if("object"==typeof t)try{t=JSON.stringify(t)}catch(e){return app.error("app.utils.cookie.prototype.has",e)}return t=t.toString(),t=encodeURIComponent(t),this.get(e)===t},app.utils.cookie.prototype.del=function(e){if(void 0===e||"string"!=typeof e)return app.error("app.utils.cookie.prototype.del",arguments);var t=app.utils.base64("encode",this._prefix+e);return t=encodeURIComponent(t),document.cookie=t+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT",!0},app.utils.cookie.prototype.reset=function(){return!(document.cookie="")},app.utils.dateFormat=function(e,t){var r=null;r=r instanceof Date==!0?e:!0===e?new Date:new Date(e);var p=function(e){switch(e){case"d":return app.utils.numberLendingZero(r.getDate());case"J":return r.getDate();case"w":return r.getDay();case"m":return app.utils.numberLendingZero(r.getMonth()+1);case"n":return r.getMonth()+1;case"N":return r.getMonth();case"Y":return r.getFullYear();case"y":return r.getFullYear().toString().slice(2);case"H":return app.utils.numberLendingZero(r.getHours());case"G":return r.getHours();case"M":return app.utils.numberLendingZero(r.getMinutes());case"I":return r.getMinutes();case"S":return app.utils.numberLendingZero(r.getSeconds());case"K":return r.getSeconds();case"v":return r.getMilliseconds();case"a":return r.toDateString().split(" ")[0];case"b":return r.toDateString().split(" ")[1];case"x":return r.toISOString().split("T")[0].replace(/-/g,"/");case"X":return r.toTimeString().split(" ")[0];case"s":return Math.round(r.getTime()/1e3);case"V":return r.getTime();case"O":return r.toTimeString().match(/([\+[\d]{4,})/)[0];case"z":return r.toTimeString().split("GMT")[1];case"C":return r.toUTCString();case"Q":return r.toISOString()}};t=(t=t||"Y-m-d H:M").match(/.{1}/g);for(var o="",a=0;a<t.length;a++)o+=/[\W_]/.test(t[a])?t[a]:p(t[a]);return o},app.utils.numberLendingZero=function(e){return e<10?"0"+e:e.toString()},app.utils.base64=function(e,t){var r=app.utils.base64.prototype;return"btoa"in window==0||"atob"in window==0?app.stop("app.utils.base64"):void 0!==e&&t?r[e](t):app.error("app.utils.base64",arguments)},app.utils.base64.prototype.encode=function(e){var t=window.btoa;return"string"!=typeof e?app.error("app.utils.base64.prototype.encode",arguments):e=t(e=encodeURIComponent(e))},app.utils.base64.prototype.decode=function(e){var t=window.atob;return"string"!=typeof e?app.error("app.utils.base64.prototype.decode",arguments):(e=t(e),e=decodeURIComponent(e))};